MP2COD 4.00, COFF to COD File Converter
Copyright (c) 2005 Microchip Technology Inc.
Listing File Generated: Sun Nov 06 22:58:18 2005


Address  Value    Disassembly              Source                                                                           File
-------  -------  -----------------------  -------------------------------------------------------------------------------  -----
                                                                                                                            E:\usb20\scope\main.c
                                           /*********************************************************************           E:\usb20\scope\main.c
                                           *                                                                                E:\usb20\scope\main.c
                                           *　USB接続 オシロスコープ                                                        E:\usb20\scope\main.c
                                           *	USBフレ-ムワーク修正情報                                                       E:\usb20\scope\main.c
                                           *　　コンフィギュレーションの設定変更                                            E:\usb20\scope\main.c
                                           *    CDCクラスベース                                                             E:\usb20\scope\main.c
                                           *　　main.c　の変更　初期化削除　IO設定変更                                      E:\usb20\scope\main.c
                                           *　　io_cfg.hの変更　LED削除　IOモニタ削除                                       E:\usb20\scope\main.c
                                           *　　user.cの変更　　削除                                                        E:\usb20\scope\main.c
                                           *　　usbcfg.hの変更　IOモニタ削除                                                E:\usb20\scope\main.c
                                           *  ★★Linkerを修正しているので注意★★                                          E:\usb20\scope\main.c
                                           *                                                                                E:\usb20\scope\main.c
                                           *********************************************************************            E:\usb20\scope\main.c
                                                                                                                            E:\usb20\scope\main.c
                                           /** I N C L U D E S ************************************************/            E:\usb20\scope\main.c
                                           #include <p18cxxx.h>                                                             E:\usb20\scope\main.c
                                           #include "system\typedefs.h"                 // Required                         E:\usb20\scope\main.c
                                           #include "system\usb\usb.h"                  // Required                         E:\usb20\scope\main.c
                                           #include "io_cfg.h"                          // Required                         E:\usb20\scope\main.c
                                                                                                                            E:\usb20\scope\main.c
                                           #include "system\usb\usb_compile_time_validation.h"                              E:\usb20\scope\main.c
                                                                                                                            E:\usb20\scope\main.c
                                           /*** Configuration *******/                                                      E:\usb20\scope\main.c
                                           #pragma config FOSC = HSPLL_HS                                                   E:\usb20\scope\main.c
                                           #pragma config WDT = OFF                                                         E:\usb20\scope\main.c
                                           #pragma config PLLDIV = 5                                                        E:\usb20\scope\main.c
                                           #pragma config CPUDIV = OSC1_PLL2                                                E:\usb20\scope\main.c
                                           #pragma config USBDIV = 2                                                        E:\usb20\scope\main.c
                                           #pragma config PWRT = ON                                                         E:\usb20\scope\main.c
                                           #pragma config BOR = ON                                                          E:\usb20\scope\main.c
                                           #pragma config BORV = 43                                                         E:\usb20\scope\main.c
                                           #pragma config LVP = OFF                                                         E:\usb20\scope\main.c
                                           #pragma config VREGEN = ON                                                       E:\usb20\scope\main.c
                                           #pragma config MCLRE = ON                                                        E:\usb20\scope\main.c
                                           #pragma config PBADEN = OFF                                                      E:\usb20\scope\main.c
                                                                                                                            E:\usb20\scope\main.c
                                           /** V A R I A B L E S **********************************************/            E:\usb20\scope\main.c
                                           #pragma udata                                                                    E:\usb20\scope\main.c
                                           static char input_buffer[64];			// USB入力バッファ                               E:\usb20\scope\main.c
                                           static char output_buffer[64];			// USB出力バッファ                              E:\usb20\scope\main.c
                                                                                                                            E:\usb20\scope\main.c
                                           unsigned int RcvSize;					// 受信データサイズ                                    E:\usb20\scope\main.c
                                           char State = 0;						// ステートフラグ                                           E:\usb20\scope\main.c
                                           unsigned int Period;					// サンプル周期                                         E:\usb20\scope\main.c
                                           unsigned int Index = 0;				// バッファインデックス                               E:\usb20\scope\main.c
                                           char FreeFlag;						// フリーランフラグ                                          E:\usb20\scope\main.c
                                           byte New_Data;						// 今回データ                                                E:\usb20\scope\main.c
                                           byte Old_Data;						// 前回データ                                                E:\usb20\scope\main.c
                                           byte Threshold;						// トリガ用スレッショルド                                   E:\usb20\scope\main.c
                                           byte Sample;							// サンプリング周期                                           E:\usb20\scope\main.c
                                           byte Channel;							// チャネル番号                                              E:\usb20\scope\main.c
                                                                                                                            E:\usb20\scope\main.c
                                           rom char MsgOK[] ="OK";				// OK応答メッセージ                                   E:\usb20\scope\main.c
                                           // アナログ計測バッファ　合計960バイト                                           E:\usb20\scope\main.c
                                           #pragma udata gpr1                                                               E:\usb20\scope\main.c
                                           static byte BufferA[512];				//                                                  E:\usb20\scope\main.c
                                           #pragma udata usb6                                                               E:\usb20\scope\main.c
                                           static byte BufferB[448];				// CDCで一部使用、LinkerのProtectをはずす           E:\usb20\scope\main.c
                                                                                                                            E:\usb20\scope\main.c
                                           /** P R I V A T E  P R O T O T Y P E S ******************************/           E:\usb20\scope\main.c
                                           void ltostring(char digit, unsigned long data, byte *buffer);                    E:\usb20\scope\main.c
                                           byte AD_input(char chanl);                                                       E:\usb20\scope\main.c
                                           void ISRProcess(void);                                                           E:\usb20\scope\main.c
                                                                                                                            E:\usb20\scope\main.c
                                           /** V E C T O R  R E M A P P I N G **********************************/           E:\usb20\scope\main.c
                                           #pragma code high_vector=0x08                                                    E:\usb20\scope\main.c
                                           void interrupt_at_high_vector(void)                                              E:\usb20\scope\main.c
                                           {                                                                                E:\usb20\scope\main.c
000008   ef1c     GOTO      0x38               _asm goto ISRProcess _endasm                                                 E:\usb20\scope\main.c
00000a   f000                                                                                                               
00000c   0012     RETURN    0x0            }                                                                                E:\usb20\scope\main.c
                                           #pragma code                                                                     E:\usb20\scope\main.c
                                                                                                                            E:\usb20\scope\main.c
                                           /*****************************************/                                      E:\usb20\scope\main.c
                                           /* CCP1の割り込み処理                                                            E:\usb20\scope\main.c
                                           /* 一定周期でA/D変換を行い信号サンプリング                                       E:\usb20\scope\main.c
                                           /* 最短10μsec周期だが性能は50μsec                                              E:\usb20\scope\main.c
                                           /****************************************/                                       E:\usb20\scope\main.c
                                           #pragma interrupt ISRProcess                                                     E:\usb20\scope\main.c
000038   cfda     MOVFF     0xfda,0xfe4    void ISRProcess(void)                                                            E:\usb20\scope\main.c
00003a   ffe4                                                                                                               
00003c   cfe2     MOVFF     0xfe2,0xfda                                                                                     
00003e   ffda                                                                                                               
000040   cfe9     MOVFF     0xfe9,0xfe4                                                                                     
000042   ffe4                                                                                                               
000044   cfea     MOVFF     0xfea,0xfe4                                                                                     
000046   ffe4                                                                                                               
000048   cff6     MOVFF     0xff6,0xfe4                                                                                     
00004a   ffe4                                                                                                               
00004c   cff7     MOVFF     0xff7,0xfe4                                                                                     
00004e   ffe4                                                                                                               
000050   cff5     MOVFF     0xff5,0xfe4                                                                                     
000052   ffe4                                                                                                               
000054   cff3     MOVFF     0xff3,0xfe4                                                                                     
000056   ffe4                                                                                                               
000058   cff4     MOVFF     0xff4,0xfe4                                                                                     
00005a   ffe4                                                                                                               
00005c   cffa     MOVFF     0xffa,0xfe4                                                                                     
00005e   ffe4                                                                                                               
000060   ee00     LFSR      0x0,0x0                                                                                         
000062   f000                                                                                                               
000064   0e14     MOVLW     0x14                                                                                            
000066   04e8     DECF      0xe8,0x0,0x0                                                                                    
000068   e303     BNC       0x70                                                                                            
00006a   cfee     MOVFF     0xfee,0xfe4                                                                                     
00006c   ffe4                                                                                                               
00006e   d7fb     BRA       0x66                                                                                            
000070   ee00     LFSR      0x0,0x14                                                                                        
000072   f014                                                                                                               
000074   0e02     MOVLW     0x2                                                                                             
000076   04e8     DECF      0xe8,0x0,0x0                                                                                    
000078   e303     BNC       0x80                                                                                            
00007a   cfee     MOVFF     0xfee,0xfe4                                                                                     
00007c   ffe4                                                                                                               
00007e   d7fb     BRA       0x76                                                                                            
000080   52e6     MOVF      0xe6,0x1,0x0                                                                                    
                                           {                                                                                E:\usb20\scope\main.c
000082   949e     BCF       0x9e,0x2,0x0   	PIR1bits.CCP1IF = 0;					// 割り込みフラグクリア                                E:\usb20\scope\main.c
000084   c0e5     MOVFF     0xe5,0xe6      	Old_Data = New_Data;					// 同期用に２世代                                      E:\usb20\scope\main.c
000086   f0e6                                                                                                               
000088   c0e9     MOVFF     0xe9,0xfe6     	New_Data = AD_input(Channel);			// 新規データサンプリング                       E:\usb20\scope\main.c
00008a   ffe6                                                                                                               
00008c   d886     RCALL     0x19a                                                                                           
00008e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000090   0100     MOVLB     0x0                                                                                             
000092   6fe5     MOVWF     0xe5,0x1                                                                                        
                                              	//// トリガ検出と保存                                                        E:\usb20\scope\main.c
000094   0107     MOVLB     0x7               	switch (State)                                                               E:\usb20\scope\main.c
000096   51db     MOVF      0xdb,0x0,0x1                                                                                    
000098   0a01     XORLW     0x1                                                                                             
00009a   e029     BZ        0xee                                                                                            
00009c   0a01     XORLW     0x1                                                                                             
00009e   e001     BZ        0xa2                                                                                            
                                              	{                                                                            E:\usb20\scope\main.c
                                              		case 0:		/// トリガ検出                                                     E:\usb20\scope\main.c
0000a2   0100     MOVLB     0x0               			if(FreeFlag == 0) {                                                        E:\usb20\scope\main.c
0000a4   51e4     MOVF      0xe4,0x0,0x1                                                                                    
0000a6   e11d     BNZ       0xe2                                                                                            
0000a8   51e7     MOVF      0xe7,0x0,0x1   	   			if(Threshold > 127) {			// プラスの時は立ち上がりトリガ                   E:\usb20\scope\main.c
0000aa   087f     SUBLW     0x7f                                                                                            
0000ac   e20d     BC        0xc8                                                                                            
0000ae   51e7     MOVF      0xe7,0x0,0x1   	  	 			if((Old_Data < Threshold) && (New_Data > Threshold)) {                   E:\usb20\scope\main.c
0000b0   5de6     SUBWF     0xe6,0x0,0x1                                                                                    
0000b2   e209     BC        0xc6                                                                                            
0000b4   51e7     MOVF      0xe7,0x0,0x1                                                                                    
0000b6   80d8     BSF       0xd8,0x0,0x0                                                                                    
0000b8   55e5     SUBFWB    0xe5,0x0,0x1                                                                                    
0000ba   e205     BC        0xc6                                                                                            
0000bc   0107     MOVLB     0x7            		  	 			State = 1;                                                              E:\usb20\scope\main.c
0000be   0e01     MOVLW     0x1                                                                                             
0000c0   6fdb     MOVWF     0xdb,0x1                                                                                        
0000c2   6bdc     CLRF      0xdc,0x1       		  	 			Index = 0;                                                              E:\usb20\scope\main.c
0000c4   6bdd     CLRF      0xdd,0x1                                                                                        
                                           		  	 		}                                                                        E:\usb20\scope\main.c
                                           		  	 	}                                                                         E:\usb20\scope\main.c
0000c6   d00c     BRA       0xe0           		  	 	else {						// マイナスの時は立ち下がりトリガ                             E:\usb20\scope\main.c
0000c8   51e7     MOVF      0xe7,0x0,0x1   			  	 	if((Old_Data > Threshold) && (New_Data < Threshold)) {                   E:\usb20\scope\main.c
0000ca   80d8     BSF       0xd8,0x0,0x0                                                                                    
0000cc   55e6     SUBFWB    0xe6,0x0,0x1                                                                                    
0000ce   e208     BC        0xe0                                                                                            
0000d0   51e7     MOVF      0xe7,0x0,0x1                                                                                    
0000d2   5de5     SUBWF     0xe5,0x0,0x1                                                                                    
0000d4   e205     BC        0xe0                                                                                            
0000d6   0107     MOVLB     0x7            				  	 	State = 1;                                                              E:\usb20\scope\main.c
0000d8   0e01     MOVLW     0x1                                                                                             
0000da   6fdb     MOVWF     0xdb,0x1                                                                                        
0000dc   6bdc     CLRF      0xdc,0x1       				  	 	Index = 0;                                                              E:\usb20\scope\main.c
0000de   6bdd     CLRF      0xdd,0x1                                                                                        
                                           				  	 }                                                                        E:\usb20\scope\main.c
                                           				}                                                                            E:\usb20\scope\main.c
                                           			}                                                                             E:\usb20\scope\main.c
0000e0   d005     BRA       0xec           			else {                                                                        E:\usb20\scope\main.c
0000e2   0107     MOVLB     0x7            				State = 1;                                                                   E:\usb20\scope\main.c
0000e4   0e01     MOVLW     0x1                                                                                             
0000e6   6fdb     MOVWF     0xdb,0x1                                                                                        
0000e8   6bdc     CLRF      0xdc,0x1       				Index = 0;                                                                   E:\usb20\scope\main.c
0000ea   6bdd     CLRF      0xdd,0x1                                                                                        
                                           			}			                                                                          E:\usb20\scope\main.c
0000ec   d032     BRA       0x152          	  	 	break;                                                                     E:\usb20\scope\main.c
                                           	 	case 1:		/// データ格納                                                       E:\usb20\scope\main.c
0000ee   0e00     MOVLW     0x0            	         if(Index < 512) {				// まずAバッファに格納                            E:\usb20\scope\main.c
0000f0   5ddc     SUBWF     0xdc,0x0,0x1                                                                                    
0000f2   0e02     MOVLW     0x2                                                                                             
0000f4   59dd     SUBWFB    0xdd,0x0,0x1                                                                                    
0000f6   e20f     BC        0x116                                                                                           
0000f8   728a     BTG       0x8a,0x1,0x0   	   	      	GreenLED = !GreenLED;		                                              E:\usb20\scope\main.c
0000fa   c7dc     MOVFF     0x7dc,0xfe9    				BufferA[Index++] = New_Data;                                                 E:\usb20\scope\main.c
0000fc   ffe9                                                                                                               
0000fe   c7dd     MOVFF     0x7dd,0xfea                                                                                     
000100   ffea                                                                                                               
000102   2bdc     INCF      0xdc,0x1,0x1                                                                                    
000104   0e00     MOVLW     0x0                                                                                             
000106   23dd     ADDWFC    0xdd,0x1,0x1                                                                                    
000108   0e00     MOVLW     0x0                                                                                             
00010a   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
00010c   0e01     MOVLW     0x1                                                                                             
00010e   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
000110   c0e5     MOVFF     0xe5,0xfef                                                                                      
000112   ffef                                                                                                               
                                           			}                                                                             E:\usb20\scope\main.c
000114   d01d     BRA       0x150          			else {						// 続きをBバッファに格納                                          E:\usb20\scope\main.c
000116   0ec0     MOVLW     0xc0           				if(Index < 960) {                                                            E:\usb20\scope\main.c
000118   5ddc     SUBWF     0xdc,0x0,0x1                                                                                    
00011a   0e03     MOVLW     0x3                                                                                             
00011c   59dd     SUBWFB    0xdd,0x0,0x1                                                                                    
00011e   e213     BC        0x146                                                                                           
000120   748a     BTG       0x8a,0x2,0x0   	   	      		YellowLED = !YellowLED;	                                            E:\usb20\scope\main.c
000122   c7dc     MOVFF     0x7dc,0xfe9    					BufferB[Index-512] = New_Data;                                              E:\usb20\scope\main.c
000124   ffe9                                                                                                               
000126   c7dd     MOVFF     0x7dd,0xfea                                                                                     
000128   ffea                                                                                                               
00012a   0e00     MOVLW     0x0                                                                                             
00012c   5ee9     SUBWF     0xe9,0x1,0x0                                                                                    
00012e   0e02     MOVLW     0x2                                                                                             
000130   5aea     SUBWFB    0xea,0x1,0x0                                                                                    
000132   0e00     MOVLW     0x0                                                                                             
000134   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
000136   0e06     MOVLW     0x6                                                                                             
000138   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
00013a   c0e5     MOVFF     0xe5,0xfef                                                                                      
00013c   ffef                                                                                                               
00013e   2bdc     INCF      0xdc,0x1,0x1   					Index++;                                                                    E:\usb20\scope\main.c
000140   0e00     MOVLW     0x0                                                                                             
000142   23dd     ADDWFC    0xdd,0x1,0x1                                                                                    
                                           				}                                                                            E:\usb20\scope\main.c
000144   d005     BRA       0x150          				else {					// バッファ一杯でステート更新                                     E:\usb20\scope\main.c
000146   0e02     MOVLW     0x2            					State = 2;                                                                  E:\usb20\scope\main.c
000148   6fdb     MOVWF     0xdb,0x1                                                                                        
00014a   6bdc     CLRF      0xdc,0x1       					Index = 0;                                                                  E:\usb20\scope\main.c
00014c   6bdd     CLRF      0xdd,0x1                                                                                        
00014e   90cd     BCF       0xcd,0x0,0x0   					T1CONbits.TMR1ON = 0;	// タイマ１停止                                       E:\usb20\scope\main.c
                                           				}                                                                            E:\usb20\scope\main.c
                                           			}                                                                             E:\usb20\scope\main.c
000150   d000     BRA       0x152          			break;                                                                        E:\usb20\scope\main.c
0000a0   d058     BRA       0x152          		default: break;                                                                E:\usb20\scope\main.c
                                           	}                                                                               E:\usb20\scope\main.c
000152   52e5     MOVF      0xe5,0x1,0x0   }                                                                                E:\usb20\scope\main.c
000154   ee00     LFSR      0x0,0x15                                                                                        
000156   f015                                                                                                               
000158   0e02     MOVLW     0x2                                                                                             
00015a   04e8     DECF      0xe8,0x0,0x0                                                                                    
00015c   e303     BNC       0x164                                                                                           
00015e   cfe5     MOVFF     0xfe5,0xfed                                                                                     
000160   ffed                                                                                                               
000162   d7fb     BRA       0x15a                                                                                           
000164   ee00     LFSR      0x0,0x13                                                                                        
000166   f013                                                                                                               
000168   0e14     MOVLW     0x14                                                                                            
00016a   04e8     DECF      0xe8,0x0,0x0                                                                                    
00016c   e303     BNC       0x174                                                                                           
00016e   cfe5     MOVFF     0xfe5,0xfed                                                                                     
000170   ffed                                                                                                               
000172   d7fb     BRA       0x16a                                                                                           
000174   cfe5     MOVFF     0xfe5,0xffa                                                                                     
000176   fffa                                                                                                               
000178   cfe5     MOVFF     0xfe5,0xff4                                                                                     
00017a   fff4                                                                                                               
00017c   cfe5     MOVFF     0xfe5,0xff3                                                                                     
00017e   fff3                                                                                                               
000180   cfe5     MOVFF     0xfe5,0xff5                                                                                     
000182   fff5                                                                                                               
000184   cfe5     MOVFF     0xfe5,0xff7                                                                                     
000186   fff7                                                                                                               
000188   cfe5     MOVFF     0xfe5,0xff6                                                                                     
00018a   fff6                                                                                                               
00018c   cfe5     MOVFF     0xfe5,0xfea                                                                                     
00018e   ffea                                                                                                               
000190   cfe5     MOVFF     0xfe5,0xfe9                                                                                     
000192   ffe9                                                                                                               
000194   cfe5     MOVFF     0xfe5,0xfda                                                                                     
000196   ffda                                                                                                               
000198   0011     RETFIE    0x1                                                                                             
                                           //////// A/D変換読み込み関数                                                     E:\usb20\scope\main.c
00019a   cfd9     MOVFF     0xfd9,0xfe6    byte AD_input(char chanl)                                                        E:\usb20\scope\main.c
00019c   ffe6                                                                                                               
00019e   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
0001a0   ffd9                                                                                                               
0001a2   52e6     MOVF      0xe6,0x1,0x0                                                                                    
                                           {                                                                                E:\usb20\scope\main.c
                                               	byte adData;        				// 8ビットモード                                    E:\usb20\scope\main.c
                                               	                                                                            E:\usb20\scope\main.c
0001a4   0efe     MOVLW     0xfe           	ADCON0 = 0x01 + (chanl * 4);                                                    E:\usb20\scope\main.c
0001a6   50db     MOVF      0xdb,0x0,0x0                                                                                    
0001a8   0d04     MULLW     0x4                                                                                             
0001aa   28f3     INCF      0xf3,0x0,0x0                                                                                    
0001ac   6ec2     MOVWF     0xc2,0x0                                                                                        
0001ae   82c2     BSF       0xc2,0x1,0x0       	ADCON0bits.GO = 1;              	// Start AD conversion                     E:\usb20\scope\main.c
0001b0   b2c2     BTFSC     0xc2,0x1,0x0       	while(ADCON0bits.NOT_DONE);     	// Wait for conversion                     E:\usb20\scope\main.c
0001b2   d7fe     BRA       0x1b0                                                                                           
0001b4   50c4     MOVF      0xc4,0x0,0x0    	adData = (byte)ADRESH;				// 上位８ビットのみ取り出し                          E:\usb20\scope\main.c
0001b6   6edf     MOVWF     0xdf,0x0                                                                                        
0001b8   50df     MOVF      0xdf,0x0,0x0   	return(adData);                    	// データ返し                               E:\usb20\scope\main.c
0001ba   d000     BRA       0x1bc                                                                                           
0001bc   52e5     MOVF      0xe5,0x1,0x0   }                                                                                E:\usb20\scope\main.c
0001be   52e5     MOVF      0xe5,0x1,0x0                                                                                    
0001c0   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
0001c2   ffd9                                                                                                               
0001c4   0012     RETURN    0x0                                                                                             
                                                                                                                            E:\usb20\scope\main.c
                                                                                                                            E:\usb20\scope\main.c
                                           /**********************************************************                      E:\usb20\scope\main.c
                                            * メイン関数                                                                    E:\usb20\scope\main.c
                                            * 初期化後USB受信待ち、受信したコマンドに応じた処理を実行                       E:\usb20\scope\main.c
                                            *********************************************************/                      E:\usb20\scope\main.c
0001c6   cfd9     MOVFF     0xfd9,0xfe6    void main(void)                                                                  E:\usb20\scope\main.c
0001c8   ffe6                                                                                                               
0001ca   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
0001cc   ffd9                                                                                                               
0001ce   0e02     MOVLW     0x2                                                                                             
0001d0   26e1     ADDWF     0xe1,0x1,0x0                                                                                    
                                           {                                                                                E:\usb20\scope\main.c
                                           	int	i;                                                                          E:\usb20\scope\main.c
                                           	                                                                                E:\usb20\scope\main.c
0001d2   0e07     MOVLW     0x7            	ADCON1 = 0x07;             	// ポートA全アナログに設定                          E:\usb20\scope\main.c
0001d4   6ec1     MOVWF     0xc1,0x0                                                                                        
0001d6   0e16     MOVLW     0x16           	ADCON2 = 0x16;				// Left,Tad＝Tcy/64 Taq=4Tad                                  E:\usb20\scope\main.c
0001d8   6ec0     MOVWF     0xc0,0x0                                                                                        
0001da   0e1d     MOVLW     0x1d           	ADCON0 = 0x1D;				// AD On	                                                     E:\usb20\scope\main.c
0001dc   6ec2     MOVWF     0xc2,0x0                                                                                        
0001de   0e07     MOVLW     0x7            	CMCON = 0x07;					// コンパレータオフ                                           E:\usb20\scope\main.c
0001e0   6eb4     MOVWF     0xb4,0x0                                                                                        
                                           	/// ポート初期化	                                                               E:\usb20\scope\main.c
0001e2   688a     SETF      0x8a,0x0          	LATB = 0xFF;					// LEDオフ                                                  E:\usb20\scope\main.c
0001e4   6892     SETF      0x92,0x0        	TRISA = 0xFF;					// アナログ入力                                              E:\usb20\scope\main.c
0001e6   6a93     CLRF      0x93,0x0       	TRISB = 0x00;					// LED出力                                                    E:\usb20\scope\main.c
0001e8   0eb0     MOVLW     0xb0            	TRISC = 0xB0;					// USB                                                       E:\usb20\scope\main.c
0001ea   6e94     MOVWF     0x94,0x0                                                                                        
                                            	// タイマ１初期化                                                              E:\usb20\scope\main.c
0001ec   6ecd     MOVWF     0xcd,0x0        	T1CON = 0xB0;					// 内部クロック プリスケール1/8                              E:\usb20\scope\main.c
0001ee   6acf     CLRF      0xcf,0x0        	TMR1H = 0;					// 基準 = 48MHz/4/8=1.5MHz                                      E:\usb20\scope\main.c
0001f0   6ace     CLRF      0xce,0x0        	TMR1L = 0;                                                                     E:\usb20\scope\main.c
0001f2   6ab1     CLRF      0xb1,0x0       	T3CON = 0;					// CCP1一致でタイマ１リセット                                    E:\usb20\scope\main.c
                                            	// CCP1初期化                                                                  E:\usb20\scope\main.c
0001f4   0e0f     MOVLW     0xf             	Period = 15;					// 10usec 単位とする                                          E:\usb20\scope\main.c
0001f6   0100     MOVLB     0x0                                                                                             
0001f8   6fe2     MOVWF     0xe2,0x1                                                                                        
0001fa   6be3     CLRF      0xe3,0x1                                                                                        
0001fc   0e0b     MOVLW     0xb             	CCP1CON = 0x0B;				// 一致でタイマ１クリア                                     E:\usb20\scope\main.c
0001fe   6ebd     MOVWF     0xbd,0x0                                                                                        
000200   c0e2     MOVFF     0xe2,0xfbe     	CCPR1 = Period * 10;			// 10usec単位(10usec to 40.390msec)	                     E:\usb20\scope\main.c
000202   ffbe                                                                                                               
000204   c0e3     MOVFF     0xe3,0xfbf                                                                                      
000206   ffbf                                                                                                               
000208   0e0a     MOVLW     0xa                                                                                             
00020a   02bf     MULWF     0xbf,0x0                                                                                        
00020c   cff3     MOVFF     0xff3,0xfbf                                                                                     
00020e   ffbf                                                                                                               
000210   02be     MULWF     0xbe,0x0                                                                                        
000212   cff3     MOVFF     0xff3,0xfbe                                                                                     
000214   ffbe                                                                                                               
000216   50f4     MOVF      0xf4,0x0,0x0                                                                                    
000218   26bf     ADDWF     0xbf,0x1,0x0                                                                                    
                                           	/// USB初期化                                                                   E:\usb20\scope\main.c
00021a   0e14     MOVLW     0x14           	mInitializeUSBDriver();        	// See usbdrv.h                                 E:\usb20\scope\main.c
00021c   6e6f     MOVWF     0x6f,0x0                                                                                        
00021e   0100     MOVLB     0x0                                                                                             
000220   6bfc     CLRF      0xfc,0x1                                                                                        
000222   0100     MOVLB     0x0                                                                                             
000224   6bfd     CLRF      0xfd,0x1                                                                                        
000226   0100     MOVLB     0x0                                                                                             
000228   6bfe     CLRF      0xfe,0x1                                                                                        
                                           	/// 変数初期化                                                                  E:\usb20\scope\main.c
00022a   0107     MOVLB     0x7            	State = 0;					// ステートフラグリセット                                        E:\usb20\scope\main.c
00022c   6bdb     CLRF      0xdb,0x1                                                                                        
00022e   0100     MOVLB     0x0            	Threshold = 190;				// トリガ」スレッショルド初期値                             E:\usb20\scope\main.c
000230   0ebe     MOVLW     0xbe                                                                                            
000232   6fe7     MOVWF     0xe7,0x1                                                                                        
000234   0e0a     MOVLW     0xa            	Sample =10;					// サンプル周期初期値100usec                                    E:\usb20\scope\main.c
000236   6fe8     MOVWF     0xe8,0x1                                                                                        
000238   0e01     MOVLW     0x1            	FreeFlag = 1;					// フリーランフラグオン                                       E:\usb20\scope\main.c
00023a   6fe4     MOVWF     0xe4,0x1                                                                                        
00023c   6be9     CLRF      0xe9,0x1       	Channel = 0;					// チャネル番号0                                               E:\usb20\scope\main.c
00023e   90cd     BCF       0xcd,0x0,0x0   	T1CONbits.TMR1ON = 0;			// タイマ初期停止                                       E:\usb20\scope\main.c
                                           	// 割り込み許可                                                                 E:\usb20\scope\main.c
000240   9ed0     BCF       0xd0,0x7,0x0   	RCONbits.IPEN = 0;			// 優先順位なし                                            E:\usb20\scope\main.c
000242   849d     BSF       0x9d,0x2,0x0    	PIE1bits.CCP1IE = 1;			// CCP1割り込み許可		                                   E:\usb20\scope\main.c
000244   0ec0     MOVLW     0xc0           	INTCON = 0xC0;				// グローバル割り込み許可                                     E:\usb20\scope\main.c
000246   6ef2     MOVWF     0xf2,0x0                                                                                        
                                                                                                                            E:\usb20\scope\main.c
                                               /// メインループ                                                             E:\usb20\scope\main.c
00040a   d71e     BRA       0x248              while(1)                                                                     E:\usb20\scope\main.c
                                               {                                                                            E:\usb20\scope\main.c
000248   ecd4     CALL      0xda8,0x0          		USBCheckBusStatus();        							// USB接続チェック                      E:\usb20\scope\main.c
00024a   f006                                                                                                               
00024c   be6f     BTFSC     0x6f,0x7,0x0       		if(UCFGbits.UTEYE!=1)									// アイパターンモードオフか                  E:\usb20\scope\main.c
00024e   d002     BRA       0x254                                                                                           
000250   ecf3     CALL      0xde6,0x0              		USBDriverService();								// USBイベントポーリング                    E:\usb20\scope\main.c
000252   f006                                                                                                               
000254   ec57     CALL      0x6ae,0x0      		CDCTxService();										// クラス送受信実行                                   E:\usb20\scope\main.c
000256   f003                                                                                                               
                                            		/// 送受信データの処理実行                                                    E:\usb20\scope\main.c
000258   0e06     MOVLW     0x6            		if((usb_device_state >= CONFIGURED_STATE)&&(UCONbits.SUSPND==0))               E:\usb20\scope\main.c
00025a   0100     MOVLB     0x0                                                                                             
00025c   5dfc     SUBWF     0xfc,0x0,0x1                                                                                    
00025e   e201     BC        0x262                                                                                           
000260   d0d4     BRA       0x40a                                                                                           
000262   506d     MOVF      0x6d,0x0,0x0                                                                                    
000264   0b02     ANDLW     0x2                                                                                             
000266   e001     BZ        0x26a                                                                                           
000268   d0d0     BRA       0x40a                                                                                           
                                           		{                                                                              E:\usb20\scope\main.c
00026a   0e40     MOVLW     0x40               			if(getsUSBUSART(input_buffer,64))					// データ受信ポール                 E:\usb20\scope\main.c
00026c   6ee6     MOVWF     0xe6,0x0                                                                                        
00026e   0e60     MOVLW     0x60                                                                                            
000270   6ee6     MOVWF     0xe6,0x0                                                                                        
000272   0e00     MOVLW     0x0                                                                                             
000274   6ee6     MOVWF     0xe6,0x0                                                                                        
000276   ec9c     CALL      0x538,0x0                                                                                       
000278   f002                                                                                                               
00027a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
00027c   52e5     MOVF      0xe5,0x1,0x0                                                                                    
00027e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000280   0900     IORLW     0x0                                                                                             
000282   e101     BNZ       0x286                                                                                           
000284   d0c2     BRA       0x40a                                                                                           
                                               			{                                                                         E:\usb20\scope\main.c
000286   708a     BTG       0x8a,0x0,0x0   				RedLED = !RedLED;								// 目印LED                                          E:\usb20\scope\main.c
000288   0100     MOVLB     0x0            	    			switch(input_buffer[0])						// 最初の１文字チェック                     E:\usb20\scope\main.c
00028a   5160     MOVF      0x60,0x0,0x1                                                                                    
00028c   0a34     XORLW     0x34                                                                                            
00028e   e101     BNZ       0x292                                                                                           
000290   d09d     BRA       0x3cc                                                                                           
000292   0a07     XORLW     0x7                                                                                             
000294   e04f     BZ        0x334                                                                                           
000296   0a01     XORLW     0x1                                                                                             
000298   e031     BZ        0x2fc                                                                                           
00029a   0a03     XORLW     0x3                                                                                             
00029c   e011     BZ        0x2c0                                                                                           
00029e   0a01     XORLW     0x1                                                                                             
0002a0   e001     BZ        0x2a4                                                                                           
                                           	    			{                                                                        E:\usb20\scope\main.c
                                           		    			case '0':								// OKメッセージ返送                                    E:\usb20\scope\main.c
0002a4   0107     MOVLB     0x7            						State = 0;                                                                 E:\usb20\scope\main.c
0002a6   6bdb     CLRF      0xdb,0x1                                                                                        
0002a8   0107     MOVLB     0x7                    					if(mUSBUSARTIsTxTrfReady())                                         E:\usb20\scope\main.c
0002aa   51c1     MOVF      0xc1,0x0,0x1                                                                                    
0002ac   e108     BNZ       0x2be                                                                                           
0002ae   0ec4     MOVLW     0xc4                      			 		putrsUSBUSART("OK");                                            E:\usb20\scope\main.c
0002b0   6ee6     MOVWF     0xe6,0x0                                                                                        
0002b2   0e10     MOVLW     0x10                                                                                            
0002b4   6ee6     MOVWF     0xe6,0x0                                                                                        
0002b6   ec19     CALL      0x632,0x0                                                                                       
0002b8   f003                                                                                                               
0002ba   52e5     MOVF      0xe5,0x1,0x0                                                                                    
0002bc   52e5     MOVF      0xe5,0x1,0x0                                                                                    
0002be   d0a5     BRA       0x40a                     			 	break;                                                           E:\usb20\scope\main.c
                                                      			case '1':								// データ収集開始コマンド                         E:\usb20\scope\main.c
0002c0   0107     MOVLB     0x7                       				State = 0;							// ステート初期状態セット                        E:\usb20\scope\main.c
0002c2   6bdb     CLRF      0xdb,0x1                                                                                        
0002c4   80cd     BSF       0xcd,0x0,0x0              				T1CONbits.TMR1ON = 1;					// タイマ１スタート                     E:\usb20\scope\main.c
0002c6   c061     MOVFF     0x61,0xe7                 				Threshold = (byte)input_buffer[1];		// スレッショルド取得         E:\usb20\scope\main.c
0002c8   f0e7                                                                                                               
0002ca   c062     MOVFF     0x62,0xe8                 				Sample = (byte)input_buffer[2];			// サンプリング周期取得         E:\usb20\scope\main.c
0002cc   f0e8                                                                                                               
0002ce   0100     MOVLB     0x0                       				CCPR1 = Period * Sample;				// 周期設定10usec単位                 E:\usb20\scope\main.c
0002d0   51e8     MOVF      0xe8,0x0,0x1                                                                                    
0002d2   6e14     MOVWF     0x14,0x0                                                                                        
0002d4   6a15     CLRF      0x15,0x0                                                                                        
0002d6   c0e2     MOVFF     0xe2,0x6                                                                                        
0002d8   f006                                                                                                               
0002da   c0e3     MOVFF     0xe3,0x7                                                                                        
0002dc   f007                                                                                                               
0002de   c014     MOVFF     0x14,0xb                                                                                        
0002e0   f00b                                                                                                               
0002e2   c015     MOVFF     0x15,0xc                                                                                        
0002e4   f00c                                                                                                               
0002e6   ec36     CALL      0x106c,0x0                                                                                      
0002e8   f008                                                                                                               
0002ea   c004     MOVFF     0x4,0xfbe                                                                                       
0002ec   ffbe                                                                                                               
0002ee   c005     MOVFF     0x5,0xfbf                                                                                       
0002f0   ffbf                                                                                                               
0002f2   c063     MOVFF     0x63,0xe9                 				Channel = (byte)input_buffer[3];		// チャネル番号設定             E:\usb20\scope\main.c
0002f4   f0e9                                                                                                               
0002f6   0100     MOVLB     0x0            	    					FreeFlag = 0;							// フリーランオフ           				                   E:\usb20\scope\main.c
0002f8   6be4     CLRF      0xe4,0x1                                                                                        
0002fa   d087     BRA       0x40a                     				break;	                                                           E:\usb20\scope\main.c
                                                      			case '2':								// 状態問い合わせ                                 E:\usb20\scope\main.c
0002fc   0e02     MOVLW     0x2                       				if(State == 2) {						// データ取得完了か？                       E:\usb20\scope\main.c
0002fe   0107     MOVLB     0x7                                                                                             
000300   5ddb     SUBWF     0xdb,0x0,0x1                                                                                    
000302   e10c     BNZ       0x31c                                                                                           
000304   0107     MOVLB     0x7                    						if(mUSBUSARTIsTxTrfReady())	         					                         E:\usb20\scope\main.c
000306   51c1     MOVF      0xc1,0x0,0x1                                                                                    
000308   e108     BNZ       0x31a                                                                                           
00030a   0ec2     MOVLW     0xc2                      			 			putrsUSBUSART("1");			// 完了なら１を返す                      E:\usb20\scope\main.c
00030c   6ee6     MOVWF     0xe6,0x0                                                                                        
00030e   0e10     MOVLW     0x10                                                                                            
000310   6ee6     MOVWF     0xe6,0x0                                                                                        
000312   ec19     CALL      0x632,0x0                                                                                       
000314   f003                                                                                                               
000316   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000318   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                                      			 	}                                                                E:\usb20\scope\main.c
00031a   d00b     BRA       0x332                     			 	else {                                                           E:\usb20\scope\main.c
00031c   0107     MOVLB     0x7                   						if(mUSBUSARTIsTxTrfReady())                                         E:\usb20\scope\main.c
00031e   51c1     MOVF      0xc1,0x0,0x1                                                                                    
000320   e108     BNZ       0x332                                                                                           
000322   0ec0     MOVLW     0xc0                      			 			putrsUSBUSART("0");			// 未完了なら０を返す                    E:\usb20\scope\main.c
000324   6ee6     MOVWF     0xe6,0x0                                                                                        
000326   0e10     MOVLW     0x10                                                                                            
000328   6ee6     MOVWF     0xe6,0x0                                                                                        
00032a   ec19     CALL      0x632,0x0                                                                                       
00032c   f003                                                                                                               
00032e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000330   52e5     MOVF      0xe5,0x1,0x0                                                                                    
                                                      			 	}                                                                E:\usb20\scope\main.c
000332   d06b     BRA       0x40a                     			 	break;                                                           E:\usb20\scope\main.c
                                           		    			case '3':								// 計測データ送信                                      E:\usb20\scope\main.c
000334   0107     MOVLB     0x7            				  		if((Index < 512) && (State == 2)) {		// バッファAの送信                  E:\usb20\scope\main.c
000336   0e00     MOVLW     0x0                                                                                             
000338   5ddc     SUBWF     0xdc,0x0,0x1                                                                                    
00033a   0e02     MOVLW     0x2                                                                                             
00033c   59dd     SUBWFB    0xdd,0x0,0x1                                                                                    
00033e   e21e     BC        0x37c                                                                                           
000340   0e02     MOVLW     0x2                                                                                             
000342   5ddb     SUBWF     0xdb,0x0,0x1                                                                                    
000344   e11b     BNZ       0x37c                                                                                           
                                           							/// 計測データの512バイトを転送する                                       E:\usb20\scope\main.c
000346   0107     MOVLB     0x7            						 	if(mUSBUSARTIsTxTrfReady())                                              E:\usb20\scope\main.c
000348   51c1     MOVF      0xc1,0x0,0x1                                                                                    
00034a   e112     BNZ       0x370                                                                                           
00034c   0e00     MOVLW     0x0                       			 			mUSBUSARTTxRam(&BufferA[Index], 64);	// 送信実行               E:\usb20\scope\main.c
00034e   0107     MOVLB     0x7                                                                                             
000350   25dc     ADDWF     0xdc,0x0,0x1                                                                                    
000352   0107     MOVLB     0x7                                                                                             
000354   6fc2     MOVWF     0xc2,0x1                                                                                        
000356   0e01     MOVLW     0x1                                                                                             
000358   0107     MOVLB     0x7                                                                                             
00035a   21dd     ADDWFC    0xdd,0x0,0x1                                                                                    
00035c   0107     MOVLB     0x7                                                                                             
00035e   6fc3     MOVWF     0xc3,0x1                                                                                        
000360   0107     MOVLB     0x7                                                                                             
000362   0e40     MOVLW     0x40                                                                                            
000364   6fc6     MOVWF     0xc6,0x1                                                                                        
000366   0107     MOVLB     0x7                                                                                             
000368   6bc7     CLRF      0xc7,0x1                                                                                        
00036a   0107     MOVLB     0x7                                                                                             
00036c   0e01     MOVLW     0x1                                                                                             
00036e   6fc1     MOVWF     0xc1,0x1                                                                                        
000370   0e40     MOVLW     0x40           							Index += 64;                                                              E:\usb20\scope\main.c
000372   0107     MOVLB     0x7                                                                                             
000374   27dc     ADDWF     0xdc,0x1,0x1                                                                                    
000376   0e00     MOVLW     0x0                                                                                             
000378   23dd     ADDWFC    0xdd,0x1,0x1                                                                                    
                                           						}									                                                                 E:\usb20\scope\main.c
00037a   d027     BRA       0x3ca          						else {								// バッファBの送信                                           E:\usb20\scope\main.c
00037c   0e02     MOVLW     0x2            							if((State == 2) && (Index < 960)) {                                       E:\usb20\scope\main.c
00037e   5ddb     SUBWF     0xdb,0x0,0x1                                                                                    
000380   e123     BNZ       0x3c8                                                                                           
000382   0ec0     MOVLW     0xc0                                                                                            
000384   5ddc     SUBWF     0xdc,0x0,0x1                                                                                    
000386   0e03     MOVLW     0x3                                                                                             
000388   59dd     SUBWFB    0xdd,0x0,0x1                                                                                    
00038a   e21e     BC        0x3c8                                                                                           
00038c   0107     MOVLB     0x7            							 	if(mUSBUSARTIsTxTrfReady())                                             E:\usb20\scope\main.c
00038e   51c1     MOVF      0xc1,0x0,0x1                                                                                    
000390   e115     BNZ       0x3bc                                                                                           
000392   c7dc     MOVFF     0x7dc,0x7c2    							 		mUSBUSARTTxRam(&BufferB[Index-512], 64);                               E:\usb20\scope\main.c
000394   f7c2                                                                                                               
000396   c7dd     MOVFF     0x7dd,0x7c3                                                                                     
000398   f7c3                                                                                                               
00039a   0107     MOVLB     0x7                                                                                             
00039c   0e00     MOVLW     0x0                                                                                             
00039e   5fc2     SUBWF     0xc2,0x1,0x1                                                                                    
0003a0   0e02     MOVLW     0x2                                                                                             
0003a2   5bc3     SUBWFB    0xc3,0x1,0x1                                                                                    
0003a4   0e00     MOVLW     0x0                                                                                             
0003a6   27c2     ADDWF     0xc2,0x1,0x1                                                                                    
0003a8   0e06     MOVLW     0x6                                                                                             
0003aa   23c3     ADDWFC    0xc3,0x1,0x1                                                                                    
0003ac   0107     MOVLB     0x7                                                                                             
0003ae   0e40     MOVLW     0x40                                                                                            
0003b0   6fc6     MOVWF     0xc6,0x1                                                                                        
0003b2   0107     MOVLB     0x7                                                                                             
0003b4   6bc7     CLRF      0xc7,0x1                                                                                        
0003b6   0107     MOVLB     0x7                                                                                             
0003b8   0e01     MOVLW     0x1                                                                                             
0003ba   6fc1     MOVWF     0xc1,0x1                                                                                        
0003bc   0e40     MOVLW     0x40           								Index += 64;                                                             E:\usb20\scope\main.c
0003be   0107     MOVLB     0x7                                                                                             
0003c0   27dc     ADDWF     0xdc,0x1,0x1                                                                                    
0003c2   0e00     MOVLW     0x0                                                                                             
0003c4   23dd     ADDWFC    0xdd,0x1,0x1                                                                                    
                                           							}                                                                         E:\usb20\scope\main.c
0003c6   d001     BRA       0x3ca          							else							// 送信完了でステートリセット                                  E:\usb20\scope\main.c
0003c8   6bdb     CLRF      0xdb,0x1       								State = 0;                                                               E:\usb20\scope\main.c
                                           						}                                                                          E:\usb20\scope\main.c
0003ca   d01f     BRA       0x40a          		    				break;                                                                 E:\usb20\scope\main.c
                                           		    			case '4':								// フルーラン指定                                      E:\usb20\scope\main.c
0003cc   0107     MOVLB     0x7                       				State = 0;							// ステート初期状態セット                        E:\usb20\scope\main.c
0003ce   6bdb     CLRF      0xdb,0x1                                                                                        
0003d0   80cd     BSF       0xcd,0x0,0x0              				T1CONbits.TMR1ON = 1;					// タイマ１スタート                     E:\usb20\scope\main.c
0003d2   c061     MOVFF     0x61,0xe7                 				Threshold = (byte)input_buffer[1];		// スレッショルド取得         E:\usb20\scope\main.c
0003d4   f0e7                                                                                                               
0003d6   c062     MOVFF     0x62,0xe8                 				Sample = (byte)input_buffer[2];			// サンプリング周期取得         E:\usb20\scope\main.c
0003d8   f0e8                                                                                                               
0003da   0100     MOVLB     0x0                       				CCPR1 = Period * Sample;				// 周期設定10usec単位                 E:\usb20\scope\main.c
0003dc   51e8     MOVF      0xe8,0x0,0x1                                                                                    
0003de   6e14     MOVWF     0x14,0x0                                                                                        
0003e0   6a15     CLRF      0x15,0x0                                                                                        
0003e2   c0e2     MOVFF     0xe2,0x6                                                                                        
0003e4   f006                                                                                                               
0003e6   c0e3     MOVFF     0xe3,0x7                                                                                        
0003e8   f007                                                                                                               
0003ea   c014     MOVFF     0x14,0xb                                                                                        
0003ec   f00b                                                                                                               
0003ee   c015     MOVFF     0x15,0xc                                                                                        
0003f0   f00c                                                                                                               
0003f2   ec36     CALL      0x106c,0x0                                                                                      
0003f4   f008                                                                                                               
0003f6   c004     MOVFF     0x4,0xfbe                                                                                       
0003f8   ffbe                                                                                                               
0003fa   c005     MOVFF     0x5,0xfbf                                                                                       
0003fc   ffbf                                                                                                               
0003fe   c063     MOVFF     0x63,0xe9                  				Channel = (byte)input_buffer[3];		// チャネル番号設定          				 E:\usb20\scope\main.c
000400   f0e9                                                                                                               
000402   0100     MOVLB     0x0            	    					FreeFlag = 1;							// フリーランオン          				                    E:\usb20\scope\main.c
000404   0e01     MOVLW     0x1                                                                                             
000406   6fe4     MOVWF     0xe4,0x1                                                                                        
000408   d000     BRA       0x40a                     				break;			    			                                                  E:\usb20\scope\main.c
0002a2   d0b3     BRA       0x40a          		    			default: break;                                                         E:\usb20\scope\main.c
                                           		    		}                                                                        E:\usb20\scope\main.c
                                               			}                                                                         E:\usb20\scope\main.c
                                               		}                                                                          E:\usb20\scope\main.c
                                                }                                                                           E:\usb20\scope\main.c
00040c   6ef5     MOVWF     0xf5,0x0       }                                                                                E:\usb20\scope\main.c
00040e   0e02     MOVLW     0x2                                                                                             
000410   5ce1     SUBWF     0xe1,0x0,0x0                                                                                    
000412   e202     BC        0x418                                                                                           
000414   6ae1     CLRF      0xe1,0x0                                                                                        
000416   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000418   6ee1     MOVWF     0xe1,0x0                                                                                        
00041a   50f5     MOVF      0xf5,0x0,0x0                                                                                    
00041c   52e5     MOVF      0xe5,0x1,0x0                                                                                    
00041e   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
000420   ffd9                                                                                                               
000422   0012     RETURN    0x0                                                                                             
                                                                                                                            E:\usb20\scope\main.c
                                           /*********************************************************************           E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            *                Microchip USB C18 Firmware Version 1.0                         E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            *********************************************************************           E:\usb20\scope\autofiles\usbdsc.c
                                            * FileName:        usbdsc.c                                                     E:\usb20\scope\autofiles\usbdsc.c
                                            * Dependencies:    See INCLUDES section below                                   E:\usb20\scope\autofiles\usbdsc.c
                                            * Processor:       PIC18                                                        E:\usb20\scope\autofiles\usbdsc.c
                                            * Compiler:        C18 2.30.01+                                                 E:\usb20\scope\autofiles\usbdsc.c
                                            * Company:         Microchip Technology, Inc.                                   E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            * Software License Agreement                                                    E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            * The software supplied herewith by Microchip Technology Incorporated           E:\usb20\scope\autofiles\usbdsc.c
                                            * (the 鼎ompany・ for its PICmicroｮ Microcontroller is intended and             E:\usb20\scope\autofiles\usbdsc.c
                                            * supplied to you, the Company痴 customer, for use solely and                   E:\usb20\scope\autofiles\usbdsc.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               E:\usb20\scope\autofiles\usbdsc.c
                                            * software is owned by the Company and/or its supplier, and is                  E:\usb20\scope\autofiles\usbdsc.c
                                            * protected under applicable copyright laws. All rights are reserved.           E:\usb20\scope\autofiles\usbdsc.c
                                            * Any use in violation of the foregoing restrictions may subject the            E:\usb20\scope\autofiles\usbdsc.c
                                            * user to criminal sanctions under applicable laws, as well as to               E:\usb20\scope\autofiles\usbdsc.c
                                            * civil liability for the breach of the terms and conditions of this            E:\usb20\scope\autofiles\usbdsc.c
                                            * license.                                                                      E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            * THIS SOFTWARE IS PROVIDED IN AN 鄭S IS・CONDITION. NO WARRANTIES,             E:\usb20\scope\autofiles\usbdsc.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             E:\usb20\scope\autofiles\usbdsc.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   E:\usb20\scope\autofiles\usbdsc.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             E:\usb20\scope\autofiles\usbdsc.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    E:\usb20\scope\autofiles\usbdsc.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            ********************************************************************/           E:\usb20\scope\autofiles\usbdsc.c
                                                                                                                            E:\usb20\scope\autofiles\usbdsc.c
                                           /*********************************************************************           E:\usb20\scope\autofiles\usbdsc.c
                                            * -usbdsc.c-                                                                    E:\usb20\scope\autofiles\usbdsc.c
                                            * This file contains the USB descriptor information. It is used                 E:\usb20\scope\autofiles\usbdsc.c
                                            * in conjunction with the usbdsc.h file. When a descriptor is added             E:\usb20\scope\autofiles\usbdsc.c
                                            * or removed from the main configuration descriptor, i.e. CFG01,                E:\usb20\scope\autofiles\usbdsc.c
                                            * the user must also change the descriptor structure defined in                 E:\usb20\scope\autofiles\usbdsc.c
                                            * the usbdsc.h file. The structure is used to calculate the                     E:\usb20\scope\autofiles\usbdsc.c
                                            * descriptor size, i.e. sizeof(CFG01).                                          E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            * A typical configuration descriptor consists of:                               E:\usb20\scope\autofiles\usbdsc.c
                                            * At least one configuration descriptor (USB_CFG_DSC)                           E:\usb20\scope\autofiles\usbdsc.c
                                            * One or more interface descriptors (USB_INTF_DSC)                              E:\usb20\scope\autofiles\usbdsc.c
                                            * One or more endpoint descriptors (USB_EP_DSC)                                 E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            * Naming Convention:                                                            E:\usb20\scope\autofiles\usbdsc.c
                                            * To resolve ambiguity, the naming convention are as followed:                  E:\usb20\scope\autofiles\usbdsc.c
                                            * - USB_CFG_DSC type should be named cdxx, where xx is the                      E:\usb20\scope\autofiles\usbdsc.c
                                            *   configuration number. This number should match the actual                   E:\usb20\scope\autofiles\usbdsc.c
                                            *   index value of this configuration.                                          E:\usb20\scope\autofiles\usbdsc.c
                                            * - USB_INTF_DSC type should be named i<yy>a<zz>, where yy is the               E:\usb20\scope\autofiles\usbdsc.c
                                            *   interface number and zz is the alternate interface number.                  E:\usb20\scope\autofiles\usbdsc.c
                                            * - USB_EP_DSC type should be named ep<##><d>_i<yy>a<zz>, where                 E:\usb20\scope\autofiles\usbdsc.c
                                            *   ## is the endpoint number and d is the direction of transfer.               E:\usb20\scope\autofiles\usbdsc.c
                                            *   The interface name should also be listed as a suffix to identify            E:\usb20\scope\autofiles\usbdsc.c
                                            *   which interface does the endpoint belong to.                                E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            * Example:                                                                      E:\usb20\scope\autofiles\usbdsc.c
                                            * If a device has one configuration, two interfaces; interface 0                E:\usb20\scope\autofiles\usbdsc.c
                                            * has two endpoints (in and out), and interface 1 has one endpoint(in).         E:\usb20\scope\autofiles\usbdsc.c
                                            * Then the CFG01 structure in the usbdsc.h should be:                           E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            * #define CFG01 rom struct                            \                         E:\usb20\scope\autofiles\usbdsc.c
                                            * {   USB_CFG_DSC             cd01;                   \                         E:\usb20\scope\autofiles\usbdsc.c
                                            *     USB_INTF_DSC            i00a00;                 \                         E:\usb20\scope\autofiles\usbdsc.c
                                            *     USB_EP_DSC              ep01o_i00a00;           \                         E:\usb20\scope\autofiles\usbdsc.c
                                            *     USB_EP_DSC              ep01i_i00a00;           \                         E:\usb20\scope\autofiles\usbdsc.c
                                            *     USB_INTF_DSC            i01a00;                 \                         E:\usb20\scope\autofiles\usbdsc.c
                                            *     USB_EP_DSC              ep02i_i01a00;           \                         E:\usb20\scope\autofiles\usbdsc.c
                                            * } cfg01                                                                       E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            * Note the hierarchy of the descriptors above, it follows the USB               E:\usb20\scope\autofiles\usbdsc.c
                                            * specification requirement. All endpoints belonging to an interface            E:\usb20\scope\autofiles\usbdsc.c
                                            * should be listed immediately after that interface.                            E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            * -------------------------------------------------------------------           E:\usb20\scope\autofiles\usbdsc.c
                                            * Filling in the descriptor values in the usbdsc.c file:                        E:\usb20\scope\autofiles\usbdsc.c
                                            * -------------------------------------------------------------------           E:\usb20\scope\autofiles\usbdsc.c
                                            * Most items should be self-explanatory, however, a few will be                 E:\usb20\scope\autofiles\usbdsc.c
                                            * explained for clarification.                                                  E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            * [Configuration Descriptor(USB_CFG_DSC)]                                       E:\usb20\scope\autofiles\usbdsc.c
                                            * The configuration attribute must always have the _DEFAULT                     E:\usb20\scope\autofiles\usbdsc.c
                                            * definition at the minimum. Additional options can be ORed                     E:\usb20\scope\autofiles\usbdsc.c
                                            * to the _DEFAULT attribute. Available options are _SELF and _RWU.              E:\usb20\scope\autofiles\usbdsc.c
                                            * These definitions are defined in the usbdefs_std_dsc.h file. The              E:\usb20\scope\autofiles\usbdsc.c
                                            * _SELF tells the USB host that this device is self-powered. The                E:\usb20\scope\autofiles\usbdsc.c
                                            * _RWU tells the USB host that this device supports Remote Wakeup.              E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            * [Endpoint Descriptor(USB_EP_DSC)]                                             E:\usb20\scope\autofiles\usbdsc.c
                                            * Assume the following example:                                                 E:\usb20\scope\autofiles\usbdsc.c
                                            * sizeof(USB_EP_DSC),DSC_EP,_EP01_OUT,_BULK,64,0x00                             E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            * The first two parameters are self-explanatory. They specify the               E:\usb20\scope\autofiles\usbdsc.c
                                            * length of this endpoint descriptor (7) and the descriptor type.               E:\usb20\scope\autofiles\usbdsc.c
                                            * The next parameter identifies the endpoint, the definitions are               E:\usb20\scope\autofiles\usbdsc.c
                                            * defined in usbdefs_std_dsc.h and has the following naming                     E:\usb20\scope\autofiles\usbdsc.c
                                            * convention:                                                                   E:\usb20\scope\autofiles\usbdsc.c
                                            * _EP<##>_<dir>                                                                 E:\usb20\scope\autofiles\usbdsc.c
                                            * where ## is the endpoint number and dir is the direction of                   E:\usb20\scope\autofiles\usbdsc.c
                                            * transfer. The dir has the value of either 'OUT' or 'IN'.                      E:\usb20\scope\autofiles\usbdsc.c
                                            * The next parameter identifies the type of the endpoint. Available             E:\usb20\scope\autofiles\usbdsc.c
                                            * options are _BULK, _INT, _ISO, and _CTRL. The _CTRL is not                    E:\usb20\scope\autofiles\usbdsc.c
                                            * typically used because the default control transfer endpoint is               E:\usb20\scope\autofiles\usbdsc.c
                                            * not defined in the USB descriptors. When _ISO option is used,                 E:\usb20\scope\autofiles\usbdsc.c
                                            * addition options can be ORed to _ISO. Example:                                E:\usb20\scope\autofiles\usbdsc.c
                                            * _ISO|_AD|_FE                                                                  E:\usb20\scope\autofiles\usbdsc.c
                                            * This describes the endpoint as an isochronous pipe with adaptive              E:\usb20\scope\autofiles\usbdsc.c
                                            * and feedback attributes. See usbdefs_std_dsc.h and the USB                    E:\usb20\scope\autofiles\usbdsc.c
                                            * specification for details. The next parameter defines the size of             E:\usb20\scope\autofiles\usbdsc.c
                                            * the endpoint. The last parameter in the polling interval.                     E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            * -------------------------------------------------------------------           E:\usb20\scope\autofiles\usbdsc.c
                                            * Adding a USB String                                                           E:\usb20\scope\autofiles\usbdsc.c
                                            * -------------------------------------------------------------------           E:\usb20\scope\autofiles\usbdsc.c
                                            * A string descriptor array should have the following format:                   E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            * rom struct{byte bLength;byte bDscType;word string[size];}sdxxx={              E:\usb20\scope\autofiles\usbdsc.c
                                            * sizeof(sdxxx),DSC_STR,<text>};                                                E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            * The above structure provides a means for the C compiler to                    E:\usb20\scope\autofiles\usbdsc.c
                                            * calculate the length of string descriptor sdxxx, where xxx is the             E:\usb20\scope\autofiles\usbdsc.c
                                            * index number. The first two bytes of the descriptor are descriptor            E:\usb20\scope\autofiles\usbdsc.c
                                            * length and type. The rest <text> are string texts which must be               E:\usb20\scope\autofiles\usbdsc.c
                                            * in the unicode format. The unicode format is achieved by declaring            E:\usb20\scope\autofiles\usbdsc.c
                                            * each character as a word type. The whole text string is declared              E:\usb20\scope\autofiles\usbdsc.c
                                            * as a word array with the number of characters equals to <size>.               E:\usb20\scope\autofiles\usbdsc.c
                                            * <size> has to be manually counted and entered into the array                  E:\usb20\scope\autofiles\usbdsc.c
                                            * declaration. Let's study this through an example:                             E:\usb20\scope\autofiles\usbdsc.c
                                            * if the string is "USB" , then the string descriptor should be:                E:\usb20\scope\autofiles\usbdsc.c
                                            * (Using index 02)                                                              E:\usb20\scope\autofiles\usbdsc.c
                                            * rom struct{byte bLength;byte bDscType;word string[3];}sd002={                 E:\usb20\scope\autofiles\usbdsc.c
                                            * sizeof(sd002),DSC_STR,'U','S','B'};                                           E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            * A USB project may have multiple strings and the firmware supports             E:\usb20\scope\autofiles\usbdsc.c
                                            * the management of multiple strings through a look-up table.                   E:\usb20\scope\autofiles\usbdsc.c
                                            * The look-up table is defined as:                                              E:\usb20\scope\autofiles\usbdsc.c
                                            * rom const unsigned char *rom USB_SD_Ptr[]={&sd000,&sd001,&sd002};             E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            * The above declaration has 3 strings, sd000, sd001, and sd002.                 E:\usb20\scope\autofiles\usbdsc.c
                                            * Strings can be removed or added. sd000 is a specialized string                E:\usb20\scope\autofiles\usbdsc.c
                                            * descriptor. It defines the language code, usually this is                     E:\usb20\scope\autofiles\usbdsc.c
                                            * US English (0x0409). The index of the string must match the index             E:\usb20\scope\autofiles\usbdsc.c
                                            * position of the USB_SD_Ptr array, &sd000 must be in position                  E:\usb20\scope\autofiles\usbdsc.c
                                            * USB_SD_Ptr[0], &sd001 must be in position USB_SD_Ptr[1] and so on.            E:\usb20\scope\autofiles\usbdsc.c
                                            * The look-up table USB_SD_Ptr is used by the get string handler                E:\usb20\scope\autofiles\usbdsc.c
                                            * function in usb9.c.                                                           E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            * -------------------------------------------------------------------           E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            * The look-up table scheme also applies to the configuration                    E:\usb20\scope\autofiles\usbdsc.c
                                            * descriptor. A USB device may have multiple configuration                      E:\usb20\scope\autofiles\usbdsc.c
                                            * descriptors, i.e. CFG01, CFG02, etc. To add a configuration                   E:\usb20\scope\autofiles\usbdsc.c
                                            * descriptor, user must implement a structure similar to CFG01.                 E:\usb20\scope\autofiles\usbdsc.c
                                            * The next step is to add the configuration descriptor name, i.e.               E:\usb20\scope\autofiles\usbdsc.c
                                            * cfg01, cfg02,.., to the look-up table USB_CD_Ptr. USB_CD_Ptr[0]               E:\usb20\scope\autofiles\usbdsc.c
                                            * is a dummy place holder since configuration 0 is the un-configured            E:\usb20\scope\autofiles\usbdsc.c
                                            * state according to the definition in the USB specification.                   E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            ********************************************************************/           E:\usb20\scope\autofiles\usbdsc.c
                                                                                                                            E:\usb20\scope\autofiles\usbdsc.c
                                           /*********************************************************************           E:\usb20\scope\autofiles\usbdsc.c
                                            * Descriptor specific type definitions are defined in:                          E:\usb20\scope\autofiles\usbdsc.c
                                            * system\usb\usbdefs\usbdefs_std_dsc.h                                          E:\usb20\scope\autofiles\usbdsc.c
                                            *                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                            * Configuration information is defined in:                                      E:\usb20\scope\autofiles\usbdsc.c
                                            * autofiles\usbcfg.h                                                            E:\usb20\scope\autofiles\usbdsc.c
                                            ********************************************************************/           E:\usb20\scope\autofiles\usbdsc.c
                                                                                                                            E:\usb20\scope\autofiles\usbdsc.c
                                           /** I N C L U D E S *************************************************/           E:\usb20\scope\autofiles\usbdsc.c
                                           #include "system\typedefs.h"                                                     E:\usb20\scope\autofiles\usbdsc.c
                                           #include "system\usb\usb.h"                                                      E:\usb20\scope\autofiles\usbdsc.c
                                                                                                                            E:\usb20\scope\autofiles\usbdsc.c
                                           /** C O N S T A N T S ************************************************/          E:\usb20\scope\autofiles\usbdsc.c
                                           #pragma romdata                                                                  E:\usb20\scope\autofiles\usbdsc.c
                                                                                                                            E:\usb20\scope\autofiles\usbdsc.c
                                           /* Device Descriptor */                                                          E:\usb20\scope\autofiles\usbdsc.c
                                           rom USB_DEV_DSC device_dsc=                                                      E:\usb20\scope\autofiles\usbdsc.c
                                           {                                                                                E:\usb20\scope\autofiles\usbdsc.c
                                               sizeof(USB_DEV_DSC),    // Size of this descriptor in bytes                  E:\usb20\scope\autofiles\usbdsc.c
                                               DSC_DEV,                // DEVICE descriptor type                            E:\usb20\scope\autofiles\usbdsc.c
                                               0x0200,                 // USB Spec Release Number in BCD format             E:\usb20\scope\autofiles\usbdsc.c
                                               CDC_DEVICE,             // Class Code 0x02                                   E:\usb20\scope\autofiles\usbdsc.c
                                               0x00,                   // Subclass code                                     E:\usb20\scope\autofiles\usbdsc.c
                                               0x00,                   // Protocol code                                     E:\usb20\scope\autofiles\usbdsc.c
                                               EP0_BUFF_SIZE,          // Max packet size for EP0, see usbcfg.h             E:\usb20\scope\autofiles\usbdsc.c
                                               0x09B9,                 // Vendor ID                                         E:\usb20\scope\autofiles\usbdsc.c
                                               0x0049,                 // Product ID: CDC RS-232 Emulation Demo             E:\usb20\scope\autofiles\usbdsc.c
                                               0x0000,                 // Device release number in BCD format               E:\usb20\scope\autofiles\usbdsc.c
                                               0x01,                   // Manufacturer string index                         E:\usb20\scope\autofiles\usbdsc.c
                                               0x02,                   // Product string index                              E:\usb20\scope\autofiles\usbdsc.c
                                               0x00,                   // Device serial number string index                 E:\usb20\scope\autofiles\usbdsc.c
                                               0x01                    // Number of possible configurations                 E:\usb20\scope\autofiles\usbdsc.c
                                           };                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                                                                                                            E:\usb20\scope\autofiles\usbdsc.c
                                           /* Configuration 1 Descriptor */                                                 E:\usb20\scope\autofiles\usbdsc.c
                                           CFG01=                                                                           E:\usb20\scope\autofiles\usbdsc.c
                                           {                                                                                E:\usb20\scope\autofiles\usbdsc.c
                                               /* Configuration Descriptor */                                               E:\usb20\scope\autofiles\usbdsc.c
                                               sizeof(USB_CFG_DSC),    // Size of this descriptor in bytes                  E:\usb20\scope\autofiles\usbdsc.c
                                               DSC_CFG,                // CONFIGURATION descriptor type                     E:\usb20\scope\autofiles\usbdsc.c
                                               sizeof(cfg01),          // Total length of data for this cfg                 E:\usb20\scope\autofiles\usbdsc.c
                                               2,                      // Number of interfaces in this cfg                  E:\usb20\scope\autofiles\usbdsc.c
                                               1,                      // Index value of this configuration                 E:\usb20\scope\autofiles\usbdsc.c
                                               0,                      // Configuration string index                        E:\usb20\scope\autofiles\usbdsc.c
                                               _DEFAULT,               // Attributes, see usbdefs_std_dsc.h                 E:\usb20\scope\autofiles\usbdsc.c
                                               50,                     // Max power consumption (2X mA)                     E:\usb20\scope\autofiles\usbdsc.c
                                                                                                                            E:\usb20\scope\autofiles\usbdsc.c
                                               /* Interface Descriptor */                                                   E:\usb20\scope\autofiles\usbdsc.c
                                               sizeof(USB_INTF_DSC),   // Size of this descriptor in bytes                  E:\usb20\scope\autofiles\usbdsc.c
                                               DSC_INTF,               // INTERFACE descriptor type                         E:\usb20\scope\autofiles\usbdsc.c
                                               0,                      // Interface Number                                  E:\usb20\scope\autofiles\usbdsc.c
                                               0,                      // Alternate Setting Number                          E:\usb20\scope\autofiles\usbdsc.c
                                               1,                      // Number of endpoints in this intf                  E:\usb20\scope\autofiles\usbdsc.c
                                               COMM_INTF,              // Class code                                        E:\usb20\scope\autofiles\usbdsc.c
                                               ABSTRACT_CONTROL_MODEL, // Subclass code                                     E:\usb20\scope\autofiles\usbdsc.c
                                               V25TER,                 // Protocol code                                     E:\usb20\scope\autofiles\usbdsc.c
                                               0,                      // Interface string index                            E:\usb20\scope\autofiles\usbdsc.c
                                                                                                                            E:\usb20\scope\autofiles\usbdsc.c
                                               /* CDC Class-Specific Descriptors */                                         E:\usb20\scope\autofiles\usbdsc.c
                                               sizeof(USB_CDC_HEADER_FN_DSC),CS_INTERFACE,DSC_FN_HEADER,0x0110,             E:\usb20\scope\autofiles\usbdsc.c
                                               sizeof(USB_CDC_ACM_FN_DSC),CS_INTERFACE,DSC_FN_ACM,0x02,                     E:\usb20\scope\autofiles\usbdsc.c
                                               sizeof(USB_CDC_UNION_FN_DSC),CS_INTERFACE,DSC_FN_UNION,CDC_COMM_INTF_ID,CDC_DATA_INTF_ID, E:\usb20\scope\autofiles\usbdsc.c
                                               sizeof(USB_CDC_CALL_MGT_FN_DSC),CS_INTERFACE,DSC_FN_CALL_MGT,0x00,CDC_DATA_INTF_ID, E:\usb20\scope\autofiles\usbdsc.c
                                                                                                                            E:\usb20\scope\autofiles\usbdsc.c
                                               /* Endpoint Descriptor */                                                    E:\usb20\scope\autofiles\usbdsc.c
                                               sizeof(USB_EP_DSC),DSC_EP,_EP02_IN,_INT,CDC_INT_EP_SIZE,0x02,                E:\usb20\scope\autofiles\usbdsc.c
                                                                                                                            E:\usb20\scope\autofiles\usbdsc.c
                                               /* Interface Descriptor */                                                   E:\usb20\scope\autofiles\usbdsc.c
                                               sizeof(USB_INTF_DSC),   // Size of this descriptor in bytes                  E:\usb20\scope\autofiles\usbdsc.c
                                               DSC_INTF,               // INTERFACE descriptor type                         E:\usb20\scope\autofiles\usbdsc.c
                                               1,                      // Interface Number                                  E:\usb20\scope\autofiles\usbdsc.c
                                               0,                      // Alternate Setting Number                          E:\usb20\scope\autofiles\usbdsc.c
                                               2,                      // Number of endpoints in this intf                  E:\usb20\scope\autofiles\usbdsc.c
                                               DATA_INTF,              // Class code                                        E:\usb20\scope\autofiles\usbdsc.c
                                               0,                      // Subclass code                                     E:\usb20\scope\autofiles\usbdsc.c
                                               NO_PROTOCOL,            // Protocol code                                     E:\usb20\scope\autofiles\usbdsc.c
                                               0,                      // Interface string index                            E:\usb20\scope\autofiles\usbdsc.c
                                                                                                                            E:\usb20\scope\autofiles\usbdsc.c
                                               /* Endpoint Descriptors */                                                   E:\usb20\scope\autofiles\usbdsc.c
                                               sizeof(USB_EP_DSC),DSC_EP,_EP03_OUT,_BULK,CDC_BULK_OUT_EP_SIZE,0x00,         E:\usb20\scope\autofiles\usbdsc.c
                                               sizeof(USB_EP_DSC),DSC_EP,_EP03_IN,_BULK,CDC_BULK_IN_EP_SIZE,0x00            E:\usb20\scope\autofiles\usbdsc.c
                                           };                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                                                                                                            E:\usb20\scope\autofiles\usbdsc.c
                                           rom struct{byte bLength;byte bDscType;word string[1];}sd000={                    E:\usb20\scope\autofiles\usbdsc.c
                                           sizeof(sd000),DSC_STR,0x0409};                                                   E:\usb20\scope\autofiles\usbdsc.c
                                                                                                                            E:\usb20\scope\autofiles\usbdsc.c
                                           rom struct{byte bLength;byte bDscType;word string[20];}sd001={                   E:\usb20\scope\autofiles\usbdsc.c
                                           sizeof(sd001),DSC_STR,                                                           E:\usb20\scope\autofiles\usbdsc.c
                                           'M','i','c','r','o','c','h','i','p',' ',                                         E:\usb20\scope\autofiles\usbdsc.c
                                           'D','e','s','i','g','n',' ','L','a','b'};                                        E:\usb20\scope\autofiles\usbdsc.c
                                                                                                                            E:\usb20\scope\autofiles\usbdsc.c
                                           rom struct{byte bLength;byte bDscType;word string[16];}sd002={                   E:\usb20\scope\autofiles\usbdsc.c
                                           sizeof(sd002),DSC_STR,                                                           E:\usb20\scope\autofiles\usbdsc.c
                                           'O','s','s','i','r','o','s','c','o','p',                                         E:\usb20\scope\autofiles\usbdsc.c
                                           'e',' ','D','e','m','o'};                                                        E:\usb20\scope\autofiles\usbdsc.c
                                                                                                                            E:\usb20\scope\autofiles\usbdsc.c
                                           rom const unsigned char *rom USB_CD_Ptr[]={&cfg01,&cfg01};                       E:\usb20\scope\autofiles\usbdsc.c
                                           rom const unsigned char *rom USB_SD_Ptr[]={&sd000,&sd001,&sd002};                E:\usb20\scope\autofiles\usbdsc.c
                                                                                                                            E:\usb20\scope\autofiles\usbdsc.c
                                           rom pFunc ClassReqHandler[1]=                                                    E:\usb20\scope\autofiles\usbdsc.c
                                           {                                                                                E:\usb20\scope\autofiles\usbdsc.c
                                               &USBCheckCDCRequest                                                          E:\usb20\scope\autofiles\usbdsc.c
                                           };                                                                               E:\usb20\scope\autofiles\usbdsc.c
                                                                                                                            E:\usb20\scope\autofiles\usbdsc.c
                                           #pragma code                                                                     E:\usb20\scope\autofiles\usbdsc.c
                                                                                                                            E:\usb20\scope\autofiles\usbdsc.c
                                           /** EOF usbdsc.c ****************************************************/           E:\usb20\scope\autofiles\usbdsc.c
                                           /*********************************************************************           E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            *                Microchip USB C18 Firmware Version 1.0                         E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            *********************************************************************           E:\usb20\scope\system\usb\usbmmap.c
                                            * FileName:        usbmmap.c                                                    E:\usb20\scope\system\usb\usbmmap.c
                                            * Dependencies:    See INCLUDES section below                                   E:\usb20\scope\system\usb\usbmmap.c
                                            * Processor:       PIC18                                                        E:\usb20\scope\system\usb\usbmmap.c
                                            * Compiler:        C18 2.30.01+                                                 E:\usb20\scope\system\usb\usbmmap.c
                                            * Company:         Microchip Technology, Inc.                                   E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * Software License Agreement                                                    E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * The software supplied herewith by Microchip Technology Incorporated           E:\usb20\scope\system\usb\usbmmap.c
                                            * (the 鼎ompany) for its PICmicroｮ Microcontroller is intended and             E:\usb20\scope\system\usb\usbmmap.c
                                            * supplied to you, the Company痴 customer, for use solely and                   E:\usb20\scope\system\usb\usbmmap.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               E:\usb20\scope\system\usb\usbmmap.c
                                            * software is owned by the Company and/or its supplier, and is                  E:\usb20\scope\system\usb\usbmmap.c
                                            * protected under applicable copyright laws. All rights are reserved.           E:\usb20\scope\system\usb\usbmmap.c
                                            * Any use in violation of the foregoing restrictions may subject the            E:\usb20\scope\system\usb\usbmmap.c
                                            * user to criminal sanctions under applicable laws, as well as to               E:\usb20\scope\system\usb\usbmmap.c
                                            * civil liability for the breach of the terms and conditions of this            E:\usb20\scope\system\usb\usbmmap.c
                                            * license.                                                                      E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * THIS SOFTWARE IS PROVIDED IN AN 鄭S IS CONDITION. NO WARRANTIES,             E:\usb20\scope\system\usb\usbmmap.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             E:\usb20\scope\system\usb\usbmmap.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   E:\usb20\scope\system\usb\usbmmap.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             E:\usb20\scope\system\usb\usbmmap.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    E:\usb20\scope\system\usb\usbmmap.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * Author               Date        Comment                                      E:\usb20\scope\system\usb\usbmmap.c
                                            *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           E:\usb20\scope\system\usb\usbmmap.c
                                            * Rawin Rojvanit       11/19/04    Original.                                    E:\usb20\scope\system\usb\usbmmap.c
                                            ********************************************************************/           E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbmmap.c
                                            * -usbmmap.c-                                                                   E:\usb20\scope\system\usb\usbmmap.c
                                            * USB Memory Map                                                                E:\usb20\scope\system\usb\usbmmap.c
                                            * This file is the USB memory manager; it serves as a compile-time memory       E:\usb20\scope\system\usb\usbmmap.c
                                            * allocator for the USB endpoints. It uses the compile time options passed      E:\usb20\scope\system\usb\usbmmap.c
                                            * from usbcfg.h to instantiate endpoints and endpoint buffer.                   E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * Each endpoint requires to have a set of Buffer Descriptor registers(BDT).     E:\usb20\scope\system\usb\usbmmap.c
                                            * A BDT is 4-byte long and has a specific RAM location for each endpoint.       E:\usb20\scope\system\usb\usbmmap.c
                                            * The BDT for endpoint 0 out is located at address 0x400 to 0x403.              E:\usb20\scope\system\usb\usbmmap.c
                                            * The BDT for endpoint 0 in is located at address 0x404 to 0x407.               E:\usb20\scope\system\usb\usbmmap.c
                                            * The BDT for endpoint 1 out is located at address 0x408 to 0x40B.              E:\usb20\scope\system\usb\usbmmap.c
                                            * and so on... The above allocation assumes the Ping-Pong Buffer Mode 0 is      E:\usb20\scope\system\usb\usbmmap.c
                                            * used. These locations are already hard-wired in the silicon. The point        E:\usb20\scope\system\usb\usbmmap.c
                                            * of doing instantiation, i.e. volatile far BDT ep0Bo;, is to provide the       E:\usb20\scope\system\usb\usbmmap.c
                                            * C compiler a way to address each variable directly. This is very important    E:\usb20\scope\system\usb\usbmmap.c
                                            * because when a register can be accessed directly, it saves execution time     E:\usb20\scope\system\usb\usbmmap.c
                                            * and reduces program size.                                                     E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * Endpoints are defined using the endpoint number and the direction             E:\usb20\scope\system\usb\usbmmap.c
                                            * of transfer. For simplicity, usbmmap.c only uses the endpoint number          E:\usb20\scope\system\usb\usbmmap.c
                                            * in the BDT register allocation scheme. This means if the usbcfg.h states      E:\usb20\scope\system\usb\usbmmap.c
                                            * that the MAX_EP_NUMBER is number 1, then four BDTs will be                    E:\usb20\scope\system\usb\usbmmap.c
                                            * instantiated: one each for endpoint0 in and endpoint0 out, which must         E:\usb20\scope\system\usb\usbmmap.c
                                            * always be instantiated for control transfer by default, and one each sets     E:\usb20\scope\system\usb\usbmmap.c
                                            * for endpoint1 in and endpoint1 out. The naming convention for instantiating   E:\usb20\scope\system\usb\usbmmap.c
                                            * BDT is                                                                        E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * ep<#>B<d>                                                                     E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * where # is the endpoint number, and d is the direction of                     E:\usb20\scope\system\usb\usbmmap.c
                                            * transfer, which could be either <i> or <o>.                                   E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * The USB memory manager uses MAX_EP_NUMBER, as defined in usbcfg.h, to define  E:\usb20\scope\system\usb\usbmmap.c
                                            * the endpoints to be instantiated. This represents the highest endpoint        E:\usb20\scope\system\usb\usbmmap.c
                                            * number to be allocated, not how many endpoints are used. Since the BDTs for   E:\usb20\scope\system\usb\usbmmap.c
                                            * endpoints have hardware-assigned addresses in Bank 4, setting this value too  E:\usb20\scope\system\usb\usbmmap.c
                                            * high may lead to inefficient use of data RAM. For example, if an application  E:\usb20\scope\system\usb\usbmmap.c
                                            * uses only endpoints EP0 and EP4, then the MAX_EP_NUMBER is 4, and not 2.      E:\usb20\scope\system\usb\usbmmap.c
                                            * The in-between endpoint BDTs in this example (EP1, EP2, and EP3) go unused,   E:\usb20\scope\system\usb\usbmmap.c
                                            * and the 24 bytes of memory associated with them are wasted. It does not make  E:\usb20\scope\system\usb\usbmmap.c
                                            * much sense to skip endpoints, but the final decision lies with the user.      E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * The next step is to assign the instantiated BDTs to different                 E:\usb20\scope\system\usb\usbmmap.c
                                            * USB functions. The firmware framework fundamentally assumes that every USB    E:\usb20\scope\system\usb\usbmmap.c
                                            * function should know which endpoint it is using, i.e., the default control    E:\usb20\scope\system\usb\usbmmap.c
                                            * transfer should know that it is using endpoint 0 in and endpoint 0 out.       E:\usb20\scope\system\usb\usbmmap.c
                                            * A HID class can choose which endpoint it wants to use, but once chosen, it    E:\usb20\scope\system\usb\usbmmap.c
                                            * should always know the number of the endpoint.                                E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * The assignment of endpoints to USB functions is managed centrally             E:\usb20\scope\system\usb\usbmmap.c
                                            * in usbcfg.h. This helps prevent the mistake of having more                    E:\usb20\scope\system\usb\usbmmap.c
                                            * than one USB function using the same endpoint. The "Endpoint Allocation"      E:\usb20\scope\system\usb\usbmmap.c
                                            * section in usbcfg.h provides examples for how to map USB endpoints to USB     E:\usb20\scope\system\usb\usbmmap.c
                                            * functions.                                                                    E:\usb20\scope\system\usb\usbmmap.c
                                            * Quite a few things can be mapped in that section. There is no                 E:\usb20\scope\system\usb\usbmmap.c
                                            * one correct way to do the mapping and the user has the choice to              E:\usb20\scope\system\usb\usbmmap.c
                                            * choose a method that is most suitable to the application.                     E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * Typically, however, a user will want to map the following for a given         E:\usb20\scope\system\usb\usbmmap.c
                                            * USB interface function:                                                       E:\usb20\scope\system\usb\usbmmap.c
                                            * 1. The USB interface ID                                                       E:\usb20\scope\system\usb\usbmmap.c
                                            * 2. The endpoint control registers (UEPn)                                      E:\usb20\scope\system\usb\usbmmap.c
                                            * 3. The BDT registers (ep<#>B<d>)                                              E:\usb20\scope\system\usb\usbmmap.c
                                            * 4. The endpoint size                                                          E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * Example: Assume a USB device class "foo", which uses one out endpoint         E:\usb20\scope\system\usb\usbmmap.c
                                            *          of size 64-byte and one in endpoint of size 64-byte, then:           E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * #define FOO_INTF_ID          0x00                                             E:\usb20\scope\system\usb\usbmmap.c
                                            * #define FOO_UEP              UEP1                                             E:\usb20\scope\system\usb\usbmmap.c
                                            * #define FOO_BD_OUT           ep1Bo                                            E:\usb20\scope\system\usb\usbmmap.c
                                            * #define FOO_BD_IN            ep1Bi                                            E:\usb20\scope\system\usb\usbmmap.c
                                            * #define FOO_EP_SIZE          64                                               E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * The mapping above has chosen class "foo" to use endpoint 1.                   E:\usb20\scope\system\usb\usbmmap.c
                                            * The names are arbitrary and can be anything other than FOO_??????.            E:\usb20\scope\system\usb\usbmmap.c
                                            * For abstraction, the code for class "foo" should use the abstract             E:\usb20\scope\system\usb\usbmmap.c
                                            * definitions of FOO_BD_OUT,FOO_BD_IN, and not ep1Bo or ep1Bi.                  E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * Note that the endpoint size defined in the usbcfg.h file is again             E:\usb20\scope\system\usb\usbmmap.c
                                            * used in the usbmmap.c file. This shows that the relationship between          E:\usb20\scope\system\usb\usbmmap.c
                                            * the two files are tightly related.                                            E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * The endpoint buffer for each USB function must be located in the              E:\usb20\scope\system\usb\usbmmap.c
                                            * dual-port RAM area and has to come after all the BDTs have been               E:\usb20\scope\system\usb\usbmmap.c
                                            * instantiated. An example declaration is:                                      E:\usb20\scope\system\usb\usbmmap.c
                                            * volatile far unsigned char[FOO_EP_SIZE] data;                                 E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * The 'volatile' keyword tells the compiler not to perform any code             E:\usb20\scope\system\usb\usbmmap.c
                                            * optimization on this variable because its content could be modified           E:\usb20\scope\system\usb\usbmmap.c
                                            * by the hardware. The 'far' keyword tells the compiler that this variable      E:\usb20\scope\system\usb\usbmmap.c
                                            * is not located in the Access RAM area (0x000 - 0x05F).                        E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * For the variable to be globally accessible by other files, it should be       E:\usb20\scope\system\usb\usbmmap.c
                                            * declared in the header file usbmmap.h as an extern definition, such as        E:\usb20\scope\system\usb\usbmmap.c
                                            * extern volatile far unsigned char[FOO_EP_SIZE] data;                          E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * Conclusion:                                                                   E:\usb20\scope\system\usb\usbmmap.c
                                            * In a short summary, the dependencies between usbcfg and usbmmap can           E:\usb20\scope\system\usb\usbmmap.c
                                            * be shown as:                                                                  E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * usbcfg[MAX_EP_NUMBER] -> usbmmap                                              E:\usb20\scope\system\usb\usbmmap.c
                                            * usbmmap[ep<#>B<d>] -> usbcfg                                                  E:\usb20\scope\system\usb\usbmmap.c
                                            * usbcfg[EP size] -> usbmmap                                                    E:\usb20\scope\system\usb\usbmmap.c
                                            * usbcfg[abstract ep definitions] -> usb9/hid/cdc/etc class code                E:\usb20\scope\system\usb\usbmmap.c
                                            * usbmmap[endpoint buffer variable] -> usb9/hid/cdc/etc class code              E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * Data mapping provides a means for direct addressing of BDT and endpoint       E:\usb20\scope\system\usb\usbmmap.c
                                            * buffer. This means less usage of pointers, which equates to a faster and      E:\usb20\scope\system\usb\usbmmap.c
                                            * smaller program code.                                                         E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           /** I N C L U D E S **********************************************************/  E:\usb20\scope\system\usb\usbmmap.c
                                           #include "system\typedefs.h"                                                     E:\usb20\scope\system\usb\usbmmap.c
                                           #include "system\usb\usb.h"                                                      E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           /** U S B  G L O B A L  V A R I A B L E S ************************************/  E:\usb20\scope\system\usb\usbmmap.c
                                           #pragma udata                                                                    E:\usb20\scope\system\usb\usbmmap.c
                                           byte usb_device_state;          // Device States: DETACHED, ATTACHED, ...        E:\usb20\scope\system\usb\usbmmap.c
                                           USB_DEVICE_STATUS usb_stat;     // Global USB flags                              E:\usb20\scope\system\usb\usbmmap.c
                                           byte usb_active_cfg;            // Value of current configuration                E:\usb20\scope\system\usb\usbmmap.c
                                           byte usb_alt_intf[MAX_NUM_INT]; // Array to keep track of the current alternate  E:\usb20\scope\system\usb\usbmmap.c
                                                                           // setting for each interface ID                 E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           /** U S B  F I X E D  L O C A T I O N  V A R I A B L E S *********************/  E:\usb20\scope\system\usb\usbmmap.c
                                           #pragma udata usbram4=0x400     //See Linker Script,usb4:0x400-0x4FF(256-byte)   E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbmmap.c
                                            * Section A: Buffer Descriptor Table                                            E:\usb20\scope\system\usb\usbmmap.c
                                            * - 0x400 - 0x4FF(max)                                                          E:\usb20\scope\system\usb\usbmmap.c
                                            * - MAX_EP_NUMBER is defined in autofiles\usbcfg.h                              E:\usb20\scope\system\usb\usbmmap.c
                                            * - BDT data type is defined in system\usb\usbmmap.h                            E:\usb20\scope\system\usb\usbmmap.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           #if(0 <= MAX_EP_NUMBER)                                                          E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep0Bo;         //Endpoint #0 BD Out                             E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep0Bi;         //Endpoint #0 BD In                              E:\usb20\scope\system\usb\usbmmap.c
                                           #endif                                                                           E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           #if(1 <= MAX_EP_NUMBER)                                                          E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep1Bo;         //Endpoint #1 BD Out                             E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep1Bi;         //Endpoint #1 BD In                              E:\usb20\scope\system\usb\usbmmap.c
                                           #endif                                                                           E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           #if(2 <= MAX_EP_NUMBER)                                                          E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep2Bo;         //Endpoint #2 BD Out                             E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep2Bi;         //Endpoint #2 BD In                              E:\usb20\scope\system\usb\usbmmap.c
                                           #endif                                                                           E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           #if(3 <= MAX_EP_NUMBER)                                                          E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep3Bo;         //Endpoint #3 BD Out                             E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep3Bi;         //Endpoint #3 BD In                              E:\usb20\scope\system\usb\usbmmap.c
                                           #endif                                                                           E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           #if(4 <= MAX_EP_NUMBER)                                                          E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep4Bo;         //Endpoint #4 BD Out                             E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep4Bi;         //Endpoint #4 BD In                              E:\usb20\scope\system\usb\usbmmap.c
                                           #endif                                                                           E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           #if(5 <= MAX_EP_NUMBER)                                                          E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep5Bo;         //Endpoint #5 BD Out                             E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep5Bi;         //Endpoint #5 BD In                              E:\usb20\scope\system\usb\usbmmap.c
                                           #endif                                                                           E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           #if(6 <= MAX_EP_NUMBER)                                                          E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep6Bo;         //Endpoint #6 BD Out                             E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep6Bi;         //Endpoint #6 BD In                              E:\usb20\scope\system\usb\usbmmap.c
                                           #endif                                                                           E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           #if(7 <= MAX_EP_NUMBER)                                                          E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep7Bo;         //Endpoint #7 BD Out                             E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep7Bi;         //Endpoint #7 BD In                              E:\usb20\scope\system\usb\usbmmap.c
                                           #endif                                                                           E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           #if(8 <= MAX_EP_NUMBER)                                                          E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep8Bo;         //Endpoint #8 BD Out                             E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep8Bi;         //Endpoint #8 BD In                              E:\usb20\scope\system\usb\usbmmap.c
                                           #endif                                                                           E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           #if(9 <= MAX_EP_NUMBER)                                                          E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep9Bo;         //Endpoint #9 BD Out                             E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep9Bi;         //Endpoint #9 BD In                              E:\usb20\scope\system\usb\usbmmap.c
                                           #endif                                                                           E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           #if(10 <= MAX_EP_NUMBER)                                                         E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep10Bo;        //Endpoint #10 BD Out                            E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep10Bi;        //Endpoint #10 BD In                             E:\usb20\scope\system\usb\usbmmap.c
                                           #endif                                                                           E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           #if(11 <= MAX_EP_NUMBER)                                                         E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep11Bo;        //Endpoint #11 BD Out                            E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep11Bi;        //Endpoint #11 BD In                             E:\usb20\scope\system\usb\usbmmap.c
                                           #endif                                                                           E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           #if(12 <= MAX_EP_NUMBER)                                                         E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep12Bo;        //Endpoint #12 BD Out                            E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep12Bi;        //Endpoint #12 BD In                             E:\usb20\scope\system\usb\usbmmap.c
                                           #endif                                                                           E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           #if(13 <= MAX_EP_NUMBER)                                                         E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep13Bo;        //Endpoint #13 BD Out                            E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep13Bi;        //Endpoint #13 BD In                             E:\usb20\scope\system\usb\usbmmap.c
                                           #endif                                                                           E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           #if(14 <= MAX_EP_NUMBER)                                                         E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep14Bo;        //Endpoint #14 BD Out                            E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep14Bi;        //Endpoint #14 BD In                             E:\usb20\scope\system\usb\usbmmap.c
                                           #endif                                                                           E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           #if(15 <= MAX_EP_NUMBER)                                                         E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep15Bo;        //Endpoint #15 BD Out                            E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far BDT ep15Bi;        //Endpoint #15 BD In                             E:\usb20\scope\system\usb\usbmmap.c
                                           #endif                                                                           E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbmmap.c
                                            * Section B: EP0 Buffer Space                                                   E:\usb20\scope\system\usb\usbmmap.c
                                            ******************************************************************************  E:\usb20\scope\system\usb\usbmmap.c
                                            * - Two buffer areas are defined:                                               E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            *   A. CTRL_TRF_SETUP                                                           E:\usb20\scope\system\usb\usbmmap.c
                                            *      - Size = EP0_BUFF_SIZE as defined in autofiles\usbcfg.h                  E:\usb20\scope\system\usb\usbmmap.c
                                            *      - Detailed data structure allows direct adddressing of bits and bytes.   E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            *   B. CTRL_TRF_DATA                                                            E:\usb20\scope\system\usb\usbmmap.c
                                            *      - Size = EP0_BUFF_SIZE as defined in autofiles\usbcfg.h                  E:\usb20\scope\system\usb\usbmmap.c
                                            *      - Data structure allows direct adddressing of the first 8 bytes.         E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            * - Both data types are defined in system\usb\usbdefs\usbdefs_ep0_buff.h        E:\usb20\scope\system\usb\usbmmap.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far CTRL_TRF_SETUP SetupPkt;                                            E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far CTRL_TRF_DATA CtrlTrfData;                                          E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbmmap.c
                                            * Section C: CDC Buffer                                                         E:\usb20\scope\system\usb\usbmmap.c
                                            ******************************************************************************  E:\usb20\scope\system\usb\usbmmap.c
                                            *                                                                               E:\usb20\scope\system\usb\usbmmap.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbmmap.c
                                           #pragma udata usbram5a=0x500    //See Linker Script,usb5:0x500-...               E:\usb20\scope\system\usb\usbmmap.c
                                           #if defined(USB_USE_CDC)                                                         E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far unsigned char cdc_notice[CDC_INT_EP_SIZE];                          E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far unsigned char cdc_data_rx[CDC_BULK_OUT_EP_SIZE];                    E:\usb20\scope\system\usb\usbmmap.c
                                           volatile far unsigned char cdc_data_tx[CDC_BULK_IN_EP_SIZE];                     E:\usb20\scope\system\usb\usbmmap.c
                                           #endif                                                                           E:\usb20\scope\system\usb\usbmmap.c
                                           #pragma udata                                                                    E:\usb20\scope\system\usb\usbmmap.c
                                                                                                                            E:\usb20\scope\system\usb\usbmmap.c
                                           /** EOF usbmmap.c ************************************************************/  E:\usb20\scope\system\usb\usbmmap.c
                                           /*********************************************************************           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                Microchip USB C18 Firmware Version 1.0                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *********************************************************************           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * FileName:        usbdrv.c                                                     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Dependencies:    See INCLUDES section below                                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Processor:       PIC18                                                        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Compiler:        C18 2.30.01+                                                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Company:         Microchip Technology, Inc.                                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Software License Agreement                                                    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * The software supplied herewith by Microchip Technology Incorporated           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * (the 鼎ompany・ for its PICmicroｮ Microcontroller is intended and             E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * supplied to you, the Company痴 customer, for use solely and                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * software is owned by the Company and/or its supplier, and is                  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * protected under applicable copyright laws. All rights are reserved.           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Any use in violation of the foregoing restrictions may subject the            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * user to criminal sanctions under applicable laws, as well as to               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * civil liability for the breach of the terms and conditions of this            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * license.                                                                      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * THIS SOFTWARE IS PROVIDED IN AN 鄭S IS・CONDITION. NO WARRANTIES,             E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Author               Date        Comment                                      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Rawin Rojvanit       11/19/04    Original.                                    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            ********************************************************************/           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           /** I N C L U D E S **********************************************************/  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           #include <p18cxxx.h>                                                             E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           #include "system\typedefs.h"                                                     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           #include "system\usb\usb.h"                                                      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           #include "io_cfg.h"             // Required for USBCheckBusStatus()              E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           /** V A R I A B L E S ********************************************************/  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           #pragma udata                                                                    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           void USBModuleEnable(void);                                                      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           void USBModuleDisable(void);                                                     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           void USBSuspend(void);                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           void USBWakeFromSuspend(void);                                                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           void USBProtocolResetHandler(void);                                              E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           void USB_SOF_Handler(void);                                                      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           void USBStallHandler(void);                                                      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           void USBErrorHandler(void);                                                      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           /** D E C L A R A T I O N S **************************************************/  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           #pragma code                                                                     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Function:        void USBCheckBusStatus(void)                                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Overview:        This routine enables/disables the USB module by monitoring   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  the USB power signal.                                        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Note:            None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           void USBCheckBusStatus(void)                                                     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           {                                                                                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               /**************************************************************************  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * Bus Attachment & Detachment Detection                                     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * usb_bus_sense is an i/o pin defined in io_cfg.h                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                *************************************************************************/  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               #define USB_BUS_ATTACHED    1                                                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               #define USB_BUS_DETACHED    0                                                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               if(usb_bus_sense == USB_BUS_ATTACHED)       // Is USB bus attached?          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               {                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000da8   a66d     BTFSS     0x6d,0x3,0x0           if(UCONbits.USBEN == 0)                 // Is the module off?            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000daa   d80f     RCALL     0xdca                      USBModuleEnable();                  // Is off, enable it             E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               }                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000dac   d002     BRA       0xdb2              else                                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               {                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000dae   b66d     BTFSC     0x6d,0x3,0x0           if(UCONbits.USBEN == 1)                 // Is the module on?             E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000db0   d813     RCALL     0xdd8                      USBModuleDisable();                 // Is on, disable it             E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               }//end if(usb_bus_sense...)                                                  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               /*                                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * After enabling the USB module, it takes some time for the voltage         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * on the D+ or D- line to rise high enough to get out of the SE0 condition. E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * The USB Reset interrupt should not be unmasked until the SE0 condition is E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * cleared. This helps preventing the firmware from misinterpreting this     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * unique event as a USB bus reset from the USB host.                        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                */                                                                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000db2   0100     MOVLB     0x0                if(usb_device_state == ATTACHED_STATE)                                       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000db4   05fc     DECF      0xfc,0x0,0x1                                                                                    
000db6   e108     BNZ       0xdc8                                                                                           
                                               {                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000db8   ba6d     BTFSC     0x6d,0x5,0x0           if(!UCONbits.SE0)                                                        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000dba   d006     BRA       0xdc8                                                                                           
                                                   {                                                                        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000dbc   6a68     CLRF      0x68,0x0                   UIR = 0;                        // Clear all USB interrupts          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000dbe   6a69     CLRF      0x69,0x0                   UIE = 0;                        // Mask all USB interrupts           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000dc0   8069     BSF       0x69,0x0,0x0               UIEbits.URSTIE = 1;             // Unmask RESET interrupt            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000dc2   8869     BSF       0x69,0x4,0x0               UIEbits.IDLEIE = 1;             // Unmask IDLE interrupt             E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000dc4   0e02     MOVLW     0x2                        usb_device_state = POWERED_STATE;                                    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000dc6   6ffc     MOVWF     0xfc,0x1                                                                                        
                                                   }//end if                           // else wait until SE0 is cleared    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               }//end if(usb_device_state == ATTACHED_STATE)                                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000dc8   0012     RETURN    0x0            }//end USBCheckBusStatus                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Function:        void USBModuleEnable(void)                                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Overview:        This routine enables the USB module.                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  An end designer should never have to call this routine       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  manually. This routine should only be called from            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  USBCheckBusStatus().                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Note:            See USBCheckBusStatus() for more information.                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           void USBModuleEnable(void)                                                       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           {                                                                                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000dca   6a6d     CLRF      0x6d,0x0           UCON = 0;                                                                    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000dcc   6a69     CLRF      0x69,0x0           UIE = 0;                                // Mask all USB interrupts           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000dce   866d     BSF       0x6d,0x3,0x0       UCONbits.USBEN = 1;                     // Enable module & attach to bus     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000dd0   0100     MOVLB     0x0                usb_device_state = ATTACHED_STATE;      // Defined in usbmmap.c & .h         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000dd2   0e01     MOVLW     0x1                                                                                             
000dd4   6ffc     MOVWF     0xfc,0x1                                                                                        
000dd6   0012     RETURN    0x0            }//end USBModuleEnable                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Function:        void USBModuleDisable(void)                                  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Overview:        This routine disables the USB module.                        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  An end designer should never have to call this routine       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  manually. This routine should only be called from            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  USBCheckBusStatus().                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Note:            See USBCheckBusStatus() for more information.                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           void USBModuleDisable(void)                                                      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           {                                                                                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000dd8   6a6d     CLRF      0x6d,0x0           UCON = 0;                               // Disable module & detach from bus  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000dda   6a69     CLRF      0x69,0x0           UIE = 0;                                // Mask all USB interrupts           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000ddc   0100     MOVLB     0x0                usb_device_state = DETACHED_STATE;      // Defined in usbmmap.c & .h         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000dde   6bfc     CLRF      0xfc,0x1                                                                                        
000de0   0012     RETURN    0x0            }//end USBModuleDisable                                                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Function:        void USBSoftDetach(void)                                     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Side Effects:    The device will have to be re-enumerated to function again.  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Overview:        USBSoftDetach electrically disconnects the device from       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  the bus. This is done by stop supplying Vusb voltage to      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  pull-up resistor. The pull-down resistors on the host        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  side will pull both differential signal lines low and        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  the host registers the event as a disconnect.                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  Since the USB cable is not physically disconnected, the      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  power supply through the cable can still be sensed by        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  the device. The next time USBCheckBusStatus() function       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  is called, it will reconnect the device back to the bus.     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Note:            None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           void USBSoftDetach(void)                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           {                                                                                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000de2   efec     GOTO      0xdd8              USBModuleDisable();                                                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000de4   f006                                                                                                               
                                           }//end USBSoftDetach                                                             E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Function:        void USBDriverService(void)                                  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Overview:        This routine is the heart of this firmware. It manages       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  all USB interrupts.                                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Note:            Device state transitions through the following stages:       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  DETACHED -> ATTACHED -> POWERED -> DEFAULT ->                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  ADDRESS_PENDING -> ADDRESSED -> CONFIGURED -> READY          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           void USBDriverService(void)                                                      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           {                                                                                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               /*                                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * Pointless to continue servicing if USB cable is not even attached.        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                */                                                                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000de6   0100     MOVLB     0x0                if(usb_device_state == DETACHED_STATE) return;                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000de8   51fc     MOVF      0xfc,0x0,0x1                                                                                    
000dea   e101     BNZ       0xdee                                                                                           
000dec   d03a     BRA       0xe62                                                                                           
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               /*                                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * Task A: Service USB Activity Interrupt                                    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                */                                                                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000dee   5068     MOVF      0x68,0x0,0x0       if(UIRbits.ACTVIF && UIEbits.ACTVIE)    USBWakeFromSuspend();                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000df0   0b04     ANDLW     0x4                                                                                             
000df2   e004     BZ        0xdfc                                                                                           
000df4   5069     MOVF      0x69,0x0,0x0                                                                                    
000df6   0b04     ANDLW     0x4                                                                                             
000df8   e001     BZ        0xdfc                                                                                           
000dfa   d838     RCALL     0xe6c                                                                                           
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               /*                                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * Pointless to continue servicing if the device is in suspend mode.         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                */                                                                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000dfc   b26d     BTFSC     0x6d,0x1,0x0       if(UCONbits.SUSPND==1) return;                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000dfe   d031     BRA       0xe62                                                                                           
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               /*                                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * Task B: Service USB Bus Reset Interrupt.                                  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * When bus reset is received during suspend, ACTVIF will be set first,      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * once the UCONbits.SUSPND is clear, then the URSTIF bit will be asserted.  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * This is why URSTIF is checked after ACTVIF.                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                */                                                                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e00   5068     MOVF      0x68,0x0,0x0       if(UIRbits.URSTIF && UIEbits.URSTIE)    USBProtocolResetHandler();           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e02   0b01     ANDLW     0x1                                                                                             
000e04   e004     BZ        0xe0e                                                                                           
000e06   5069     MOVF      0x69,0x0,0x0                                                                                    
000e08   0b01     ANDLW     0x1                                                                                             
000e0a   e001     BZ        0xe0e                                                                                           
000e0c   d850     RCALL     0xeae                                                                                           
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               /*                                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * Task C: Service other USB interrupts                                      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                */                                                                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e0e   5068     MOVF      0x68,0x0,0x0       if(UIRbits.IDLEIF && UIEbits.IDLEIE)    USBSuspend();                        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e10   0b10     ANDLW     0x10                                                                                            
000e12   e004     BZ        0xe1c                                                                                           
000e14   5069     MOVF      0x69,0x0,0x0                                                                                    
000e16   0b10     ANDLW     0x10                                                                                            
000e18   e001     BZ        0xe1c                                                                                           
000e1a   d824     RCALL     0xe64                                                                                           
000e1c   5068     MOVF      0x68,0x0,0x0       if(UIRbits.SOFIF && UIEbits.SOFIE)      USB_SOF_Handler();                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e1e   0b40     ANDLW     0x40                                                                                            
000e20   e004     BZ        0xe2a                                                                                           
000e22   5069     MOVF      0x69,0x0,0x0                                                                                    
000e24   0b40     ANDLW     0x40                                                                                            
000e26   e001     BZ        0xe2a                                                                                           
000e28   d837     RCALL     0xe98                                                                                           
000e2a   5068     MOVF      0x68,0x0,0x0       if(UIRbits.STALLIF && UIEbits.STALLIE)  USBStallHandler();                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e2c   0b20     ANDLW     0x20                                                                                            
000e2e   e004     BZ        0xe38                                                                                           
000e30   5069     MOVF      0x69,0x0,0x0                                                                                    
000e32   0b20     ANDLW     0x20                                                                                            
000e34   e001     BZ        0xe38                                                                                           
000e36   d832     RCALL     0xe9c                                                                                           
000e38   5068     MOVF      0x68,0x0,0x0       if(UIRbits.UERRIF && UIEbits.UERRIE)    USBErrorHandler();                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e3a   0b02     ANDLW     0x2                                                                                             
000e3c   e004     BZ        0xe46                                                                                           
000e3e   5069     MOVF      0x69,0x0,0x0                                                                                    
000e40   0b02     ANDLW     0x2                                                                                             
000e42   e001     BZ        0xe46                                                                                           
000e44   d832     RCALL     0xeaa                                                                                           
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               /*                                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * Pointless to continue servicing if the host has not sent a bus reset.     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * Once bus reset is received, the device transitions into the DEFAULT       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * state and is ready for communication.                                     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                */                                                                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e46   0e03     MOVLW     0x3                if(usb_device_state < DEFAULT_STATE) return;                                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e48   0100     MOVLB     0x0                                                                                             
000e4a   5dfc     SUBWF     0xfc,0x0,0x1                                                                                    
000e4c   e201     BC        0xe50                                                                                           
000e4e   d009     BRA       0xe62                                                                                           
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               /*                                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * Task D: Servicing USB Transaction Complete Interrupt                      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                */                                                                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e50   5068     MOVF      0x68,0x0,0x0       if(UIRbits.TRNIF && UIEbits.TRNIE)                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e52   0b08     ANDLW     0x8                                                                                             
000e54   e006     BZ        0xe62                                                                                           
000e56   5069     MOVF      0x69,0x0,0x0                                                                                    
000e58   0b08     ANDLW     0x8                                                                                             
000e5a   e003     BZ        0xe62                                                                                           
                                               {                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                   /*                                                                       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                    * USBCtrlEPService only services transactions over EP0.                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                    * It ignores all other EP transactions.                                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                    */                                                                      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e5c   ec53     CALL      0xaa6,0x0              USBCtrlEPService();                                                      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e5e   f005                                                                                                               
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                   /*                                                                       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                    * Other EP can be serviced later by responsible device class firmware.  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                    * Each device driver knows when an OUT or IN transaction is ready by    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                    * checking the buffer ownership bit.                                    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                    * An OUT EP should always be owned by SIE until the data is ready.      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                    * An IN EP should always be owned by CPU until the data is ready.       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                    *                                                                       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                    * Because of this logic, it is not necessary to save the USTAT value    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                    * of non-EP0 transactions.                                              E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                    */                                                                      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e60   9668     BCF       0x68,0x3,0x0           UIRbits.TRNIF = 0;                                                       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               }//end if(UIRbits.TRNIF && UIEbits.TRNIE)                                    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e62   0012     RETURN    0x0            }//end USBDriverService                                                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Function:        void USBSuspend(void)                                        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Overview:                                                                     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Note:            None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           void USBSuspend(void)                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           {                                                                                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               /*                                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * NOTE: Do not clear UIRbits.ACTVIF here!                                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * Reason:                                                                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * ACTVIF is only generated once an IDLEIF has been generated.               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * This is a 1:1 ratio interrupt generation.                                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * For every IDLEIF, there will be only one ACTVIF regardless of             E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * the number of subsequent bus transitions.                                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                *                                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * If the ACTIF is cleared here, a problem could occur when:                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * [       IDLE       ][bus activity ->                                      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * <--- 3 ms ----->     ^                                                    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                *                ^     ACTVIF=1                                             E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                *                IDLEIF=1                                                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                *  #           #           #           #   (#=Program polling flags)        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                *                          ^                                                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                *                          This polling loop will see both                  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                *                          IDLEIF=1 and ACTVIF=1.                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                *                          However, the program services IDLEIF first       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                *                          because ACTIVIE=0.                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                *                          If this routine clears the only ACTIVIF,         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                *                          then it can never get out of the suspend         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                *                          mode.                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                */                                                                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e64   8469     BSF       0x69,0x2,0x0       UIEbits.ACTVIE = 1;                     // Enable bus activity interrupt     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e66   9868     BCF       0x68,0x4,0x0       UIRbits.IDLEIF = 0;                                                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e68   826d     BSF       0x6d,0x1,0x0       UCONbits.SUSPND = 1;                    // Put USB module in power conserve  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                       // mode, SIE clock inactive          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               /*                                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * At this point the PIC can go into sleep,idle, or                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * switch to a slower clock, etc.                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                */                                                                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               /* Modifiable Section */                                                     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               /* End Modifiable Section */                                                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e6a   0012     RETURN    0x0            }//end USBSuspend                                                                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Function:        void USBWakeFromSuspend(void)                                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Overview:                                                                     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Note:            None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           void USBWakeFromSuspend(void)                                                    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           {                                                                                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               /*                                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * If using clock switching, this is the place to restore the                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * original clock frequency.                                                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                */                                                                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e6c   926d     BCF       0x6d,0x1,0x0       UCONbits.SUSPND = 0;                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e6e   9469     BCF       0x69,0x2,0x0       UIEbits.ACTVIE = 0;                                                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e70   9468     BCF       0x68,0x2,0x0       UIRbits.ACTVIF = 0;                                                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e72   0012     RETURN    0x0            }//end USBWakeFromSuspend                                                        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Function:        void USBRemoteWakeup(void)                                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Overview:        This function should be called by user when the device       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  is waken up by an external stimulus other than ACTIVIF.      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  Please read the note below to understand the limitations.    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Note:            The modifiable section in this routine should be changed     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  to meet the application needs. Current implementation        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  temporary blocks other functions from executing for a        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  period of 1-13 ms depending on the core frequency.           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  According to USB 2.0 specification section 7.1.7.7,          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  "The remote wakeup device must hold the resume signaling     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  for at lest 1 ms but for no more than 15 ms."                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  The idea here is to use a delay counter loop, using a        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  common value that would work over a wide range of core       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  frequencies.                                                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  That value selected is 1800. See table below:                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  ==========================================================   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  Core Freq(MHz)      MIP         RESUME Signal Period (ms)    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  ==========================================================   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                      48              12          1.05                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                       4              1           12.6                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  ==========================================================   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  * These timing could be incorrect when using code            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                    optimization or extended instruction mode,                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                    or when having other interrupts enabled.                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                    Make sure to verify using the MPLAB SIM's Stopwatch        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           void USBRemoteWakeup(void)                                                       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           {                                                                                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               static word delay_count;                                                     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e74   0100     MOVLB     0x0                if(usb_stat.RemoteWakeup == 1)          // Check if RemoteWakeup function    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e76   a1fd     BTFSS     0xfd,0x0,0x1                                                                                    
000e78   d00e     BRA       0xe96                                                                                           
                                               {                                       // has been enabled by the host.     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e7a   dff8     RCALL     0xe6c                  USBWakeFromSuspend();               // Unsuspend USB modue               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e7c   846d     BSF       0x6d,0x2,0x0           UCONbits.RESUME = 1;                // Start RESUME signaling            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                   /* Modifiable Section */                                                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e7e   0107     MOVLB     0x7                    delay_count = 1800U;                // Set RESUME line for 1-13 ms       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e80   0e08     MOVLW     0x8                                                                                             
000e82   6fde     MOVWF     0xde,0x1                                                                                        
000e84   0e07     MOVLW     0x7                                                                                             
000e86   6fdf     MOVWF     0xdf,0x1                                                                                        
                                                   do                                                                       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                   {                                                                        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e88   07de     DECF      0xde,0x1,0x1               delay_count--;                                                       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e8a   0e00     MOVLW     0x0                                                                                             
000e8c   5bdf     SUBWFB    0xdf,0x1,0x1                                                                                    
000e8e   51de     MOVF      0xde,0x0,0x1           }while(delay_count);                                                     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e90   11df     IORWF     0xdf,0x0,0x1                                                                                    
000e92   e1fa     BNZ       0xe88                                                                                           
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                   /* End Modifiable Section */                                             E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e94   946d     BCF       0x6d,0x2,0x0           UCONbits.RESUME = 0;                                                     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               }//endif                                                                     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e96   0012     RETURN    0x0            }//end USBRemoteWakeup                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Function:        void USB_SOF_Handler(void)                                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Overview:        The USB host sends out a SOF packet to full-speed devices    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  every 1 ms. This interrupt may be useful for isochronous     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  pipes. End designers should implement callback routine       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  as necessary.                                                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Note:            None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           void USB_SOF_Handler(void)                                                       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           {                                                                                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               /* Callback routine here */                                                  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e98   9c68     BCF       0x68,0x6,0x0       UIRbits.SOFIF = 0;                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e9a   0012     RETURN    0x0            }//end USB_SOF_Handler                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Function:        void USBStallHandler(void)                                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * PreCondition:    A STALL packet is sent to the host by the SIE.               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Overview:        The STALLIF is set anytime the SIE sends out a STALL         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  packet regardless of which endpoint causes it.               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  A Setup transaction overrides the STALL function. A stalled  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  endpoint stops stalling once it receives a setup packet.     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  In this case, the SIE will accepts the Setup packet and      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  set the TRNIF flag to notify the firmware. STALL function    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  for that particular endpoint pipe will be automatically      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  disabled (direction specific).                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  There are a few reasons for an endpoint to be stalled.       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  1. When a non-supported USB request is received.             E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                     Example: GET_DESCRIPTOR(DEVICE_QUALIFIER)                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  2. When an endpoint is currently halted.                     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  3. When the device class specifies that an endpoint must     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                     stall in response to a specific event.                    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                     Example: Mass Storage Device Class                        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                              If the CBW is not valid, the device shall        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                              STALL the Bulk-In pipe.                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                              See USB Mass Storage Class Bulk-only Transport   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                              Specification for more details.                  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Note:            UEPn.EPSTALL can be scanned to see which endpoint causes     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  the stall event.                                             E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  If                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           void USBStallHandler(void)                                                       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           {                                                                                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               /*                                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * Does not really have to do anything here,                                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * even for the control endpoint.                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * All BDs of Endpoint 0 are owned by SIE right now,                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * but once a Setup Transaction is received, the ownership                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * for EP0_OUT will be returned to CPU.                                      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * When the Setup Transaction is serviced, the ownership                     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * for EP0_IN will then be forced back to CPU by firmware.                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                *                                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                * NOTE: Above description is not quite true at this point.                  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                *       It seems the SIE never returns the UOWN bit to CPU,                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                *       and a TRNIF is never generated upon successful                      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                *       reception of a SETUP transaction.                                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                *       Firmware work-around is implemented below.                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                */                                                                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e9c   a070     BTFSS     0x70,0x0,0x0       if(UEP0bits.EPSTALL == 1)                                                    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000e9e   d003     BRA       0xea6                                                                                           
                                               {                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000ea0   ecc6     CALL      0xd8c,0x0              USBPrepareForNextSetupTrf();        // Firmware Work-Around              E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000ea2   f006                                                                                                               
000ea4   9070     BCF       0x70,0x0,0x0           UEP0bits.EPSTALL = 0;                                                    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                               }                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000ea6   9a68     BCF       0x68,0x5,0x0       UIRbits.STALLIF = 0;                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000ea8   0012     RETURN    0x0            }//end USBStallHandler                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Function:        void USBErrorHandler(void)                                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Overview:        The purpose of this interrupt is mainly for debugging        E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  during development. Check UEIR to see which error causes     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  the interrupt.                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Note:            None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           void USBErrorHandler(void)                                                       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           {                                                                                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000eaa   9268     BCF       0x68,0x1,0x0       UIRbits.UERRIF = 0;                                                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000eac   0012     RETURN    0x0            }//end USBErrorHandler                                                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Function:        void USBProtocolResetHandler(void)                           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * PreCondition:    A USB bus reset is received from the host.                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Side Effects:    Currently, this routine flushes any pending USB              E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  transactions. It empties out the USTAT FIFO. This action     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  might not be desirable in some applications.                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Overview:        Once a USB bus reset is received from the host, this         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  routine should be called. It resets the device address to    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  zero, disables all non-EP0 endpoints, initializes EP0 to     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  be ready for default communication, clears all USB           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  interrupt flags, unmasks applicable USB interrupts, and      E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                  reinitializes internal state-machine variables.              E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *                                                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            * Note:            None                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           void USBProtocolResetHandler(void)                                               E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           {                                                                                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000eae   6a6a     CLRF      0x6a,0x0           UEIR = 0;                       // Clear all USB error flags                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000eb0   6a68     CLRF      0x68,0x0           UIR = 0;                        // Clears all USB interrupts                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000eb2   0e9f     MOVLW     0x9f               UEIE = 0b10011111;              // Unmask all USB error interrupts           E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000eb4   6e6b     MOVWF     0x6b,0x0                                                                                        
000eb6   0e7b     MOVLW     0x7b               UIE = 0b01111011;               // Enable all interrupts except ACTVIE       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000eb8   6e69     MOVWF     0x69,0x0                                                                                        
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000eba   6a6e     CLRF      0x6e,0x0           UADDR = 0x00;                   // Reset to default address                  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000ebc   0e0f     MOVLW     0xf                mDisableEP1to15();              // Reset all non-EP0 UEPn registers          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000ebe   6ee6     MOVWF     0xe6,0x0                                                                                        
000ec0   0e71     MOVLW     0x71                                                                                            
000ec2   6ee6     MOVWF     0xe6,0x0                                                                                        
000ec4   0e0f     MOVLW     0xf                                                                                             
000ec6   6ee6     MOVWF     0xe6,0x0                                                                                        
000ec8   d814     RCALL     0xef2                                                                                           
000eca   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000ecc   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000ece   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000ed0   0e16     MOVLW     0x16               UEP0 = EP_CTRL|HSHK_EN;         // Init EP0 as a Ctrl EP, see usbdrv.h       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000ed2   6e70     MOVWF     0x70,0x0                                                                                        
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000ed4   a668     BTFSS     0x68,0x3,0x0       while(UIRbits.TRNIF == 1)       // Flush any pending transactions            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000ed6   d002     BRA       0xedc                                                                                           
000eda   d7fc     BRA       0xed4                                                                                           
000ed8   9668     BCF       0x68,0x3,0x0           UIRbits.TRNIF = 0;                                                       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000edc   986d     BCF       0x6d,0x4,0x0       UCONbits.PKTDIS = 0;            // Make sure packet processing is enabled    E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000ede   ecc6     CALL      0xd8c,0x0          USBPrepareForNextSetupTrf();    // Declared in usbctrltrf.c                  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000ee0   f006                                                                                                               
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000ee2   0100     MOVLB     0x0                usb_stat.RemoteWakeup = 0;      // Default status flag to disable            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000ee4   91fd     BCF       0xfd,0x0,0x1                                                                                    
000ee6   0100     MOVLB     0x0                usb_active_cfg = 0;             // Clear active configuration                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000ee8   6bfe     CLRF      0xfe,0x1                                                                                        
000eea   0100     MOVLB     0x0                usb_device_state = DEFAULT_STATE;                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000eec   0e03     MOVLW     0x3                                                                                             
000eee   6ffc     MOVWF     0xfc,0x1                                                                                        
000ef0   0012     RETURN    0x0            }//end USBProtocolResetHandler                                                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           /* Auxiliary Function */                                                         E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000ef2   cfd9     MOVFF     0xfd9,0xfe6    void ClearArray(byte* startAdr,byte count)                                       E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000ef4   ffe6                                                                                                               
000ef6   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
000ef8   ffd9                                                                                                               
                                           {                                                                                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000efa   0efd     MOVLW     0xfd               *startAdr;                                                                   E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000efc   cfdb     MOVFF     0xfdb,0xfe9                                                                                     
000efe   ffe9                                                                                                               
000f00   0efe     MOVLW     0xfe                                                                                            
000f02   cfdb     MOVFF     0xfdb,0xfea                                                                                     
000f04   ffea                                                                                                               
000f06   0efc     MOVLW     0xfc               while(count)                                                                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000f08   50db     MOVF      0xdb,0x0,0x0                                                                                    
000f0a   e004     BZ        0xf14                                                                                           
000f12   d7f9     BRA       0xf06                                                                                           
                                               {                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                   _asm                                                                     E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000f0c   6aee     CLRF      0xee,0x0               clrf POSTINC0,0                                                          E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                                   _endasm                                                                  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000f0e   0efc     MOVLW     0xfc                   count--;                                                                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000f10   06db     DECF      0xdb,0x1,0x0                                                                                    
                                               }//end while                                                                 E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000f14   52e5     MOVF      0xe5,0x1,0x0   }//end ClearArray                                                                E:\usb20\scope\system\usb\usbdrv\usbdrv.c
000f16   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
000f18   ffd9                                                                                                               
000f1a   0012     RETURN    0x0                                                                                             
                                                                                                                            E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           /** EOF usbdrv.c *************************************************************/  E:\usb20\scope\system\usb\usbdrv\usbdrv.c
                                           /*********************************************************************           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                Microchip USB C18 Firmware Version 1.0                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *********************************************************************           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * FileName:        usbctrltrf.c                                                 E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Dependencies:    See INCLUDES section below                                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Processor:       PIC18                                                        E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Compiler:        C18 2.30.01+                                                 E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Company:         Microchip Technology, Inc.                                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Software License Agreement                                                    E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * The software supplied herewith by Microchip Technology Incorporated           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * (the 鼎ompany) for its PICmicroｮ Microcontroller is intended and             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * supplied to you, the Company痴 customer, for use solely and                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * software is owned by the Company and/or its supplier, and is                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * protected under applicable copyright laws. All rights are reserved.           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Any use in violation of the foregoing restrictions may subject the            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * user to criminal sanctions under applicable laws, as well as to               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * civil liability for the breach of the terms and conditions of this            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * license.                                                                      E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * THIS SOFTWARE IS PROVIDED IN AN 鄭S IS CONDITION. NO WARRANTIES,             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Author               Date        Comment                                      E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Rawin Rojvanit       11/19/04    Original.                                    E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            ********************************************************************/           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           /** I N C L U D E S **********************************************************/  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           #include <p18cxxx.h>                                                             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           #include "system\typedefs.h"                                                     E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           #include "system\usb\usb.h"                                                      E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           /** V A R I A B L E S ********************************************************/  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           #pragma udata                                                                    E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           byte ctrl_trf_state;                // Control Transfer State                    E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           byte ctrl_trf_session_owner;        // Current transfer session owner            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           POINTER pSrc;                       // Data source pointer                       E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           POINTER pDst;                       // Data destination pointer                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           WORD wCount;                        // Data counter                              E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           void USBCtrlTrfSetupHandler(void);                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           void USBCtrlTrfOutHandler(void);                                                 E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           void USBCtrlTrfInHandler(void);                                                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           /** D E C L A R A T I O N S **************************************************/  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           #pragma code                                                                     E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Function:        void USBCtrlEPService(void)                                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * PreCondition:    USTAT is loaded with a valid endpoint address.               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Overview:        USBCtrlEPService checks for three transaction types that     E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  it knows how to service and services them:                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  1. EP0 SETUP                                                 E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  2. EP0 OUT                                                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  3. EP0 IN                                                    E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  It ignores all other types (i.e. EP1, EP2, etc.)             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Note:            None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           void USBCtrlEPService(void)                                                      E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           {                                                                                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000aa6   506c     MOVF      0x6c,0x0,0x0       if(USTAT == EP00_OUT)                                                        E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000aa8   e002     BZ        0xaae                                                                                           
000aaa   0e00     MOVLW     0x0                                                                                             
000aac   d001     BRA       0xab0                                                                                           
000aae   0e01     MOVLW     0x1                                                                                             
000ab0   0900     IORLW     0x0                                                                                             
000ab2   e00b     BZ        0xaca                                                                                           
                                               {                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000ab4   0104     MOVLB     0x4                    if(ep0Bo.Stat.PID == SETUP_TOKEN)           // EP0 SETUP                 E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000ab6   5100     MOVF      0x0,0x0,0x1                                                                                     
000ab8   0b3c     ANDLW     0x3c                                                                                            
000aba   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
000abc   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
000abe   080d     SUBLW     0xd                                                                                             
000ac0   e102     BNZ       0xac6                                                                                           
000ac2   d80c     RCALL     0xadc                      USBCtrlTrfSetupHandler();                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000ac4   d001     BRA       0xac8                  else                                        // EP0 OUT                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000ac6   d840     RCALL     0xb48                      USBCtrlTrfOutHandler();                                              E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                               }                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000ac8   d008     BRA       0xada              else if(USTAT == EP00_IN)                       // EP0 IN                    E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000aca   506c     MOVF      0x6c,0x0,0x0                                                                                    
000acc   e002     BZ        0xad2                                                                                           
000ace   0e00     MOVLW     0x0                                                                                             
000ad0   d001     BRA       0xad4                                                                                           
000ad2   0e01     MOVLW     0x1                                                                                             
000ad4   0904     IORLW     0x4                                                                                             
000ad6   e001     BZ        0xada                                                                                           
000ad8   d847     RCALL     0xb68                  USBCtrlTrfInHandler();                                                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000ada   0012     RETURN    0x0            }//end USBCtrlEPService                                                          E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Function:        void USBCtrlTrfSetupHandler(void)                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * PreCondition:    SetupPkt buffer is loaded with valid USB Setup Data          E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Overview:        This routine is a task dispatcher and has 3 stages.          E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  1. It initializes the control transfer state machine.        E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  2. It calls on each of the module that may know how to       E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     service the Setup Request from the host.                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     Module Example: USB9, HID, CDC, MSD, ...                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     As new classes are added, ClassReqHandler table in        E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     usbdsc.c should be updated to call all available          E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     class handlers.                                           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  3. Once each of the modules has had a chance to check if     E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     it is responsible for servicing the request, stage 3      E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     then checks direction of the transfer to determine how    E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     to prepare EP0 for the control transfer.                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     Refer to USBCtrlEPServiceComplete() for more details.     E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Note:            Microchip USB Firmware has three different states for        E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  the control transfer state machine:                          E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  1. WAIT_SETUP                                                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  2. CTRL_TRF_TX                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  3. CTRL_TRF_RX                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  Refer to firmware manual to find out how one state           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  is transitioned to another.                                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  A Control Transfer is composed of many USB transactions.     E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  When transferring data over multiple transactions,           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  it is important to keep track of data source, data           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  destination, and data count. These three parameters are      E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  stored in pSrc,pDst, and wCount. A flag is used to           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  note if the data source is from ROM or RAM.                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000adc   cfd9     MOVFF     0xfd9,0xfe6    void USBCtrlTrfSetupHandler(void)                                                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000ade   ffe6                                                                                                               
000ae0   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
000ae2   ffd9                                                                                                               
000ae4   52e6     MOVF      0xe6,0x1,0x0                                                                                    
                                           {                                                                                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                               byte i;                                                                      E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                               /* Stage 1 */                                                                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000ae6   0100     MOVLB     0x0                ctrl_trf_state = WAIT_SETUP;                                                 E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000ae8   6bf4     CLRF      0xf4,0x1                                                                                        
000aea   6bf5     CLRF      0xf5,0x1           ctrl_trf_session_owner = MUID_NULL;     // Set owner to NULL                 E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000aec   6bfa     CLRF      0xfa,0x1           wCount._word = 0;                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000aee   6bfb     CLRF      0xfb,0x1                                                                                        
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                               /* Stage 2 */                                                                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000af0   eccf     CALL      0x79e,0x0          USBCheckStdRequest();                   // See system\usb9\usb9.c            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000af2   f003                                                                                                               
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000af4   6adf     CLRF      0xdf,0x0           for(i=0;i < (sizeof(ClassReqHandler)/sizeof(pFunc));i++)                     E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000af6   50df     MOVF      0xdf,0x0,0x0                                                                                    
000af8   6e14     MOVWF     0x14,0x0                                                                                        
000afa   6a15     CLRF      0x15,0x0                                                                                        
000afc   0e01     MOVLW     0x1                                                                                             
000afe   5c14     SUBWF     0x14,0x0,0x0                                                                                    
000b00   0e00     MOVLW     0x0                                                                                             
000b02   5815     SUBWFB    0x15,0x0,0x0                                                                                    
000b04   e21b     BC        0xb3c                                                                                           
000b38   2adf     INCF      0xdf,0x1,0x0                                                                                    
000b3a   d7dd     BRA       0xaf6                                                                                           
                                               {                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b06   0100     MOVLB     0x0                    if(ctrl_trf_session_owner != MUID_NULL)break;                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b08   51f5     MOVF      0xf5,0x0,0x1                                                                                    
000b0a   e001     BZ        0xb0e                                                                                           
000b0c   d017     BRA       0xb3c                                                                                           
000b0e   6af7     CLRF      0xf7,0x0               ClassReqHandler[i]();               // See autofiles\usbdsc.c            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b10   34df     RLCF      0xdf,0x0,0x0                                                                                    
000b12   0bfe     ANDLW     0xfe                                                                                            
000b14   36f7     RLCF      0xf7,0x1,0x0                                                                                    
000b16   6ef6     MOVWF     0xf6,0x0                                                                                        
000b18   0ecb     MOVLW     0xcb                                                                                            
000b1a   26f6     ADDWF     0xf6,0x1,0x0                                                                                    
000b1c   0e0f     MOVLW     0xf                                                                                             
000b1e   22f7     ADDWFC    0xf7,0x1,0x0                                                                                    
000b20   0009     TBLRDPOSTINC                                                                                              
000b22   cff5     MOVFF     0xff5,0x14                                                                                      
000b24   f014                                                                                                               
000b26   0008     TBLRD                                                                                                     
000b28   cff5     MOVFF     0xff5,0x15                                                                                      
000b2a   f015                                                                                                               
000b2c   d004     BRA       0xb36                                                                                           
000b2e   c015     MOVFF     0x15,0xffa                                                                                      
000b30   fffa                                                                                                               
000b32   5014     MOVF      0x14,0x0,0x0                                                                                    
000b34   6ef9     MOVWF     0xf9,0x0                                                                                        
000b36   dffb     RCALL     0xb2e                                                                                           
                                               }//end while                                                                 E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                               /* Stage 3 */                                                                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b3c   d8e1     RCALL     0xd00              USBCtrlEPServiceComplete();                                                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b3e   52e5     MOVF      0xe5,0x1,0x0   }//end USBCtrlTrfSetupHandler                                                    E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b40   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000b42   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
000b44   ffd9                                                                                                               
000b46   0012     RETURN    0x0                                                                                             
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Function:        void USBCtrlTrfOutHandler(void)                              E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Overview:        This routine handles an OUT transaction according to         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  which control transfer state is currently active.            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Note:            Note that if the the control transfer was from               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  host to device, the session owner should be notified         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  at the end of each OUT transaction to service the            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  received data.                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           void USBCtrlTrfOutHandler(void)                                                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           {                                                                                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b48   0e02     MOVLW     0x2                if(ctrl_trf_state == CTRL_TRF_RX)                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b4a   0100     MOVLB     0x0                                                                                             
000b4c   5df4     SUBWF     0xf4,0x0,0x1                                                                                    
000b4e   e10a     BNZ       0xb64                                                                                           
                                               {                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b50   d898     RCALL     0xc82                  USBCtrlTrfRxService();                                                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                   /*                                                                       E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                    * Don't have to worry about overwriting _KEEP bit                       E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                    * because if _KEEP was set, TRNIF would not have been                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                    * generated in the first place.                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                    */                                                                      E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b52   0104     MOVLB     0x4                    if(ep0Bo.Stat.DTS == 0)                                                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b54   bd00     BTFSC     0x0,0x6,0x1                                                                                     
000b56   d003     BRA       0xb5e                                                                                           
000b58   0ec8     MOVLW     0xc8                       ep0Bo.Stat._byte = _USIE|_DAT1|_DTSEN;                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b5a   6f00     MOVWF     0x0,0x1                                                                                         
000b5c   d002     BRA       0xb62                  else                                                                     E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b5e   0e88     MOVLW     0x88                       ep0Bo.Stat._byte = _USIE|_DAT0|_DTSEN;                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b60   6f00     MOVWF     0x0,0x1                                                                                         
                                               }                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b62   d001     BRA       0xb66              else    // CTRL_TRF_TX                                                       E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b64   d913     RCALL     0xd8c                  USBPrepareForNextSetupTrf();                                             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b66   0012     RETURN    0x0            }//end USBCtrlTrfOutHandler                                                      E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Function:        void USBCtrlTrfInHandler(void)                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Overview:        This routine handles an IN transaction according to          E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  which control transfer state is currently active.            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Note:            A Set Address Request must not change the acutal address     E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  of the device until the completion of the control            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  transfer. The end of the control transfer for Set Address    E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  Request is an IN transaction. Therefore it is necessary      E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  to service this unique situation when the condition is       E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  right. Macro mUSBCheckAdrPendingState is defined in          E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  usb9.h and its function is to specifically service this      E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  event.                                                       E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           void USBCtrlTrfInHandler(void)                                                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           {                                                                                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b68   0e04     MOVLW     0x4                mUSBCheckAdrPendingState();         // Must check if in ADR_PENDING_STATE    E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b6a   0100     MOVLB     0x0                                                                                             
000b6c   5dfc     SUBWF     0xfc,0x0,0x1                                                                                    
000b6e   e10a     BNZ       0xb84                                                                                           
000b70   c422     MOVFF     0x422,0xf6e                                                                                     
000b72   ff6e                                                                                                               
000b74   506e     MOVF      0x6e,0x0,0x0                                                                                    
000b76   0800     SUBLW     0x0                                                                                             
000b78   e203     BC        0xb80                                                                                           
000b7a   0e05     MOVLW     0x5                                                                                             
000b7c   6ffc     MOVWF     0xfc,0x1                                                                                        
000b7e   d002     BRA       0xb84                                                                                           
000b80   0e03     MOVLW     0x3                                                                                             
000b82   6ffc     MOVWF     0xfc,0x1                                                                                        
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b84   0100     MOVLB     0x0                if(ctrl_trf_state == CTRL_TRF_TX)                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b86   05f4     DECF      0xf4,0x0,0x1                                                                                    
000b88   e10a     BNZ       0xb9e                                                                                           
                                               {                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b8a   d80b     RCALL     0xba2                  USBCtrlTrfTxService();                                                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b8c   0104     MOVLB     0x4                    if(ep0Bi.Stat.DTS == 0)                                                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b8e   bd04     BTFSC     0x4,0x6,0x1                                                                                     
000b90   d003     BRA       0xb98                                                                                           
000b92   0ec8     MOVLW     0xc8                       ep0Bi.Stat._byte = _USIE|_DAT1|_DTSEN;                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b94   6f04     MOVWF     0x4,0x1                                                                                         
000b96   d002     BRA       0xb9c                  else                                                                     E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b98   0e88     MOVLW     0x88                       ep0Bi.Stat._byte = _USIE|_DAT0|_DTSEN;                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b9a   6f04     MOVWF     0x4,0x1                                                                                         
                                               }                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b9c   d001     BRA       0xba0              else // CTRL_TRF_RX                                                          E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000b9e   d8f6     RCALL     0xd8c                  USBPrepareForNextSetupTrf();                                             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000ba0   0012     RETURN    0x0            }//end USBCtrlTrfInHandler                                                       E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Function:        void USBCtrlTrfTxService(void)                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * PreCondition:    pSrc, wCount, and usb_stat.ctrl_trf_mem are setup properly.  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Overview:        This routine should be called from only two places.          E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  One from USBCtrlEPServiceComplete() and one from             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  USBCtrlTrfInHandler(). It takes care of managing a           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  transfer over multiple USB transactions.                     E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Note:            This routine works with isochronous endpoint larger than     E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  256 bytes and is shown here as an example of how to deal     E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  with BC9 and BC8. In reality, a control endpoint can never   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  be larger than 64 bytes.                                     E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000ba2   cfd9     MOVFF     0xfd9,0xfe6    void USBCtrlTrfTxService(void)                                                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000ba4   ffe6                                                                                                               
000ba6   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
000ba8   ffd9                                                                                                               
000baa   0e02     MOVLW     0x2                                                                                             
000bac   26e1     ADDWF     0xe1,0x1,0x0                                                                                    
                                           {                                                                                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                               WORD byte_to_send;                                                           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                               /*                                                                           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                * First, have to figure out how many byte of data to send.                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                */                                                                          E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000bae   0100     MOVLB     0x0                if(wCount._word < EP0_BUFF_SIZE)                                             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000bb0   0e08     MOVLW     0x8                                                                                             
000bb2   5dfa     SUBWF     0xfa,0x0,0x1                                                                                    
000bb4   0e00     MOVLW     0x0                                                                                             
000bb6   59fb     SUBWFB    0xfb,0x0,0x1                                                                                    
000bb8   e205     BC        0xbc4                                                                                           
000bba   c0fa     MOVFF     0xfa,0xfde             byte_to_send._word = wCount._word;                                       E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000bbc   ffde                                                                                                               
000bbe   c0fb     MOVFF     0xfb,0xfdd                                                                                      
000bc0   ffdd                                                                                                               
000bc2   d003     BRA       0xbca              else                                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000bc4   0e08     MOVLW     0x8                    byte_to_send._word = EP0_BUFF_SIZE;                                      E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000bc6   6ede     MOVWF     0xde,0x0                                                                                        
000bc8   6add     CLRF      0xdd,0x0                                                                                        
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                               /*                                                                           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                * Next, load the number of bytes to send to BC9..0 in buffer descriptor     E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                */                                                                          E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000bca   0104     MOVLB     0x4                ep0Bi.Stat.BC9 = 0;                                                          E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000bcc   9304     BCF       0x4,0x1,0x1                                                                                     
000bce   9104     BCF       0x4,0x0,0x1        ep0Bi.Stat.BC8 = 0;                                                          E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000bd0   0e01     MOVLW     0x1                ep0Bi.Stat._byte |= MSB(byte_to_send);                                       E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000bd2   50db     MOVF      0xdb,0x0,0x0                                                                                    
000bd4   1304     IORWF     0x4,0x1,0x1                                                                                     
000bd6   cfdf     MOVFF     0xfdf,0x405        ep0Bi.Cnt = LSB(byte_to_send);                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000bd8   f405                                                                                                               
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                               /*                                                                           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                * Subtract the number of bytes just about to be sent from the total.        E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                */                                                                          E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000bda   0e00     MOVLW     0x0                wCount._word = wCount._word - byte_to_send._word;                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000bdc   50db     MOVF      0xdb,0x0,0x0                                                                                    
000bde   0100     MOVLB     0x0                                                                                             
000be0   5ffa     SUBWF     0xfa,0x1,0x1                                                                                    
000be2   0e01     MOVLW     0x1                                                                                             
000be4   50db     MOVF      0xdb,0x0,0x0                                                                                    
000be6   5bfb     SUBWFB    0xfb,0x1,0x1                                                                                    
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000be8   0e28     MOVLW     0x28               pDst.bRam = (byte*)&CtrlTrfData;        // Set destination pointer           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000bea   6ff8     MOVWF     0xf8,0x1                                                                                        
000bec   0e04     MOVLW     0x4                                                                                             
000bee   6ff9     MOVWF     0xf9,0x1                                                                                        
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000bf0   0100     MOVLB     0x0                if(usb_stat.ctrl_trf_mem == _ROM)       // Determine type of memory source   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000bf2   a3fd     BTFSS     0xfd,0x1,0x1                                                                                    
000bf4   d01e     BRA       0xc32                                                                                           
                                               {                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000bf6   cfd9     MOVFF     0xfd9,0xfe9            while(byte_to_send._word)                                                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000bf8   ffe9                                                                                                               
000bfa   cfda     MOVFF     0xfda,0xfea                                                                                     
000bfc   ffea                                                                                                               
000bfe   50ee     MOVF      0xee,0x0,0x0                                                                                    
000c00   10ed     IORWF     0xed,0x0,0x0                                                                                    
000c02   e016     BZ        0xc30                                                                                           
000c2e   d7e3     BRA       0xbf6                                                                                           
                                                   {                                                                        E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000c04   c0f6     MOVFF     0xf6,0xff6                 *pDst.bRam = *pSrc.bRom;                                             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000c06   fff6                                                                                                               
000c08   c0f7     MOVFF     0xf7,0xff7                                                                                      
000c0a   fff7                                                                                                               
000c0c   0008     TBLRD                                                                                                     
000c0e   50f5     MOVF      0xf5,0x0,0x0                                                                                    
000c10   c0f8     MOVFF     0xf8,0xfe9                                                                                      
000c12   ffe9                                                                                                               
000c14   c0f9     MOVFF     0xf9,0xfea                                                                                      
000c16   ffea                                                                                                               
000c18   6eef     MOVWF     0xef,0x0                                                                                        
000c1a   0100     MOVLB     0x0                        pDst.bRam++;                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000c1c   2bf8     INCF      0xf8,0x1,0x1                                                                                    
000c1e   0e00     MOVLW     0x0                                                                                             
000c20   23f9     ADDWFC    0xf9,0x1,0x1                                                                                    
000c22   2bf6     INCF      0xf6,0x1,0x1               pSrc.bRom++;                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000c24   23f7     ADDWFC    0xf7,0x1,0x1                                                                                    
000c26   06df     DECF      0xdf,0x1,0x0               byte_to_send._word--;                                                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000c28   0e01     MOVLW     0x1                                                                                             
000c2a   e201     BC        0xc2e                                                                                           
000c2c   06db     DECF      0xdb,0x1,0x0                                                                                    
                                                   }//end while(byte_to_send._word)                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                               }                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000c30   d01c     BRA       0xc6a              else // RAM                                                                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                               {                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000c32   cfd9     MOVFF     0xfd9,0xfe9            while(byte_to_send._word)                                                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000c34   ffe9                                                                                                               
000c36   cfda     MOVFF     0xfda,0xfea                                                                                     
000c38   ffea                                                                                                               
000c3a   50ee     MOVF      0xee,0x0,0x0                                                                                    
000c3c   10ed     IORWF     0xed,0x0,0x0                                                                                    
000c3e   e015     BZ        0xc6a                                                                                           
000c68   d7e4     BRA       0xc32                                                                                           
                                                   {                                                                        E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000c40   c0f6     MOVFF     0xf6,0xfe9                 *pDst.bRam = *pSrc.bRam;                                             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000c42   ffe9                                                                                                               
000c44   c0f7     MOVFF     0xf7,0xfea                                                                                      
000c46   ffea                                                                                                               
000c48   50ef     MOVF      0xef,0x0,0x0                                                                                    
000c4a   c0f8     MOVFF     0xf8,0xfe9                                                                                      
000c4c   ffe9                                                                                                               
000c4e   c0f9     MOVFF     0xf9,0xfea                                                                                      
000c50   ffea                                                                                                               
000c52   6eef     MOVWF     0xef,0x0                                                                                        
000c54   0100     MOVLB     0x0                        pDst.bRam++;                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000c56   2bf8     INCF      0xf8,0x1,0x1                                                                                    
000c58   0e00     MOVLW     0x0                                                                                             
000c5a   23f9     ADDWFC    0xf9,0x1,0x1                                                                                    
000c5c   2bf6     INCF      0xf6,0x1,0x1               pSrc.bRam++;                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000c5e   23f7     ADDWFC    0xf7,0x1,0x1                                                                                    
000c60   06df     DECF      0xdf,0x1,0x0               byte_to_send._word--;                                                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000c62   0e01     MOVLW     0x1                                                                                             
000c64   e201     BC        0xc68                                                                                           
000c66   06db     DECF      0xdb,0x1,0x0                                                                                    
                                                   }//end while(byte_to_send._word)                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                               }//end if(usb_stat.ctrl_trf_mem == _ROM)                                     E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000c6a   6ef5     MOVWF     0xf5,0x0       }//end USBCtrlTrfTxService                                                       E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000c6c   0e02     MOVLW     0x2                                                                                             
000c6e   5ce1     SUBWF     0xe1,0x0,0x0                                                                                    
000c70   e202     BC        0xc76                                                                                           
000c72   6ae1     CLRF      0xe1,0x0                                                                                        
000c74   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000c76   6ee1     MOVWF     0xe1,0x0                                                                                        
000c78   50f5     MOVF      0xf5,0x0,0x0                                                                                    
000c7a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000c7c   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
000c7e   ffd9                                                                                                               
000c80   0012     RETURN    0x0                                                                                             
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Function:        void USBCtrlTrfRxService(void)                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * PreCondition:    pDst and wCount are setup properly.                          E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  pSrc is always &CtrlTrfData                                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  usb_stat.ctrl_trf_mem is always _RAM.                        E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  wCount should be set to 0 at the start of each control       E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  transfer.                                                    E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Overview:        *** This routine is only partially complete. Check for       E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  new version of the firmware.                                 E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Note:            None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000c82   cfd9     MOVFF     0xfd9,0xfe6    void USBCtrlTrfRxService(void)                                                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000c84   ffe6                                                                                                               
000c86   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
000c88   ffd9                                                                                                               
000c8a   0e02     MOVLW     0x2                                                                                             
000c8c   26e1     ADDWF     0xe1,0x1,0x0                                                                                    
                                           {                                                                                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                               WORD byte_to_read;                                                           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000c8e   0e03     MOVLW     0x3                MSB(byte_to_read) = 0x03 & ep0Bo.Stat._byte;    // Filter out last 2 bits    E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000c90   0104     MOVLB     0x4                                                                                             
000c92   1500     ANDWF     0x0,0x0,0x1                                                                                     
000c94   6ee7     MOVWF     0xe7,0x0                                                                                        
000c96   0e01     MOVLW     0x1                                                                                             
000c98   cfe7     MOVFF     0xfe7,0xfdb                                                                                     
000c9a   ffdb                                                                                                               
000c9c   c401     MOVFF     0x401,0xfdf        LSB(byte_to_read) = ep0Bo.Cnt;                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000c9e   ffdf                                                                                                               
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                               /*                                                                           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                * Accumulate total number of bytes read                                     E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                */                                                                          E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000ca0   50de     MOVF      0xde,0x0,0x0       wCount._word = wCount._word + byte_to_read._word;                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000ca2   0100     MOVLB     0x0                                                                                             
000ca4   27fa     ADDWF     0xfa,0x1,0x1                                                                                    
000ca6   50dd     MOVF      0xdd,0x0,0x0                                                                                    
000ca8   23fb     ADDWFC    0xfb,0x1,0x1                                                                                    
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000caa   0e28     MOVLW     0x28               pSrc.bRam = (byte*)&CtrlTrfData;                                             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000cac   6ff6     MOVWF     0xf6,0x1                                                                                        
000cae   0e04     MOVLW     0x4                                                                                             
000cb0   6ff7     MOVWF     0xf7,0x1                                                                                        
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000cb2   cfd9     MOVFF     0xfd9,0xfe9        while(byte_to_read._word)                                                    E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000cb4   ffe9                                                                                                               
000cb6   cfda     MOVFF     0xfda,0xfea                                                                                     
000cb8   ffea                                                                                                               
000cba   50ee     MOVF      0xee,0x0,0x0                                                                                    
000cbc   10ed     IORWF     0xed,0x0,0x0                                                                                    
000cbe   e014     BZ        0xce8                                                                                           
000ce6   d7e5     BRA       0xcb2                                                                                           
                                               {                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000cc0   c0f6     MOVFF     0xf6,0xfe9             *pDst.bRam = *pSrc.bRam;                                                 E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000cc2   ffe9                                                                                                               
000cc4   c0f7     MOVFF     0xf7,0xfea                                                                                      
000cc6   ffea                                                                                                               
000cc8   50ef     MOVF      0xef,0x0,0x0                                                                                    
000cca   c0f8     MOVFF     0xf8,0xfe9                                                                                      
000ccc   ffe9                                                                                                               
000cce   c0f9     MOVFF     0xf9,0xfea                                                                                      
000cd0   ffea                                                                                                               
000cd2   6eef     MOVWF     0xef,0x0                                                                                        
000cd4   2bf8     INCF      0xf8,0x1,0x1           pDst.bRam++;                                                             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000cd6   0e00     MOVLW     0x0                                                                                             
000cd8   23f9     ADDWFC    0xf9,0x1,0x1                                                                                    
000cda   2bf6     INCF      0xf6,0x1,0x1           pSrc.bRam++;                                                             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000cdc   23f7     ADDWFC    0xf7,0x1,0x1                                                                                    
000cde   06df     DECF      0xdf,0x1,0x0           byte_to_read._word--;                                                    E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000ce0   0e01     MOVLW     0x1                                                                                             
000ce2   e201     BC        0xce6                                                                                           
000ce4   06db     DECF      0xdb,0x1,0x0                                                                                    
                                               }//end while(byte_to_read._word)                                             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000ce8   6ef5     MOVWF     0xf5,0x0       }//end USBCtrlTrfRxService                                                       E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000cea   0e02     MOVLW     0x2                                                                                             
000cec   5ce1     SUBWF     0xe1,0x0,0x0                                                                                    
000cee   e202     BC        0xcf4                                                                                           
000cf0   6ae1     CLRF      0xe1,0x0                                                                                        
000cf2   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000cf4   6ee1     MOVWF     0xe1,0x0                                                                                        
000cf6   50f5     MOVF      0xf5,0x0,0x0                                                                                    
000cf8   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000cfa   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
000cfc   ffd9                                                                                                               
000cfe   0012     RETURN    0x0                                                                                             
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Function:        void USBCtrlEPServiceComplete(void)                          E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Overview:        This routine wrap up the ramaining tasks in servicing        E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  a Setup Request. Its main task is to set the endpoint        E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  controls appropriately for a given situation. See code       E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  below.                                                       E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  There are three main scenarios:                              E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  a) There was no handler for the Request, in this case        E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     a STALL should be sent out.                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  b) The host has requested a read control transfer,           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     endpoints are required to be setup in a specific way.     E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  c) The host has requested a write control transfer, or       E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     a control data stage is not required, endpoints are       E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                     required to be setup in a specific way.                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  Packet processing is resumed by clearing PKTDIS bit.         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Note:            None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           void USBCtrlEPServiceComplete(void)                                              E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           {                                                                                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d00   0100     MOVLB     0x0                if(ctrl_trf_session_owner == MUID_NULL)                                      E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d02   51f5     MOVF      0xf5,0x0,0x1                                                                                    
000d04   e10c     BNZ       0xd1e                                                                                           
                                               {                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                   /*                                                                       E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                    * If no one knows how to service this request then stall.               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                    * Must also prepare EP0 to receive the next SETUP transaction.          E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                    */                                                                      E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d06   0104     MOVLB     0x4                    ep0Bo.Cnt = EP0_BUFF_SIZE;                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d08   0e08     MOVLW     0x8                                                                                             
000d0a   6f01     MOVWF     0x1,0x1                                                                                         
000d0c   0e20     MOVLW     0x20                   ep0Bo.ADR = (byte*)&SetupPkt;                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d0e   6f02     MOVWF     0x2,0x1                                                                                         
000d10   0e04     MOVLW     0x4                                                                                             
000d12   6f03     MOVWF     0x3,0x1                                                                                         
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d14   0e84     MOVLW     0x84                   ep0Bo.Stat._byte = _USIE|_BSTALL;                                        E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d16   6f00     MOVWF     0x0,0x1                                                                                         
000d18   0104     MOVLB     0x4                    ep0Bi.Stat._byte = _USIE|_BSTALL;                                        E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d1a   6f04     MOVWF     0x4,0x1                                                                                         
                                               }                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d1c   d035     BRA       0xd88              else    // A module has claimed ownership of the control transfer session.   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                               {                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d1e   0104     MOVLB     0x4                    if(SetupPkt.DataDir == DEV_TO_HOST)                                      E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d20   af20     BTFSS     0x20,0x7,0x1                                                                                    
000d22   d022     BRA       0xd68                                                                                           
                                                   {                                                                        E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d24   0100     MOVLB     0x0                        if(SetupPkt.wLength < wCount._word)                                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d26   51fa     MOVF      0xfa,0x0,0x1                                                                                    
000d28   0104     MOVLB     0x4                                                                                             
000d2a   5d26     SUBWF     0x26,0x0,0x1                                                                                    
000d2c   0100     MOVLB     0x0                                                                                             
000d2e   51fb     MOVF      0xfb,0x0,0x1                                                                                    
000d30   0104     MOVLB     0x4                                                                                             
000d32   5927     SUBWFB    0x27,0x0,0x1                                                                                    
000d34   e204     BC        0xd3e                                                                                           
000d36   c426     MOVFF     0x426,0xfa                     wCount._word = SetupPkt.wLength;                                 E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d38   f0fa                                                                                                               
000d3a   c427     MOVFF     0x427,0xfb                                                                                      
000d3c   f0fb                                                                                                               
000d3e   df31     RCALL     0xba2                      USBCtrlTrfTxService();                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d40   0100     MOVLB     0x0                        ctrl_trf_state = CTRL_TRF_TX;                                        E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d42   0e01     MOVLW     0x1                                                                                             
000d44   6ff4     MOVWF     0xf4,0x1                                                                                        
                                                       /*                                                                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * Control Read:                                                     E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * <SETUP[0]><IN[1]><IN[0]>...<OUT[1]> | <SETUP[0]>                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * 1. Prepare OUT EP to respond to early termination                 E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        *                                                                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * NOTE:                                                             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * If something went wrong during the control transfer,              E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * the last status stage may not be sent by the host.                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * When this happens, two different things could happen              E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * depending on the host.                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * a) The host could send out a RESET.                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * b) The host could send out a new SETUP transaction                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        *    without sending a RESET first.                                 E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * To properly handle case (b), the OUT EP must be setup             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * to receive either a zero length OUT transaction, or a             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * new SETUP transaction.                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        *                                                                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * Since the SETUP transaction requires the DTS bit to be            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * DAT0 while the zero length OUT status requires the DTS            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * bit to be DAT1, the DTS bit check by the hardware should          E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * be disabled. This way the SIE could accept either of              E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * the two transactions.                                             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        *                                                                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * Furthermore, the Cnt byte should be set to prepare for            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * the SETUP data (8-byte or more), and the buffer address           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * should be pointed to SetupPkt.                                    E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        */                                                                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d46   0104     MOVLB     0x4                        ep0Bo.Cnt = EP0_BUFF_SIZE;                                           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d48   0e08     MOVLW     0x8                                                                                             
000d4a   6f01     MOVWF     0x1,0x1                                                                                         
000d4c   0e20     MOVLW     0x20                       ep0Bo.ADR = (byte*)&SetupPkt;                                        E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d4e   6f02     MOVWF     0x2,0x1                                                                                         
000d50   0e04     MOVLW     0x4                                                                                             
000d52   6f03     MOVWF     0x3,0x1                                                                                         
000d54   0e80     MOVLW     0x80                       ep0Bo.Stat._byte = _USIE;           // Note: DTSEN is 0!             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d56   6f00     MOVWF     0x0,0x1                                                                                         
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                       /*                                                                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * 2. Prepare IN EP to transfer data, Cnt should have                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        *    been initialized by responsible request owner.                 E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        */                                                                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d58   0104     MOVLB     0x4                        ep0Bi.ADR = (byte*)&CtrlTrfData;                                     E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d5a   0e28     MOVLW     0x28                                                                                            
000d5c   6f06     MOVWF     0x6,0x1                                                                                         
000d5e   0e04     MOVLW     0x4                                                                                             
000d60   6f07     MOVWF     0x7,0x1                                                                                         
000d62   0ec8     MOVLW     0xc8                       ep0Bi.Stat._byte = _USIE|_DAT1|_DTSEN;                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d64   6f04     MOVWF     0x4,0x1                                                                                         
                                                   }                                                                        E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d66   d010     BRA       0xd88                  else    // (SetupPkt.DataDir == HOST_TO_DEV)                             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                   {                                                                        E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d68   0100     MOVLB     0x0                        ctrl_trf_state = CTRL_TRF_RX;                                        E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d6a   0e02     MOVLW     0x2                                                                                             
000d6c   6ff4     MOVWF     0xf4,0x1                                                                                        
                                                       /*                                                                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * Control Write:                                                    E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * <SETUP[0]><OUT[1]><OUT[0]>...<IN[1]> | <SETUP[0]>                 E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        *                                                                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * 1. Prepare IN EP to respond to early termination                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        *                                                                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        *    This is the same as a Zero Length Packet Response              E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        *    for control transfer without a data stage                      E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        */                                                                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d6e   0104     MOVLB     0x4                        ep0Bi.Cnt = 0;                                                       E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d70   6b05     CLRF      0x5,0x1                                                                                         
000d72   0ec8     MOVLW     0xc8                       ep0Bi.Stat._byte = _USIE|_DAT1|_DTSEN;                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d74   6f04     MOVWF     0x4,0x1                                                                                         
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                       /*                                                                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        * 2. Prepare OUT EP to receive data.                                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                        */                                                                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d76   0104     MOVLB     0x4                        ep0Bo.Cnt = EP0_BUFF_SIZE;                                           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d78   0e08     MOVLW     0x8                                                                                             
000d7a   6f01     MOVWF     0x1,0x1                                                                                         
000d7c   0e28     MOVLW     0x28                       ep0Bo.ADR = (byte*)&CtrlTrfData;                                     E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d7e   6f02     MOVWF     0x2,0x1                                                                                         
000d80   0e04     MOVLW     0x4                                                                                             
000d82   6f03     MOVWF     0x3,0x1                                                                                         
000d84   0ec8     MOVLW     0xc8                       ep0Bo.Stat._byte = _USIE|_DAT1|_DTSEN;                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d86   6f00     MOVWF     0x0,0x1                                                                                         
                                                   }//end if(SetupPkt.DataDir == DEV_TO_HOST)                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                               }//end if(ctrl_trf_session_owner == MUID_NULL)                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                               /*                                                                           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                * PKTDIS bit is set when a Setup Transaction is received.                   E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                * Clear to resume packet processing.                                        E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                */                                                                          E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d88   986d     BCF       0x6d,0x4,0x0       UCONbits.PKTDIS = 0;                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d8a   0012     RETURN    0x0            }//end USBCtrlEPServiceComplete                                                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Function:        void USBPrepareForNextSetupTrf(void)                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Overview:        The routine forces EP0 OUT to be ready for a new Setup       E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                  transaction, and forces EP0 IN to be owned by CPU.           E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *                                                                               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            * Note:            None                                                         E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           void USBPrepareForNextSetupTrf(void)                                             E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           {                                                                                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d8c   0100     MOVLB     0x0                ctrl_trf_state = WAIT_SETUP;            // See usbctrltrf.h                  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d8e   6bf4     CLRF      0xf4,0x1                                                                                        
000d90   0104     MOVLB     0x4                ep0Bo.Cnt = EP0_BUFF_SIZE;              // Defined in usbcfg.h               E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d92   0e08     MOVLW     0x8                                                                                             
000d94   6f01     MOVWF     0x1,0x1                                                                                         
000d96   0e20     MOVLW     0x20               ep0Bo.ADR = (byte*)&SetupPkt;                                                E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000d98   6f02     MOVWF     0x2,0x1                                                                                         
000d9a   0e04     MOVLW     0x4                                                                                             
000d9c   6f03     MOVWF     0x3,0x1                                                                                         
000d9e   0e88     MOVLW     0x88               ep0Bo.Stat._byte = _USIE|_DAT0|_DTSEN;  // EP0 buff dsc init, see usbmmap.h  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000da0   6f00     MOVWF     0x0,0x1                                                                                         
000da2   0104     MOVLB     0x4                ep0Bi.Stat._byte = _UCPU;               // EP0 IN buffer initialization      E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
000da4   6b04     CLRF      0x4,0x1                                                                                         
000da6   0012     RETURN    0x0            }//end USBPrepareForNextSetupTrf                                                 E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                                                                                                            E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           /** EOF usbctrltrf.c *********************************************************/  E:\usb20\scope\system\usb\usbctrltrf\usbctrltrf.c
                                           /*********************************************************************           E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                Microchip USB C18 Firmware Version 1.0                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            *********************************************************************           E:\usb20\scope\system\usb\usb9\usb9.c
                                            * FileName:        usb9.c                                                       E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Dependencies:    See INCLUDES section below                                   E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Processor:       PIC18                                                        E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Compiler:        C18 2.30.01+                                                 E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Company:         Microchip Technology, Inc.                                   E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Software License Agreement                                                    E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * The software supplied herewith by Microchip Technology Incorporated           E:\usb20\scope\system\usb\usb9\usb9.c
                                            * (the 鼎ompany・ for its PICmicroｮ Microcontroller is intended and             E:\usb20\scope\system\usb\usb9\usb9.c
                                            * supplied to you, the Company痴 customer, for use solely and                   E:\usb20\scope\system\usb\usb9\usb9.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * software is owned by the Company and/or its supplier, and is                  E:\usb20\scope\system\usb\usb9\usb9.c
                                            * protected under applicable copyright laws. All rights are reserved.           E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Any use in violation of the foregoing restrictions may subject the            E:\usb20\scope\system\usb\usb9\usb9.c
                                            * user to criminal sanctions under applicable laws, as well as to               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * civil liability for the breach of the terms and conditions of this            E:\usb20\scope\system\usb\usb9\usb9.c
                                            * license.                                                                      E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * THIS SOFTWARE IS PROVIDED IN AN 鄭S IS・CONDITION. NO WARRANTIES,             E:\usb20\scope\system\usb\usb9\usb9.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             E:\usb20\scope\system\usb\usb9\usb9.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   E:\usb20\scope\system\usb\usb9\usb9.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             E:\usb20\scope\system\usb\usb9\usb9.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    E:\usb20\scope\system\usb\usb9\usb9.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Author               Date        Comment                                      E:\usb20\scope\system\usb\usb9\usb9.c
                                            *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Rawin Rojvanit       11/19/04    Original.                                    E:\usb20\scope\system\usb\usb9\usb9.c
                                            ********************************************************************/           E:\usb20\scope\system\usb\usb9\usb9.c
                                                                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
                                           /** I N C L U D E S **********************************************************/  E:\usb20\scope\system\usb\usb9\usb9.c
                                           #include <p18cxxx.h>                                                             E:\usb20\scope\system\usb\usb9\usb9.c
                                           #include "system\typedefs.h"                                                     E:\usb20\scope\system\usb\usb9\usb9.c
                                           #include "system\usb\usb.h"                                                      E:\usb20\scope\system\usb\usb9\usb9.c
                                           #include "io_cfg.h"                     // Required for self_power status        E:\usb20\scope\system\usb\usb9\usb9.c
                                                                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
                                           /** V A R I A B L E S ********************************************************/  E:\usb20\scope\system\usb\usb9\usb9.c
                                           #pragma udata                                                                    E:\usb20\scope\system\usb\usb9\usb9.c
                                                                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  E:\usb20\scope\system\usb\usb9\usb9.c
                                           void USBStdGetDscHandler(void);                                                  E:\usb20\scope\system\usb\usb9\usb9.c
                                           void USBStdSetCfgHandler(void);                                                  E:\usb20\scope\system\usb\usb9\usb9.c
                                           void USBStdGetStatusHandler(void);                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                           void USBStdFeatureReqHandler(void);                                              E:\usb20\scope\system\usb\usb9\usb9.c
                                                                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
                                           /** D E C L A R A T I O N S **************************************************/  E:\usb20\scope\system\usb\usb9\usb9.c
                                           #pragma code                                                                     E:\usb20\scope\system\usb\usb9\usb9.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Function:        void USBCheckStdRequest(void)                                E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Overview:        This routine checks the setup data packet to see if it       E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                  knows how to handle it                                       E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Note:            None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usb9\usb9.c
                                           void USBCheckStdRequest(void)                                                    E:\usb20\scope\system\usb\usb9\usb9.c
                                           {                                                                                E:\usb20\scope\system\usb\usb9\usb9.c
00079e   0104     MOVLB     0x4                if(SetupPkt.RequestType != STANDARD) return;                                 E:\usb20\scope\system\usb\usb9\usb9.c
0007a0   5120     MOVF      0x20,0x0,0x1                                                                                    
0007a2   0b60     ANDLW     0x60                                                                                            
0007a4   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
0007a6   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
0007a8   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
0007aa   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
0007ac   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
0007ae   0900     IORLW     0x0                                                                                             
0007b0   e001     BZ        0x7b4                                                                                           
0007b2   d055     BRA       0x85e                                                                                           
                                                                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
0007b4   5121     MOVF      0x21,0x0,0x1       switch(SetupPkt.bRequest)                                                    E:\usb20\scope\system\usb\usb9\usb9.c
0007b6   0a07     XORLW     0x7                                                                                             
0007b8   e051     BZ        0x85c                                                                                           
0007ba   0a0b     XORLW     0xb                                                                                             
0007bc   e04f     BZ        0x85c                                                                                           
0007be   0a07     XORLW     0x7                                                                                             
0007c0   e040     BZ        0x842                                                                                           
0007c2   0a01     XORLW     0x1                                                                                             
0007c4   e02c     BZ        0x81e                                                                                           
0007c6   0a0b     XORLW     0xb                                                                                             
0007c8   e028     BZ        0x81a                                                                                           
0007ca   0a02     XORLW     0x2                                                                                             
0007cc   e026     BZ        0x81a                                                                                           
0007ce   0a03     XORLW     0x3                                                                                             
0007d0   e022     BZ        0x816                                                                                           
0007d2   0a08     XORLW     0x8                                                                                             
0007d4   e012     BZ        0x7fa                                                                                           
0007d6   0a01     XORLW     0x1                                                                                             
0007d8   e00e     BZ        0x7f6                                                                                           
0007da   0a0f     XORLW     0xf                                                                                             
0007dc   e00a     BZ        0x7f2                                                                                           
0007de   0a03     XORLW     0x3                                                                                             
0007e0   e001     BZ        0x7e4                                                                                           
0007e2   d03c     BRA       0x85c                                                                                           
                                               {                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
                                                   case SET_ADR:                                                            E:\usb20\scope\system\usb\usb9\usb9.c
0007e4   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;                                  E:\usb20\scope\system\usb\usb9\usb9.c
0007e6   0e01     MOVLW     0x1                                                                                             
0007e8   6ff5     MOVWF     0xf5,0x1                                                                                        
0007ea   0100     MOVLB     0x0                        usb_device_state = ADR_PENDING_STATE;       // Update state only     E:\usb20\scope\system\usb\usb9\usb9.c
0007ec   0e04     MOVLW     0x4                                                                                             
0007ee   6ffc     MOVWF     0xfc,0x1                                                                                        
                                                       /* See USBCtrlTrfInHandler() in usbctrltrf.c for the next step */    E:\usb20\scope\system\usb\usb9\usb9.c
0007f0   d036     BRA       0x85e                      break;                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                                   case GET_DSC:                                                            E:\usb20\scope\system\usb\usb9\usb9.c
0007f2   d836     RCALL     0x860                      USBStdGetDscHandler();                                               E:\usb20\scope\system\usb\usb9\usb9.c
0007f4   d034     BRA       0x85e                      break;                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                                   case SET_CFG:                                                            E:\usb20\scope\system\usb\usb9\usb9.c
0007f6   d890     RCALL     0x918                      USBStdSetCfgHandler();                                               E:\usb20\scope\system\usb\usb9\usb9.c
0007f8   d032     BRA       0x85e                      break;                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                                   case GET_CFG:                                                            E:\usb20\scope\system\usb\usb9\usb9.c
0007fa   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;                                  E:\usb20\scope\system\usb\usb9\usb9.c
0007fc   0e01     MOVLW     0x1                                                                                             
0007fe   6ff5     MOVWF     0xf5,0x1                                                                                        
000800   0100     MOVLB     0x0                        pSrc.bRam = (byte*)&usb_active_cfg;         // Set Source            E:\usb20\scope\system\usb\usb9\usb9.c
000802   0efe     MOVLW     0xfe                                                                                            
000804   6ff6     MOVWF     0xf6,0x1                                                                                        
000806   0e00     MOVLW     0x0                                                                                             
000808   6ff7     MOVWF     0xf7,0x1                                                                                        
00080a   0100     MOVLB     0x0                        usb_stat.ctrl_trf_mem = _RAM;               // Set memory type       E:\usb20\scope\system\usb\usb9\usb9.c
00080c   93fd     BCF       0xfd,0x1,0x1                                                                                    
00080e   0100     MOVLB     0x0                        LSB(wCount) = 1;                            // Set data count        E:\usb20\scope\system\usb\usb9\usb9.c
000810   0e01     MOVLW     0x1                                                                                             
000812   6ffa     MOVWF     0xfa,0x1                                                                                        
000814   d024     BRA       0x85e                      break;                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                                   case GET_STATUS:                                                         E:\usb20\scope\system\usb\usb9\usb9.c
000816   d8a8     RCALL     0x968                      USBStdGetStatusHandler();                                            E:\usb20\scope\system\usb\usb9\usb9.c
000818   d022     BRA       0x85e                      break;                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                                   case CLR_FEATURE:                                                        E:\usb20\scope\system\usb\usb9\usb9.c
                                                   case SET_FEATURE:                                                        E:\usb20\scope\system\usb\usb9\usb9.c
00081a   d8f4     RCALL     0xa04                      USBStdFeatureReqHandler();                                           E:\usb20\scope\system\usb\usb9\usb9.c
00081c   d020     BRA       0x85e                      break;                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                                   case GET_INTF:                                                           E:\usb20\scope\system\usb\usb9\usb9.c
00081e   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;                                  E:\usb20\scope\system\usb\usb9\usb9.c
000820   0e01     MOVLW     0x1                                                                                             
000822   6ff5     MOVWF     0xf5,0x1                                                                                        
000824   0104     MOVLB     0x4                        pSrc.bRam = (byte*)&usb_alt_intf+SetupPkt.bIntfID;  // Set source    E:\usb20\scope\system\usb\usb9\usb9.c
000826   5124     MOVF      0x24,0x0,0x1                                                                                    
000828   0100     MOVLB     0x0                                                                                             
00082a   6ff6     MOVWF     0xf6,0x1                                                                                        
00082c   6bf7     CLRF      0xf7,0x1                                                                                        
00082e   0eff     MOVLW     0xff                                                                                            
000830   27f6     ADDWF     0xf6,0x1,0x1                                                                                    
000832   0e00     MOVLW     0x0                                                                                             
000834   23f7     ADDWFC    0xf7,0x1,0x1                                                                                    
000836   0100     MOVLB     0x0                        usb_stat.ctrl_trf_mem = _RAM;               // Set memory type       E:\usb20\scope\system\usb\usb9\usb9.c
000838   93fd     BCF       0xfd,0x1,0x1                                                                                    
00083a   0100     MOVLB     0x0                        LSB(wCount) = 1;                            // Set data count        E:\usb20\scope\system\usb\usb9\usb9.c
00083c   0e01     MOVLW     0x1                                                                                             
00083e   6ffa     MOVWF     0xfa,0x1                                                                                        
000840   d00e     BRA       0x85e                      break;                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                                   case SET_INTF:                                                           E:\usb20\scope\system\usb\usb9\usb9.c
000842   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;                                  E:\usb20\scope\system\usb\usb9\usb9.c
000844   0e01     MOVLW     0x1                                                                                             
000846   6ff5     MOVWF     0xf5,0x1                                                                                        
000848   0104     MOVLB     0x4                        usb_alt_intf[SetupPkt.bIntfID] = SetupPkt.bAltID;                    E:\usb20\scope\system\usb\usb9\usb9.c
00084a   5124     MOVF      0x24,0x0,0x1                                                                                    
00084c   6aea     CLRF      0xea,0x0                                                                                        
00084e   0fff     ADDLW     0xff                                                                                            
000850   6ee9     MOVWF     0xe9,0x0                                                                                        
000852   0e00     MOVLW     0x0                                                                                             
000854   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
000856   c422     MOVFF     0x422,0xfef                                                                                     
000858   ffef                                                                                                               
00085a   d001     BRA       0x85e                      break;                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                                   case SET_DSC:                                                            E:\usb20\scope\system\usb\usb9\usb9.c
                                                   case SYNCH_FRAME:                                                        E:\usb20\scope\system\usb\usb9\usb9.c
                                                   default:                                                                 E:\usb20\scope\system\usb\usb9\usb9.c
00085c   d000     BRA       0x85e                      break;                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                               }//end switch                                                                E:\usb20\scope\system\usb\usb9\usb9.c
                                                                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
00085e   0012     RETURN    0x0            }//end USBCheckStdRequest                                                        E:\usb20\scope\system\usb\usb9\usb9.c
                                                                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Function:        void USBStdGetDscHandler(void)                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Overview:        This routine handles the standard GET_DESCRIPTOR request.    E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                  It utilizes tables dynamically looks up descriptor size.     E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                  This routine should never have to be modified if the tables  E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                  in usbdsc.c are declared correctly.                          E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Note:            None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usb9\usb9.c
                                           void USBStdGetDscHandler(void)                                                   E:\usb20\scope\system\usb\usb9\usb9.c
                                           {                                                                                E:\usb20\scope\system\usb\usb9\usb9.c
000860   0e80     MOVLW     0x80               if(SetupPkt.bmRequestType == 0x80)                                           E:\usb20\scope\system\usb\usb9\usb9.c
000862   0104     MOVLB     0x4                                                                                             
000864   5d20     SUBWF     0x20,0x0,0x1                                                                                    
000866   e157     BNZ       0x916                                                                                           
                                               {                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
000868   5123     MOVF      0x23,0x0,0x1           switch(SetupPkt.bDscType)                                                E:\usb20\scope\system\usb\usb9\usb9.c
00086a   0a03     XORLW     0x3                                                                                             
00086c   e034     BZ        0x8d6                                                                                           
00086e   0a01     XORLW     0x1                                                                                             
000870   e010     BZ        0x892                                                                                           
000872   0a03     XORLW     0x3                                                                                             
000874   e001     BZ        0x878                                                                                           
000876   d04d     BRA       0x912                                                                                           
                                                   {                                                                        E:\usb20\scope\system\usb\usb9\usb9.c
                                                       case DSC_DEV:                                                        E:\usb20\scope\system\usb\usb9\usb9.c
000878   0100     MOVLB     0x0                            ctrl_trf_session_owner = MUID_USB9;                              E:\usb20\scope\system\usb\usb9\usb9.c
00087a   0e01     MOVLW     0x1                                                                                             
00087c   6ff5     MOVWF     0xf5,0x1                                                                                        
00087e   0100     MOVLB     0x0                            pSrc.bRom = (rom byte*)&device_dsc;                              E:\usb20\scope\system\usb\usb9\usb9.c
000880   0e1c     MOVLW     0x1c                                                                                            
000882   6ff6     MOVWF     0xf6,0x1                                                                                        
000884   0e0f     MOVLW     0xf                                                                                             
000886   6ff7     MOVWF     0xf7,0x1                                                                                        
000888   0e12     MOVLW     0x12                           wCount._word = sizeof(device_dsc);          // Set data count    E:\usb20\scope\system\usb\usb9\usb9.c
00088a   0100     MOVLB     0x0                                                                                             
00088c   6ffa     MOVWF     0xfa,0x1                                                                                        
00088e   6bfb     CLRF      0xfb,0x1                                                                                        
000890   d040     BRA       0x912                          break;                                                           E:\usb20\scope\system\usb\usb9\usb9.c
                                                       case DSC_CFG:                                                        E:\usb20\scope\system\usb\usb9\usb9.c
000892   0100     MOVLB     0x0                            ctrl_trf_session_owner = MUID_USB9;                              E:\usb20\scope\system\usb\usb9\usb9.c
000894   0e01     MOVLW     0x1                                                                                             
000896   6ff5     MOVWF     0xf5,0x1                                                                                        
000898   0104     MOVLB     0x4                            pSrc.bRom = *(USB_CD_Ptr+SetupPkt.bDscIndex);                    E:\usb20\scope\system\usb\usb9\usb9.c
00089a   5122     MOVF      0x22,0x0,0x1                                                                                    
00089c   6ef6     MOVWF     0xf6,0x0                                                                                        
00089e   6af7     CLRF      0xf7,0x0                                                                                        
0008a0   90d8     BCF       0xd8,0x0,0x0                                                                                    
0008a2   36f6     RLCF      0xf6,0x1,0x0                                                                                    
0008a4   36f7     RLCF      0xf7,0x1,0x0                                                                                    
0008a6   0ec1     MOVLW     0xc1                                                                                            
0008a8   26f6     ADDWF     0xf6,0x1,0x0                                                                                    
0008aa   0e0f     MOVLW     0xf                                                                                             
0008ac   22f7     ADDWFC    0xf7,0x1,0x0                                                                                    
0008ae   0009     TBLRDPOSTINC                                                                                              
0008b0   cff5     MOVFF     0xff5,0xf6                                                                                      
0008b2   f0f6                                                                                                               
0008b4   000a     TBLRDPOSTDEC                                                                                              
0008b6   cff5     MOVFF     0xff5,0xf7                                                                                      
0008b8   f0f7                                                                                                               
0008ba   0e02     MOVLW     0x2                            wCount._word = *(pSrc.wRom+1);              // Set data count    E:\usb20\scope\system\usb\usb9\usb9.c
0008bc   0100     MOVLB     0x0                                                                                             
0008be   6af7     CLRF      0xf7,0x0                                                                                        
0008c0   25f6     ADDWF     0xf6,0x0,0x1                                                                                    
0008c2   6ef6     MOVWF     0xf6,0x0                                                                                        
0008c4   51f7     MOVF      0xf7,0x0,0x1                                                                                    
0008c6   22f7     ADDWFC    0xf7,0x1,0x0                                                                                    
0008c8   0009     TBLRDPOSTINC                                                                                              
0008ca   cff5     MOVFF     0xff5,0xfa                                                                                      
0008cc   f0fa                                                                                                               
0008ce   000a     TBLRDPOSTDEC                                                                                              
0008d0   cff5     MOVFF     0xff5,0xfb                                                                                      
0008d2   f0fb                                                                                                               
0008d4   d01e     BRA       0x912                          break;                                                           E:\usb20\scope\system\usb\usb9\usb9.c
                                                       case DSC_STR:                                                        E:\usb20\scope\system\usb\usb9\usb9.c
0008d6   0100     MOVLB     0x0                            ctrl_trf_session_owner = MUID_USB9;                              E:\usb20\scope\system\usb\usb9\usb9.c
0008d8   0e01     MOVLW     0x1                                                                                             
0008da   6ff5     MOVWF     0xf5,0x1                                                                                        
0008dc   0104     MOVLB     0x4                            pSrc.bRom = *(USB_SD_Ptr+SetupPkt.bDscIndex);                    E:\usb20\scope\system\usb\usb9\usb9.c
0008de   5122     MOVF      0x22,0x0,0x1                                                                                    
0008e0   6ef6     MOVWF     0xf6,0x0                                                                                        
0008e2   6af7     CLRF      0xf7,0x0                                                                                        
0008e4   90d8     BCF       0xd8,0x0,0x0                                                                                    
0008e6   36f6     RLCF      0xf6,0x1,0x0                                                                                    
0008e8   36f7     RLCF      0xf7,0x1,0x0                                                                                    
0008ea   0ec5     MOVLW     0xc5                                                                                            
0008ec   26f6     ADDWF     0xf6,0x1,0x0                                                                                    
0008ee   0e0f     MOVLW     0xf                                                                                             
0008f0   22f7     ADDWFC    0xf7,0x1,0x0                                                                                    
0008f2   0009     TBLRDPOSTINC                                                                                              
0008f4   cff5     MOVFF     0xff5,0xf6                                                                                      
0008f6   f0f6                                                                                                               
0008f8   000a     TBLRDPOSTDEC                                                                                              
0008fa   cff5     MOVFF     0xff5,0xf7                                                                                      
0008fc   f0f7                                                                                                               
0008fe   c0f6     MOVFF     0xf6,0xff6                     wCount._word = *pSrc.bRom;                  // Set data count    E:\usb20\scope\system\usb\usb9\usb9.c
000900   fff6                                                                                                               
000902   c0f7     MOVFF     0xf7,0xff7                                                                                      
000904   fff7                                                                                                               
000906   0008     TBLRD                                                                                                     
000908   50f5     MOVF      0xf5,0x0,0x0                                                                                    
00090a   0100     MOVLB     0x0                                                                                             
00090c   6ffa     MOVWF     0xfa,0x1                                                                                        
00090e   6bfb     CLRF      0xfb,0x1                                                                                        
000910   d000     BRA       0x912                          break;                                                           E:\usb20\scope\system\usb\usb9\usb9.c
                                                   }//end switch                                                            E:\usb20\scope\system\usb\usb9\usb9.c
                                                                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
000912   0100     MOVLB     0x0                    usb_stat.ctrl_trf_mem = _ROM;                       // Set memory type   E:\usb20\scope\system\usb\usb9\usb9.c
000914   83fd     BSF       0xfd,0x1,0x1                                                                                    
                                               }//end if                                                                    E:\usb20\scope\system\usb\usb9\usb9.c
000916   0012     RETURN    0x0            }//end USBStdGetDscHandler                                                       E:\usb20\scope\system\usb\usb9\usb9.c
                                                                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Function:        void USBStdSetCfgHandler(void)                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Overview:        This routine first disables all endpoints by clearing        E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                  UEP registers. It then configures (initializes) endpoints    E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                  specified in the modifiable section.                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Note:            None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usb9\usb9.c
                                           void USBStdSetCfgHandler(void)                                                   E:\usb20\scope\system\usb\usb9\usb9.c
                                           {                                                                                E:\usb20\scope\system\usb\usb9\usb9.c
000918   0100     MOVLB     0x0                ctrl_trf_session_owner = MUID_USB9;                                          E:\usb20\scope\system\usb\usb9\usb9.c
00091a   0e01     MOVLW     0x1                                                                                             
00091c   6ff5     MOVWF     0xf5,0x1                                                                                        
00091e   0e0f     MOVLW     0xf                mDisableEP1to15();                          // See usbdrv.h                  E:\usb20\scope\system\usb\usb9\usb9.c
000920   6ee6     MOVWF     0xe6,0x0                                                                                        
000922   0e71     MOVLW     0x71                                                                                            
000924   6ee6     MOVWF     0xe6,0x0                                                                                        
000926   0e0f     MOVLW     0xf                                                                                             
000928   6ee6     MOVWF     0xe6,0x0                                                                                        
00092a   ec79     CALL      0xef2,0x0                                                                                       
00092c   f007                                                                                                               
00092e   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000930   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000932   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000934   0e01     MOVLW     0x1                ClearArray((byte*)&usb_alt_intf,MAX_NUM_INT);                                E:\usb20\scope\system\usb\usb9\usb9.c
000936   6ee6     MOVWF     0xe6,0x0                                                                                        
000938   0eff     MOVLW     0xff                                                                                            
00093a   6ee6     MOVWF     0xe6,0x0                                                                                        
00093c   0e00     MOVLW     0x0                                                                                             
00093e   6ee6     MOVWF     0xe6,0x0                                                                                        
000940   ec79     CALL      0xef2,0x0                                                                                       
000942   f007                                                                                                               
000944   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000946   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000948   52e5     MOVF      0xe5,0x1,0x0                                                                                    
00094a   c422     MOVFF     0x422,0xfe         usb_active_cfg = SetupPkt.bCfgValue;                                         E:\usb20\scope\system\usb\usb9\usb9.c
00094c   f0fe                                                                                                               
00094e   0104     MOVLB     0x4                if(SetupPkt.bCfgValue == 0)                                                  E:\usb20\scope\system\usb\usb9\usb9.c
000950   5122     MOVF      0x22,0x0,0x1                                                                                    
000952   e104     BNZ       0x95c                                                                                           
000954   0100     MOVLB     0x0                    usb_device_state = ADDRESS_STATE;                                        E:\usb20\scope\system\usb\usb9\usb9.c
000956   0e05     MOVLW     0x5                                                                                             
000958   6ffc     MOVWF     0xfc,0x1                                                                                        
00095a   d005     BRA       0x966              else                                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                               {                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
00095c   0100     MOVLB     0x0                    usb_device_state = CONFIGURED_STATE;                                     E:\usb20\scope\system\usb\usb9\usb9.c
00095e   0e06     MOVLW     0x6                                                                                             
000960   6ffc     MOVWF     0xfc,0x1                                                                                        
                                                                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
                                                   /* Modifiable Section */                                                 E:\usb20\scope\system\usb\usb9\usb9.c
                                                                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
                                                   #if defined(USB_USE_CDC)                // See autofiles\usbcfg.h        E:\usb20\scope\system\usb\usb9\usb9.c
000962   ec74     CALL      0x4e8,0x0              CDCInitEP();                                                             E:\usb20\scope\system\usb\usb9\usb9.c
000964   f002                                                                                                               
                                                   #endif                                                                   E:\usb20\scope\system\usb\usb9\usb9.c
                                                                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
                                                   /* End modifiable section */                                             E:\usb20\scope\system\usb\usb9\usb9.c
                                                                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
                                               }//end if(SetupPkt.bcfgValue == 0)                                           E:\usb20\scope\system\usb\usb9\usb9.c
000966   0012     RETURN    0x0            }//end USBStdSetCfgHandler                                                       E:\usb20\scope\system\usb\usb9\usb9.c
                                                                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Function:        void USBStdGetStatusHandler(void)                            E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Overview:        This routine handles the standard GET_STATUS request         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Note:            None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usb9\usb9.c
                                           void USBStdGetStatusHandler(void)                                                E:\usb20\scope\system\usb\usb9\usb9.c
                                           {                                                                                E:\usb20\scope\system\usb\usb9\usb9.c
000968   0104     MOVLB     0x4                CtrlTrfData._byte0 = 0;                         // Initialize content        E:\usb20\scope\system\usb\usb9\usb9.c
00096a   6b28     CLRF      0x28,0x1                                                                                        
00096c   6b29     CLRF      0x29,0x1           CtrlTrfData._byte1 = 0;                                                      E:\usb20\scope\system\usb\usb9\usb9.c
                                                                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
00096e   0104     MOVLB     0x4                switch(SetupPkt.Recipient)                                                   E:\usb20\scope\system\usb\usb9\usb9.c
000970   5120     MOVF      0x20,0x0,0x1                                                                                    
000972   0b1f     ANDLW     0x1f                                                                                            
000974   0a02     XORLW     0x2                                                                                             
000976   e014     BZ        0x9a0                                                                                           
000978   0a03     XORLW     0x3                                                                                             
00097a   e00e     BZ        0x998                                                                                           
00097c   0a01     XORLW     0x1                                                                                             
00097e   e001     BZ        0x982                                                                                           
000980   d033     BRA       0x9e8                                                                                           
                                               {                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
                                                   case RCPT_DEV:                                                           E:\usb20\scope\system\usb\usb9\usb9.c
000982   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;                                  E:\usb20\scope\system\usb\usb9\usb9.c
000984   0e01     MOVLW     0x1                                                                                             
000986   6ff5     MOVWF     0xf5,0x1                                                                                        
                                                       /*                                                                   E:\usb20\scope\system\usb\usb9\usb9.c
                                                        * _byte0: bit0: Self-Powered Status [0] Bus-Powered [1] Self-Powered E:\usb20\scope\system\usb\usb9\usb9.c
                                                        *         bit1: RemoteWakeup        [0] Disabled    [1] Enabled     E:\usb20\scope\system\usb\usb9\usb9.c
                                                        */                                                                  E:\usb20\scope\system\usb\usb9\usb9.c
                                                       if(self_power == 1)                     // self_power defined in io_cfg.h E:\usb20\scope\system\usb\usb9\usb9.c
000988   0104     MOVLB     0x4                            CtrlTrfData._byte0|=0b000000001;    // Set bit0                  E:\usb20\scope\system\usb\usb9\usb9.c
00098a   8128     BSF       0x28,0x0,0x1                                                                                    
                                                                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
00098c   0100     MOVLB     0x0                        if(usb_stat.RemoteWakeup == 1)          // usb_stat defined in usbmmap.c E:\usb20\scope\system\usb\usb9\usb9.c
00098e   a1fd     BTFSS     0xfd,0x0,0x1                                                                                    
000990   d002     BRA       0x996                                                                                           
000992   0104     MOVLB     0x4                            CtrlTrfData._byte0|=0b00000010;     // Set bit1                  E:\usb20\scope\system\usb\usb9\usb9.c
000994   8328     BSF       0x28,0x1,0x1                                                                                    
000996   d028     BRA       0x9e8                      break;                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                                   case RCPT_INTF:                                                          E:\usb20\scope\system\usb\usb9\usb9.c
000998   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;     // No data to update         E:\usb20\scope\system\usb\usb9\usb9.c
00099a   0e01     MOVLW     0x1                                                                                             
00099c   6ff5     MOVWF     0xf5,0x1                                                                                        
00099e   d024     BRA       0x9e8                      break;                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                                   case RCPT_EP:                                                            E:\usb20\scope\system\usb\usb9\usb9.c
0009a0   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_USB9;                                  E:\usb20\scope\system\usb\usb9\usb9.c
0009a2   0e01     MOVLW     0x1                                                                                             
0009a4   6ff5     MOVWF     0xf5,0x1                                                                                        
                                                       /*                                                                   E:\usb20\scope\system\usb\usb9\usb9.c
                                                        * _byte0: bit0: Halt Status [0] Not Halted [1] Halted               E:\usb20\scope\system\usb\usb9\usb9.c
                                                        */                                                                  E:\usb20\scope\system\usb\usb9\usb9.c
0009a6   0104     MOVLB     0x4                        pDst.bRam = (byte*)&ep0Bo+(SetupPkt.EPNum*8)+(SetupPkt.EPDir*4);     E:\usb20\scope\system\usb\usb9\usb9.c
0009a8   5124     MOVF      0x24,0x0,0x1                                                                                    
0009aa   0b0f     ANDLW     0xf                                                                                             
0009ac   0d08     MULLW     0x8                                                                                             
0009ae   50f3     MOVF      0xf3,0x0,0x0                                                                                    
0009b0   6a15     CLRF      0x15,0x0                                                                                        
0009b2   0f00     ADDLW     0x0                                                                                             
0009b4   6e14     MOVWF     0x14,0x0                                                                                        
0009b6   0e04     MOVLW     0x4                                                                                             
0009b8   2215     ADDWFC    0x15,0x1,0x0                                                                                    
0009ba   5124     MOVF      0x24,0x0,0x1                                                                                    
0009bc   0b80     ANDLW     0x80                                                                                            
0009be   e001     BZ        0x9c2                                                                                           
0009c0   0e01     MOVLW     0x1                                                                                             
0009c2   0d04     MULLW     0x4                                                                                             
0009c4   50f3     MOVF      0xf3,0x0,0x0                                                                                    
0009c6   0100     MOVLB     0x0                                                                                             
0009c8   2414     ADDWF     0x14,0x0,0x0                                                                                    
0009ca   6ff8     MOVWF     0xf8,0x1                                                                                        
0009cc   0e00     MOVLW     0x0                                                                                             
0009ce   2015     ADDWFC    0x15,0x0,0x0                                                                                    
0009d0   6ff9     MOVWF     0xf9,0x1                                                                                        
0009d2   c0f8     MOVFF     0xf8,0xfe9                 if(*pDst.bRam & _BSTALL)    // Use _BSTALL as a bit mask             E:\usb20\scope\system\usb\usb9\usb9.c
0009d4   ffe9                                                                                                               
0009d6   c0f9     MOVFF     0xf9,0xfea                                                                                      
0009d8   ffea                                                                                                               
0009da   50ef     MOVF      0xef,0x0,0x0                                                                                    
0009dc   0b04     ANDLW     0x4                                                                                             
0009de   e003     BZ        0x9e6                                                                                           
0009e0   0104     MOVLB     0x4                            CtrlTrfData._byte0=0x01;// Set bit0                              E:\usb20\scope\system\usb\usb9\usb9.c
0009e2   0e01     MOVLW     0x1                                                                                             
0009e4   6f28     MOVWF     0x28,0x1                                                                                        
0009e6   d000     BRA       0x9e8                      break;                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                               }//end switch                                                                E:\usb20\scope\system\usb\usb9\usb9.c
                                                                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
0009e8   0100     MOVLB     0x0                if(ctrl_trf_session_owner == MUID_USB9)                                      E:\usb20\scope\system\usb\usb9\usb9.c
0009ea   05f5     DECF      0xf5,0x0,0x1                                                                                    
0009ec   e10a     BNZ       0xa02                                                                                           
                                               {                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
0009ee   0100     MOVLB     0x0                    pSrc.bRam = (byte*)&CtrlTrfData;            // Set Source                E:\usb20\scope\system\usb\usb9\usb9.c
0009f0   0e28     MOVLW     0x28                                                                                            
0009f2   6ff6     MOVWF     0xf6,0x1                                                                                        
0009f4   0e04     MOVLW     0x4                                                                                             
0009f6   6ff7     MOVWF     0xf7,0x1                                                                                        
0009f8   0100     MOVLB     0x0                    usb_stat.ctrl_trf_mem = _RAM;               // Set memory type           E:\usb20\scope\system\usb\usb9\usb9.c
0009fa   93fd     BCF       0xfd,0x1,0x1                                                                                    
0009fc   0100     MOVLB     0x0                    LSB(wCount) = 2;                            // Set data count            E:\usb20\scope\system\usb\usb9\usb9.c
0009fe   0e02     MOVLW     0x2                                                                                             
000a00   6ffa     MOVWF     0xfa,0x1                                                                                        
                                               }//end if(...)                                                               E:\usb20\scope\system\usb\usb9\usb9.c
000a02   0012     RETURN    0x0            }//end USBStdGetStatusHandler                                                    E:\usb20\scope\system\usb\usb9\usb9.c
                                                                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Function:        void USBStdFeatureReqHandler(void)                           E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Overview:        This routine handles the standard SET & CLEAR FEATURES       E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                  requests                                                     E:\usb20\scope\system\usb\usb9\usb9.c
                                            *                                                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                            * Note:            None                                                         E:\usb20\scope\system\usb\usb9\usb9.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\usb9\usb9.c
                                           void USBStdFeatureReqHandler(void)                                               E:\usb20\scope\system\usb\usb9\usb9.c
                                           {                                                                                E:\usb20\scope\system\usb\usb9\usb9.c
000a04   0104     MOVLB     0x4                if((SetupPkt.bFeature == DEVICE_REMOTE_WAKEUP)&&                             E:\usb20\scope\system\usb\usb9\usb9.c
000a06   0522     DECF      0x22,0x0,0x1                                                                                    
000a08   e110     BNZ       0xa2a                 (SetupPkt.Recipient == RCPT_DEV))                                         E:\usb20\scope\system\usb\usb9\usb9.c
000a0a   5120     MOVF      0x20,0x0,0x1                                                                                    
000a0c   0b1f     ANDLW     0x1f                                                                                            
000a0e   0900     IORLW     0x0                                                                                             
000a10   e10c     BNZ       0xa2a                                                                                           
                                               {                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
000a12   0100     MOVLB     0x0                    ctrl_trf_session_owner = MUID_USB9;                                      E:\usb20\scope\system\usb\usb9\usb9.c
000a14   0e01     MOVLW     0x1                                                                                             
000a16   6ff5     MOVWF     0xf5,0x1                                                                                        
000a18   0e03     MOVLW     0x3                    if(SetupPkt.bRequest == SET_FEATURE)                                     E:\usb20\scope\system\usb\usb9\usb9.c
000a1a   0104     MOVLB     0x4                                                                                             
000a1c   5d21     SUBWF     0x21,0x0,0x1                                                                                    
000a1e   e103     BNZ       0xa26                                                                                           
000a20   0100     MOVLB     0x0                        usb_stat.RemoteWakeup = 1;                                           E:\usb20\scope\system\usb\usb9\usb9.c
000a22   81fd     BSF       0xfd,0x0,0x1                                                                                    
000a24   d002     BRA       0xa2a                  else                                                                     E:\usb20\scope\system\usb\usb9\usb9.c
000a26   0100     MOVLB     0x0                        usb_stat.RemoteWakeup = 0;                                           E:\usb20\scope\system\usb\usb9\usb9.c
000a28   91fd     BCF       0xfd,0x0,0x1                                                                                    
                                               }//end if                                                                    E:\usb20\scope\system\usb\usb9\usb9.c
                                                                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
000a2a   0104     MOVLB     0x4                if((SetupPkt.bFeature == ENDPOINT_HALT)&&                                    E:\usb20\scope\system\usb\usb9\usb9.c
000a2c   5122     MOVF      0x22,0x0,0x1                                                                                    
000a2e   e13a     BNZ       0xaa4                 (SetupPkt.Recipient == RCPT_EP)&&                                         E:\usb20\scope\system\usb\usb9\usb9.c
000a30   5120     MOVF      0x20,0x0,0x1                                                                                    
000a32   0b1f     ANDLW     0x1f                                                                                            
000a34   0802     SUBLW     0x2                                                                                             
000a36   e136     BNZ       0xaa4                                                                                           
000a38   5124     MOVF      0x24,0x0,0x1          (SetupPkt.EPNum != 0))                                                    E:\usb20\scope\system\usb\usb9\usb9.c
000a3a   0b0f     ANDLW     0xf                                                                                             
000a3c   0900     IORLW     0x0                                                                                             
000a3e   e032     BZ        0xaa4                                                                                           
                                               {                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
000a40   0100     MOVLB     0x0                    ctrl_trf_session_owner = MUID_USB9;                                      E:\usb20\scope\system\usb\usb9\usb9.c
000a42   0e01     MOVLW     0x1                                                                                             
000a44   6ff5     MOVWF     0xf5,0x1                                                                                        
                                                   /* Must do address calculation here */                                   E:\usb20\scope\system\usb\usb9\usb9.c
000a46   0104     MOVLB     0x4                    pDst.bRam = (byte*)&ep0Bo+(SetupPkt.EPNum*8)+(SetupPkt.EPDir*4);         E:\usb20\scope\system\usb\usb9\usb9.c
000a48   5124     MOVF      0x24,0x0,0x1                                                                                    
000a4a   0b0f     ANDLW     0xf                                                                                             
000a4c   0d08     MULLW     0x8                                                                                             
000a4e   50f3     MOVF      0xf3,0x0,0x0                                                                                    
000a50   6a15     CLRF      0x15,0x0                                                                                        
000a52   0f00     ADDLW     0x0                                                                                             
000a54   6e14     MOVWF     0x14,0x0                                                                                        
000a56   0e04     MOVLW     0x4                                                                                             
000a58   2215     ADDWFC    0x15,0x1,0x0                                                                                    
000a5a   5124     MOVF      0x24,0x0,0x1                                                                                    
000a5c   0b80     ANDLW     0x80                                                                                            
000a5e   e001     BZ        0xa62                                                                                           
000a60   0e01     MOVLW     0x1                                                                                             
000a62   0d04     MULLW     0x4                                                                                             
000a64   50f3     MOVF      0xf3,0x0,0x0                                                                                    
000a66   0100     MOVLB     0x0                                                                                             
000a68   2414     ADDWF     0x14,0x0,0x0                                                                                    
000a6a   6ff8     MOVWF     0xf8,0x1                                                                                        
000a6c   0e00     MOVLW     0x0                                                                                             
000a6e   2015     ADDWFC    0x15,0x0,0x0                                                                                    
000a70   6ff9     MOVWF     0xf9,0x1                                                                                        
                                                                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
000a72   0e03     MOVLW     0x3                    if(SetupPkt.bRequest == SET_FEATURE)                                     E:\usb20\scope\system\usb\usb9\usb9.c
000a74   0104     MOVLB     0x4                                                                                             
000a76   5d21     SUBWF     0x21,0x0,0x1                                                                                    
000a78   e107     BNZ       0xa88                                                                                           
000a7a   0e84     MOVLW     0x84                       *pDst.bRam = _USIE|_BSTALL;                                          E:\usb20\scope\system\usb\usb9\usb9.c
000a7c   c0f8     MOVFF     0xf8,0xfe9                                                                                      
000a7e   ffe9                                                                                                               
000a80   c0f9     MOVFF     0xf9,0xfea                                                                                      
000a82   ffea                                                                                                               
000a84   6eef     MOVWF     0xef,0x0                                                                                        
000a86   d00e     BRA       0xaa4                  else                                                                     E:\usb20\scope\system\usb\usb9\usb9.c
                                                   {                                                                        E:\usb20\scope\system\usb\usb9\usb9.c
000a88   af24     BTFSS     0x24,0x7,0x1               if(SetupPkt.EPDir == 1) // IN                                        E:\usb20\scope\system\usb\usb9\usb9.c
000a8a   d006     BRA       0xa98                                                                                           
000a8c   c0f8     MOVFF     0xf8,0xfe9                     *pDst.bRam = _UCPU;                                              E:\usb20\scope\system\usb\usb9\usb9.c
000a8e   ffe9                                                                                                               
000a90   c0f9     MOVFF     0xf9,0xfea                                                                                      
000a92   ffea                                                                                                               
000a94   6aef     CLRF      0xef,0x0                                                                                        
000a96   d006     BRA       0xaa4                      else                                                                 E:\usb20\scope\system\usb\usb9\usb9.c
000a98   0e88     MOVLW     0x88                           *pDst.bRam = _USIE|_DAT0|_DTSEN;                                 E:\usb20\scope\system\usb\usb9\usb9.c
000a9a   c0f8     MOVFF     0xf8,0xfe9                                                                                      
000a9c   ffe9                                                                                                               
000a9e   c0f9     MOVFF     0xf9,0xfea                                                                                      
000aa0   ffea                                                                                                               
000aa2   6eef     MOVWF     0xef,0x0                                                                                        
                                                   }//end if                                                                E:\usb20\scope\system\usb\usb9\usb9.c
                                               }//end if                                                                    E:\usb20\scope\system\usb\usb9\usb9.c
000aa4   0012     RETURN    0x0            }//end USBStdFeatureReqHandler                                                   E:\usb20\scope\system\usb\usb9\usb9.c
                                                                                                                            E:\usb20\scope\system\usb\usb9\usb9.c
                                           /** EOF usb9.c ***************************************************************/  E:\usb20\scope\system\usb\usb9\usb9.c
                                           /*********************************************************************           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *             Microchip USB C18 Firmware -  CDC Version 1.0                     E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *********************************************************************           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * FileName:        cdc.c                                                        E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Dependencies:    See INCLUDES section below                                   E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Processor:       PIC18                                                        E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Compiler:        C18 2.30.01+                                                 E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Company:         Microchip Technology, Inc.                                   E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Software License Agreement                                                    E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * The software supplied herewith by Microchip Technology Incorporated           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * (the 鼎ompany) for its PICmicroｮ Microcontroller is intended and             E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * supplied to you, the Company痴 customer, for use solely and                   E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * software is owned by the Company and/or its supplier, and is                  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * protected under applicable copyright laws. All rights are reserved.           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Any use in violation of the foregoing restrictions may subject the            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * user to criminal sanctions under applicable laws, as well as to               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * civil liability for the breach of the terms and conditions of this            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * license.                                                                      E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * THIS SOFTWARE IS PROVIDED IN AN 鄭S IS CONDITION. NO WARRANTIES,             E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Author               Date        Comment                                      E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Rawin Rojvanit       11/19/04    Original. RS-232 Emulation Subset            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            ********************************************************************/           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           /** I N C L U D E S **********************************************************/  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           #include <p18cxxx.h>                                                             E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           #include "system\typedefs.h"                                                     E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           #include "system\usb\usb.h"                                                      E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           #ifdef USB_USE_CDC                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           /** V A R I A B L E S ********************************************************/  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           #pragma udata                                                                    E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           byte cdc_rx_len;            // total rx length                                   E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           byte cdc_trf_state;         // States are defined cdc.h                          E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           POINTER pCDCSrc;            // Dedicated source pointer                          E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           POINTER pCDCDst;            // Dedicated destination pointer                     E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           byte cdc_tx_len;            // total tx length                                   E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           byte cdc_mem_type;          // _ROM, _RAM                                        E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           LINE_CODING line_coding;    // Buffer to store line coding information           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           CONTROL_SIGNAL_BITMAP control_signal_bitmap;                                     E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           /*                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * SEND_ENCAPSULATED_COMMAND and GET_ENCAPSULATED_RESPONSE are required          E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * requests according to the CDC specification.                                  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * However, it is not really being used here, therefore a dummy buffer is        E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * used for conformance.                                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            */                                                                              E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           #define dummy_length    0x08                                                     E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           byte dummy_encapsulated_cmd_response[dummy_length];                              E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           /** D E C L A R A T I O N S **************************************************/  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           #pragma code                                                                     E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           /** C L A S S  S P E C I F I C  R E Q ****************************************/  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Function:        void USBCheckCDCRequest(void)                                E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Overview:        This routine checks the setup data packet to see if it       E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  knows how to handle it                                       E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Note:            None                                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           void USBCheckCDCRequest(void)                                                    E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           {                                                                                E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               /*                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * If request recipient is not an interface then return                      E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                */                                                                          E:\usb20\scope\system\usb\class\cdc\cdc.c
000424   0104     MOVLB     0x4                if(SetupPkt.Recipient != RCPT_INTF) return;                                  E:\usb20\scope\system\usb\class\cdc\cdc.c
000426   5120     MOVF      0x20,0x0,0x1                                                                                    
000428   0b1f     ANDLW     0x1f                                                                                            
00042a   0801     SUBLW     0x1                                                                                             
00042c   e001     BZ        0x430                                                                                           
00042e   d05b     BRA       0x4e6                                                                                           
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               /*                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * If request type is not class-specific then return                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                */                                                                          E:\usb20\scope\system\usb\class\cdc\cdc.c
000430   5120     MOVF      0x20,0x0,0x1       if(SetupPkt.RequestType != CLASS) return;                                    E:\usb20\scope\system\usb\class\cdc\cdc.c
000432   0b60     ANDLW     0x60                                                                                            
000434   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
000436   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
000438   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
00043a   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
00043c   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
00043e   0801     SUBLW     0x1                                                                                             
000440   e001     BZ        0x444                                                                                           
000442   d051     BRA       0x4e6                                                                                           
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               /*                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * Interface ID must match interface numbers associated with                 E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * CDC class, else return                                                    E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                */                                                                          E:\usb20\scope\system\usb\class\cdc\cdc.c
000444   5124     MOVF      0x24,0x0,0x1       if((SetupPkt.bIntfID != CDC_COMM_INTF_ID)&&                                  E:\usb20\scope\system\usb\class\cdc\cdc.c
000446   e003     BZ        0x44e                 (SetupPkt.bIntfID != CDC_DATA_INTF_ID)) return;                           E:\usb20\scope\system\usb\class\cdc\cdc.c
000448   0524     DECF      0x24,0x0,0x1                                                                                    
00044a   e001     BZ        0x44e                                                                                           
00044c   d04c     BRA       0x4e6                                                                                           
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
00044e   5121     MOVF      0x21,0x0,0x1       switch(SetupPkt.bRequest)                                                    E:\usb20\scope\system\usb\class\cdc\cdc.c
000450   0a23     XORLW     0x23                                                                                            
000452   e048     BZ        0x4e4                                                                                           
000454   0a01     XORLW     0x1                                                                                             
000456   e040     BZ        0x4d8                                                                                           
000458   0a03     XORLW     0x3                                                                                             
00045a   e030     BZ        0x4bc                                                                                           
00045c   0a01     XORLW     0x1                                                                                             
00045e   e025     BZ        0x4aa                                                                                           
000460   0a24     XORLW     0x24                                                                                            
000462   e022     BZ        0x4a8                                                                                           
000464   0a07     XORLW     0x7                                                                                             
000466   e01f     BZ        0x4a6                                                                                           
000468   0a01     XORLW     0x1                                                                                             
00046a   e01c     BZ        0x4a4                                                                                           
00046c   0a03     XORLW     0x3                                                                                             
00046e   e011     BZ        0x492                                                                                           
000470   0a01     XORLW     0x1                                                                                             
000472   e001     BZ        0x476                                                                                           
                                               {                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                   case SEND_ENCAPSULATED_COMMAND:                                          E:\usb20\scope\system\usb\class\cdc\cdc.c
000476   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_CDC;                                   E:\usb20\scope\system\usb\class\cdc\cdc.c
000478   0e03     MOVLW     0x3                                                                                             
00047a   6ff5     MOVWF     0xf5,0x1                                                                                        
00047c   0100     MOVLB     0x0                        pSrc.bRam = (byte*)&dummy_encapsulated_cmd_response;                 E:\usb20\scope\system\usb\class\cdc\cdc.c
00047e   0ed3     MOVLW     0xd3                                                                                            
000480   6ff6     MOVWF     0xf6,0x1                                                                                        
000482   0e07     MOVLW     0x7                                                                                             
000484   6ff7     MOVWF     0xf7,0x1                                                                                        
000486   0100     MOVLB     0x0                        usb_stat.ctrl_trf_mem = _RAM;                                        E:\usb20\scope\system\usb\class\cdc\cdc.c
000488   93fd     BCF       0xfd,0x1,0x1                                                                                    
00048a   0100     MOVLB     0x0                        LSB(wCount) = dummy_length;                                          E:\usb20\scope\system\usb\class\cdc\cdc.c
00048c   0e08     MOVLW     0x8                                                                                             
00048e   6ffa     MOVWF     0xfa,0x1                                                                                        
000490   d02a     BRA       0x4e6                      break;                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                   case GET_ENCAPSULATED_RESPONSE:                                          E:\usb20\scope\system\usb\class\cdc\cdc.c
000492   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_CDC;                                   E:\usb20\scope\system\usb\class\cdc\cdc.c
000494   0e03     MOVLW     0x3                                                                                             
000496   6ff5     MOVWF     0xf5,0x1                                                                                        
                                                       // Populate dummy_encapsulated_cmd_response first.                   E:\usb20\scope\system\usb\class\cdc\cdc.c
000498   0100     MOVLB     0x0                        pDst.bRam = (byte*)&dummy_encapsulated_cmd_response;                 E:\usb20\scope\system\usb\class\cdc\cdc.c
00049a   0ed3     MOVLW     0xd3                                                                                            
00049c   6ff8     MOVWF     0xf8,0x1                                                                                        
00049e   0e07     MOVLW     0x7                                                                                             
0004a0   6ff9     MOVWF     0xf9,0x1                                                                                        
0004a2   d021     BRA       0x4e6                      break;                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                   case SET_COMM_FEATURE:                  // Optional                      E:\usb20\scope\system\usb\class\cdc\cdc.c
0004a4   d020     BRA       0x4e6                      break;                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                   case GET_COMM_FEATURE:                  // Optional                      E:\usb20\scope\system\usb\class\cdc\cdc.c
0004a6   d01f     BRA       0x4e6                      break;                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                   case CLEAR_COMM_FEATURE:                // Optional                      E:\usb20\scope\system\usb\class\cdc\cdc.c
0004a8   d01e     BRA       0x4e6                      break;                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                   case SET_LINE_CODING:                                                    E:\usb20\scope\system\usb\class\cdc\cdc.c
0004aa   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_CDC;                                   E:\usb20\scope\system\usb\class\cdc\cdc.c
0004ac   0e03     MOVLW     0x3                                                                                             
0004ae   6ff5     MOVWF     0xf5,0x1                                                                                        
0004b0   0100     MOVLB     0x0                        pDst.bRam = (byte*)&line_coding;    // Set destination               E:\usb20\scope\system\usb\class\cdc\cdc.c
0004b2   0ec8     MOVLW     0xc8                                                                                            
0004b4   6ff8     MOVWF     0xf8,0x1                                                                                        
0004b6   0e07     MOVLW     0x7                                                                                             
0004b8   6ff9     MOVWF     0xf9,0x1                                                                                        
0004ba   d015     BRA       0x4e6                      break;                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                   case GET_LINE_CODING:                                                    E:\usb20\scope\system\usb\class\cdc\cdc.c
0004bc   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_CDC;                                   E:\usb20\scope\system\usb\class\cdc\cdc.c
0004be   0e03     MOVLW     0x3                                                                                             
0004c0   6ff5     MOVWF     0xf5,0x1                                                                                        
0004c2   0100     MOVLB     0x0                        pSrc.bRam = (byte*)&line_coding;    // Set source                    E:\usb20\scope\system\usb\class\cdc\cdc.c
0004c4   0ec8     MOVLW     0xc8                                                                                            
0004c6   6ff6     MOVWF     0xf6,0x1                                                                                        
0004c8   0e07     MOVLW     0x7                                                                                             
0004ca   6ff7     MOVWF     0xf7,0x1                                                                                        
0004cc   0100     MOVLB     0x0                        usb_stat.ctrl_trf_mem = _RAM;       // Set memory type               E:\usb20\scope\system\usb\class\cdc\cdc.c
0004ce   93fd     BCF       0xfd,0x1,0x1                                                                                    
0004d0   0100     MOVLB     0x0                        LSB(wCount) = LINE_CODING_LENGTH;   // Set data count                E:\usb20\scope\system\usb\class\cdc\cdc.c
0004d2   0e07     MOVLW     0x7                                                                                             
0004d4   6ffa     MOVWF     0xfa,0x1                                                                                        
0004d6   d007     BRA       0x4e6                      break;                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                   case SET_CONTROL_LINE_STATE:                                             E:\usb20\scope\system\usb\class\cdc\cdc.c
0004d8   0100     MOVLB     0x0                        ctrl_trf_session_owner = MUID_CDC;                                   E:\usb20\scope\system\usb\class\cdc\cdc.c
0004da   0e03     MOVLW     0x3                                                                                             
0004dc   6ff5     MOVWF     0xf5,0x1                                                                                        
0004de   c422     MOVFF     0x422,0x7cf                control_signal_bitmap._byte = LSB(SetupPkt.W_Value);                 E:\usb20\scope\system\usb\class\cdc\cdc.c
0004e0   f7cf                                                                                                               
0004e2   d001     BRA       0x4e6                      break;                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                   case SEND_BREAK:                        // Optional                      E:\usb20\scope\system\usb\class\cdc\cdc.c
0004e4   d000     BRA       0x4e6                      break;                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                   default:                                                                 E:\usb20\scope\system\usb\class\cdc\cdc.c
000474   d038     BRA       0x4e6                      break;                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               }//end switch(SetupPkt.bRequest)                                             E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
0004e6   0012     RETURN    0x0            }//end USBCheckCDCRequest                                                        E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           /** U S E R  A P I ***********************************************************/  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Function:        void CDCInitEP(void)                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Overview:        CDCInitEP initializes CDC endpoints, buffer descriptors,     E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  internal state-machine, and variables.                       E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  It should be called after the USB host has sent out a        E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  SET_CONFIGURATION request.                                   E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  See USBStdSetCfgHandler() in usb9.c for examples.            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Note:            None                                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           void CDCInitEP(void)                                                             E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           {                                                                                E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               //Abstract line coding information                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
0004e8   0107     MOVLB     0x7                line_coding.dwDTERate._dword = 115200;      // baud rate                     E:\usb20\scope\system\usb\class\cdc\cdc.c
0004ea   6bc8     CLRF      0xc8,0x1                                                                                        
0004ec   0ec2     MOVLW     0xc2                                                                                            
0004ee   6fc9     MOVWF     0xc9,0x1                                                                                        
0004f0   0e01     MOVLW     0x1                                                                                             
0004f2   6fca     MOVWF     0xca,0x1                                                                                        
0004f4   6bcb     CLRF      0xcb,0x1                                                                                        
0004f6   6bcc     CLRF      0xcc,0x1           line_coding.bCharFormat = 0x00;             // 1 stop bit                    E:\usb20\scope\system\usb\class\cdc\cdc.c
0004f8   6bcd     CLRF      0xcd,0x1           line_coding.bParityType = 0x00;             // None                          E:\usb20\scope\system\usb\class\cdc\cdc.c
0004fa   0e08     MOVLW     0x8                line_coding.bDataBits = 0x08;               // 5,6,7,8, or 16                E:\usb20\scope\system\usb\class\cdc\cdc.c
0004fc   6fce     MOVWF     0xce,0x1                                                                                        
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
0004fe   6bc1     CLRF      0xc1,0x1           cdc_trf_state = CDC_TX_READY;                                                E:\usb20\scope\system\usb\class\cdc\cdc.c
000500   6bc0     CLRF      0xc0,0x1           cdc_rx_len = 0;                                                              E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
000502   0e1a     MOVLW     0x1a               CDC_COMM_UEP = EP_IN|HSHK_EN;               // Enable 1 Comm pipe            E:\usb20\scope\system\usb\class\cdc\cdc.c
000504   6e72     MOVWF     0x72,0x0                                                                                        
000506   0e1e     MOVLW     0x1e               CDC_DATA_UEP = EP_OUT_IN|HSHK_EN;           // Enable 2 data pipes           E:\usb20\scope\system\usb\class\cdc\cdc.c
000508   6e73     MOVWF     0x73,0x0                                                                                        
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               /*                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * Do not have to init Cnt of IN pipes here.                                 E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * Reason:  Number of bytes to send to the host                              E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                *          varies from one transaction to                                   E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                *          another. Cnt should equal the exact                              E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                *          number of bytes to transmit for                                  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                *          a given IN transaction.                                          E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                *          This number of bytes will only                                   E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                *          be known right before the data is                                E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                *          sent.                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                */                                                                          E:\usb20\scope\system\usb\class\cdc\cdc.c
00050a   0104     MOVLB     0x4                CDC_INT_BD_IN.ADR = (byte*)&cdc_notice;     // Set buffer address            E:\usb20\scope\system\usb\class\cdc\cdc.c
00050c   0e00     MOVLW     0x0                                                                                             
00050e   6f16     MOVWF     0x16,0x1                                                                                        
000510   0e05     MOVLW     0x5                                                                                             
000512   6f17     MOVWF     0x17,0x1                                                                                        
000514   0e40     MOVLW     0x40               CDC_INT_BD_IN.Stat._byte = _UCPU|_DAT1;     // Set status                    E:\usb20\scope\system\usb\class\cdc\cdc.c
000516   6f14     MOVWF     0x14,0x1                                                                                        
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
000518   0104     MOVLB     0x4                CDC_BULK_BD_OUT.Cnt = sizeof(cdc_data_rx);  // Set buffer size               E:\usb20\scope\system\usb\class\cdc\cdc.c
00051a   6f19     MOVWF     0x19,0x1                                                                                        
00051c   0e08     MOVLW     0x8                CDC_BULK_BD_OUT.ADR = (byte*)&cdc_data_rx;  // Set buffer address            E:\usb20\scope\system\usb\class\cdc\cdc.c
00051e   6f1a     MOVWF     0x1a,0x1                                                                                        
000520   0e05     MOVLW     0x5                                                                                             
000522   6f1b     MOVWF     0x1b,0x1                                                                                        
000524   0e88     MOVLW     0x88               CDC_BULK_BD_OUT.Stat._byte = _USIE|_DAT0|_DTSEN;// Set status                E:\usb20\scope\system\usb\class\cdc\cdc.c
000526   6f18     MOVWF     0x18,0x1                                                                                        
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
000528   0104     MOVLB     0x4                CDC_BULK_BD_IN.ADR = (byte*)&cdc_data_tx;   // Set buffer size               E:\usb20\scope\system\usb\class\cdc\cdc.c
00052a   0e48     MOVLW     0x48                                                                                            
00052c   6f1e     MOVWF     0x1e,0x1                                                                                        
00052e   0e05     MOVLW     0x5                                                                                             
000530   6f1f     MOVWF     0x1f,0x1                                                                                        
000532   0e40     MOVLW     0x40               CDC_BULK_BD_IN.Stat._byte = _UCPU|_DAT1;    // Set buffer address            E:\usb20\scope\system\usb\class\cdc\cdc.c
000534   6f1c     MOVWF     0x1c,0x1                                                                                        
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
000536   0012     RETURN    0x0            }//end CDCInitEP                                                                 E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Function:        byte getsUSBUSART(char *buffer,                              E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                    byte len)                                  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * PreCondition:    Value of input argument 'len' should be smaller than the     E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  maximum endpoint size responsible for receiving bulk         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  data from USB host for CDC class.                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  Input argument 'buffer' should point to a buffer area that   E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  is bigger or equal to the size specified by 'len'.           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Input:           buffer  : Pointer to where received bytes are to be stored   E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  len     : The number of bytes expected.                      E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Output:          The number of bytes copied to buffer.                        E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Side Effects:    Publicly accessible variable cdc_rx_len is updated with      E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  the number of bytes copied to buffer.                        E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  Once getsUSBUSART is called, subsequent retrieval of         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  cdc_rx_len can be done by calling macro mCDCGetRxLength().   E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Overview:        getsUSBUSART copies a string of bytes received through       E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  USB CDC Bulk OUT endpoint to a user's specified location.    E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  It is a non-blocking function. It does not wait              E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  for data if there is no data available. Instead it returns   E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  '0' to notify the caller that there is no data available.    E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Note:            If the actual number of bytes received is larger than the    E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  number of bytes expected (len), only the expected number     E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  of bytes specified will be copied to buffer.                 E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  If the actual number of bytes received is smaller than the   E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  number of bytes expected (len), only the actual number       E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  of bytes received will be copied to buffer.                  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\class\cdc\cdc.c
000538   cfd9     MOVFF     0xfd9,0xfe6    byte getsUSBUSART(char *buffer, byte len)                                        E:\usb20\scope\system\usb\class\cdc\cdc.c
00053a   ffe6                                                                                                               
00053c   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
00053e   ffd9                                                                                                               
                                           {                                                                                E:\usb20\scope\system\usb\class\cdc\cdc.c
000540   0107     MOVLB     0x7                cdc_rx_len = 0;                                                              E:\usb20\scope\system\usb\class\cdc\cdc.c
000542   6bc0     CLRF      0xc0,0x1                                                                                        
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
000544   0104     MOVLB     0x4                if(!mCDCUsartRxIsBusy())                                                     E:\usb20\scope\system\usb\class\cdc\cdc.c
000546   bf18     BTFSC     0x18,0x7,0x1                                                                                    
000548   d030     BRA       0x5aa                                                                                           
                                               {                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                   /*                                                                       E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                    * Adjust the expected number of bytes to equal                          E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                    * the actual number of bytes received.                                  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                    */                                                                      E:\usb20\scope\system\usb\class\cdc\cdc.c
00054a   0efc     MOVLW     0xfc                   if(len > CDC_BULK_BD_OUT.Cnt)                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
00054c   cfdb     MOVFF     0xfdb,0x14                                                                                      
00054e   f014                                                                                                               
000550   5119     MOVF      0x19,0x0,0x1                                                                                    
000552   80d8     BSF       0xd8,0x0,0x0                                                                                    
000554   5414     SUBFWB    0x14,0x0,0x0                                                                                    
000556   e203     BC        0x55e                                                                                           
000558   0efc     MOVLW     0xfc                       len = CDC_BULK_BD_OUT.Cnt;                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
00055a   c419     MOVFF     0x419,0xfdb                                                                                     
00055c   ffdb                                                                                                               
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                   /*                                                                       E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                    * Copy data from dual-ram buffer to user's buffer                       E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                    */                                                                      E:\usb20\scope\system\usb\class\cdc\cdc.c
00055e   0107     MOVLB     0x7                    for(cdc_rx_len = 0; cdc_rx_len < len; cdc_rx_len++)                      E:\usb20\scope\system\usb\class\cdc\cdc.c
000560   6bc0     CLRF      0xc0,0x1                                                                                        
000562   0efc     MOVLW     0xfc                                                                                            
000564   50db     MOVF      0xdb,0x0,0x0                                                                                    
000566   5dc0     SUBWF     0xc0,0x0,0x1                                                                                    
000568   e219     BC        0x59c                                                                                           
000598   2bc0     INCF      0xc0,0x1,0x1                                                                                    
00059a   d7e3     BRA       0x562                                                                                           
00056a   51c0     MOVF      0xc0,0x0,0x1               buffer[cdc_rx_len] = cdc_data_rx[cdc_rx_len];                        E:\usb20\scope\system\usb\class\cdc\cdc.c
00056c   6aea     CLRF      0xea,0x0                                                                                        
00056e   0f08     ADDLW     0x8                                                                                             
000570   6ee9     MOVWF     0xe9,0x0                                                                                        
000572   0e05     MOVLW     0x5                                                                                             
000574   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
000576   50ef     MOVF      0xef,0x0,0x0                                                                                    
000578   6ee6     MOVWF     0xe6,0x0                                                                                        
00057a   51c0     MOVF      0xc0,0x0,0x1                                                                                    
00057c   6ee7     MOVWF     0xe7,0x0                                                                                        
00057e   0efd     MOVLW     0xfd                                                                                            
000580   cfdb     MOVFF     0xfdb,0xfe9                                                                                     
000582   ffe9                                                                                                               
000584   0efe     MOVLW     0xfe                                                                                            
000586   cfdb     MOVFF     0xfdb,0xfea                                                                                     
000588   ffea                                                                                                               
00058a   50e7     MOVF      0xe7,0x0,0x0                                                                                    
00058c   26e9     ADDWF     0xe9,0x1,0x0                                                                                    
00058e   0e00     MOVLW     0x0                                                                                             
000590   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
000592   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000594   50e7     MOVF      0xe7,0x0,0x0                                                                                    
000596   6eef     MOVWF     0xef,0x0                                                                                        
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                   /*                                                                       E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                    * Prepare dual-ram buffer for next OUT transaction                      E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                    */                                                                      E:\usb20\scope\system\usb\class\cdc\cdc.c
00059c   0104     MOVLB     0x4                    CDC_BULK_BD_OUT.Cnt = sizeof(cdc_data_rx);                               E:\usb20\scope\system\usb\class\cdc\cdc.c
00059e   0e40     MOVLW     0x40                                                                                            
0005a0   6f19     MOVWF     0x19,0x1                                                                                        
0005a2   1718     ANDWF     0x18,0x1,0x1           mUSBBufferReady(CDC_BULK_BD_OUT);                                        E:\usb20\scope\system\usb\class\cdc\cdc.c
0005a4   7d18     BTG       0x18,0x6,0x1                                                                                    
0005a6   0e88     MOVLW     0x88                                                                                            
0005a8   1318     IORWF     0x18,0x1,0x1                                                                                    
                                               }//end if                                                                    E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
0005aa   0107     MOVLB     0x7                return cdc_rx_len;                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
0005ac   51c0     MOVF      0xc0,0x0,0x1                                                                                    
0005ae   d000     BRA       0x5b0                                                                                           
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
0005b0   52e5     MOVF      0xe5,0x1,0x0   }//end getsUSBUSART                                                              E:\usb20\scope\system\usb\class\cdc\cdc.c
0005b2   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
0005b4   ffd9                                                                                                               
0005b6   0012     RETURN    0x0                                                                                             
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Function:        void putsUSBUSART(char *data)                                E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * PreCondition:    cdc_trf_state must be in the CDC_TX_READY state.             E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  The string of characters pointed to by 'data' must equal     E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  to or smaller than 255 bytes.                                E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Input:           data    : Pointer to a null-terminated string of data.       E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                            If a null character is not found, 255 bytes        E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                            of data will be transferred to the host.           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Overview:        putsUSBUSART writes a string of data to the USB including    E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  the null character. Use this version, 'puts', to transfer    E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  data located in data memory.                                 E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Note:            The transfer mechanism for device-to-host(put) is more       E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  flexible than host-to-device(get). It can handle             E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  a string of data larger than the maximum size of bulk IN     E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  endpoint. A state machine is used to transfer a long         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  string of data over multiple USB transactions.               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  See CDCTxService() for more details.                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\class\cdc\cdc.c
0005b8   cfd9     MOVFF     0xfd9,0xfe6    void putsUSBUSART(char *data)                                                    E:\usb20\scope\system\usb\class\cdc\cdc.c
0005ba   ffe6                                                                                                               
0005bc   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
0005be   ffd9                                                                                                               
0005c0   52e6     MOVF      0xe6,0x1,0x0                                                                                    
                                           {                                                                                E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               byte len;                                                                    E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               /*                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * User should have checked that cdc_trf_state is in CDC_TX_READY state      E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * before calling this function.                                             E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * As a safety precaution, this fuction checks the state one more time       E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * to make sure it does not override any pending transactions.               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                *                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * Currently it just quits the routine without reporting any errors back     E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * to the user.                                                              E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                *                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * Bottomline: User MUST make sure that mUSBUSARTIsTxTrfReady()==1           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                *             before calling this function!                                 E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * Example:                                                                  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * if(mUSBUSARTIsTxTrfReady())                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                *     putsUSBUSART(pData);                                                  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                *                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * IMPORTANT: Never use the following blocking while loop to wait:           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * while(!mUSBUSARTIsTxTrfReady())                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                *     putsUSBUSART(pData);                                                  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                *                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * The whole firmware framework is written based on cooperative              E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * multi-tasking and a blocking code is not acceptable.                      E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * Use a state machine instead.                                              E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                */                                                                          E:\usb20\scope\system\usb\class\cdc\cdc.c
0005c2   0107     MOVLB     0x7                if(cdc_trf_state != CDC_TX_READY) return;                                    E:\usb20\scope\system\usb\class\cdc\cdc.c
0005c4   51c1     MOVF      0xc1,0x0,0x1                                                                                    
0005c6   e001     BZ        0x5ca                                                                                           
0005c8   d02f     BRA       0x628                                                                                           
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               /*                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * While loop counts the number of bytes to send including the               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * null character.                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                */                                                                          E:\usb20\scope\system\usb\class\cdc\cdc.c
0005ca   6adf     CLRF      0xdf,0x0           len = 0;                                                                     E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               do                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               {                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
0005cc   2adf     INCF      0xdf,0x1,0x0           len++;                                                                   E:\usb20\scope\system\usb\class\cdc\cdc.c
0005ce   50df     MOVF      0xdf,0x0,0x0           if(len == 255) break;       // Break loop once max len is reached.       E:\usb20\scope\system\usb\class\cdc\cdc.c
0005d0   6e14     MOVWF     0x14,0x0                                                                                        
0005d2   6a15     CLRF      0x15,0x0                                                                                        
0005d4   0eff     MOVLW     0xff                                                                                            
0005d6   1814     XORWF     0x14,0x0,0x0                                                                                    
0005d8   e101     BNZ       0x5dc                                                                                           
0005da   5015     MOVF      0x15,0x0,0x0                                                                                    
0005dc   e101     BNZ       0x5e0                                                                                           
0005de   d00b     BRA       0x5f6                                                                                           
0005e0   0efd     MOVLW     0xfd               }while(*data++);                                                             E:\usb20\scope\system\usb\class\cdc\cdc.c
0005e2   cfdb     MOVFF     0xfdb,0xfe9                                                                                     
0005e4   ffe9                                                                                                               
0005e6   2adb     INCF      0xdb,0x1,0x0                                                                                    
0005e8   0efe     MOVLW     0xfe                                                                                            
0005ea   cfdb     MOVFF     0xfdb,0xfea                                                                                     
0005ec   ffea                                                                                                               
0005ee   e301     BNC       0x5f2                                                                                           
0005f0   2adb     INCF      0xdb,0x1,0x0                                                                                    
0005f2   50ef     MOVF      0xef,0x0,0x0                                                                                    
0005f4   e1eb     BNZ       0x5cc                                                                                           
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               /*                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * Re-adjust pointer to its initial location                                 E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                */                                                                          E:\usb20\scope\system\usb\class\cdc\cdc.c
0005f6   50df     MOVF      0xdf,0x0,0x0       data-=len;                                                                   E:\usb20\scope\system\usb\class\cdc\cdc.c
0005f8   6e14     MOVWF     0x14,0x0                                                                                        
0005fa   6a15     CLRF      0x15,0x0                                                                                        
0005fc   50d9     MOVF      0xd9,0x0,0x0                                                                                    
0005fe   0ffd     ADDLW     0xfd                                                                                            
000600   6ee9     MOVWF     0xe9,0x0                                                                                        
000602   0eff     MOVLW     0xff                                                                                            
000604   20da     ADDWFC    0xda,0x0,0x0                                                                                    
000606   6eea     MOVWF     0xea,0x0                                                                                        
000608   5014     MOVF      0x14,0x0,0x0                                                                                    
00060a   5eee     SUBWF     0xee,0x1,0x0                                                                                    
00060c   5015     MOVF      0x15,0x0,0x0                                                                                    
00060e   5aed     SUBWFB    0xed,0x1,0x0                                                                                    
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               /*                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * Second piece of information (length of data to send) is ready.            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * Call mUSBUSARTTxRam to setup the transfer.                                E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * The actual transfer process will be handled by CDCTxService(),            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * which should be called once per Main Program loop.                        E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                */                                                                          E:\usb20\scope\system\usb\class\cdc\cdc.c
000610   0efd     MOVLW     0xfd               mUSBUSARTTxRam((byte*)data,len);     // See cdc.h                            E:\usb20\scope\system\usb\class\cdc\cdc.c
000612   cfdb     MOVFF     0xfdb,0x7c2                                                                                     
000614   f7c2                                                                                                               
000616   0efe     MOVLW     0xfe                                                                                            
000618   cfdb     MOVFF     0xfdb,0x7c3                                                                                     
00061a   f7c3                                                                                                               
00061c   cfdf     MOVFF     0xfdf,0x7c6                                                                                     
00061e   f7c6                                                                                                               
000620   0107     MOVLB     0x7                                                                                             
000622   6bc7     CLRF      0xc7,0x1                                                                                        
000624   0e01     MOVLW     0x1                                                                                             
000626   6fc1     MOVWF     0xc1,0x1                                                                                        
000628   52e5     MOVF      0xe5,0x1,0x0   }//end putsUSBUSART                                                              E:\usb20\scope\system\usb\class\cdc\cdc.c
00062a   52e5     MOVF      0xe5,0x1,0x0                                                                                    
00062c   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
00062e   ffd9                                                                                                               
000630   0012     RETURN    0x0                                                                                             
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Function:        void putrsUSBUSART(const rom char *data)                     E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * PreCondition:    cdc_trf_state must be in the CDC_TX_READY state.             E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  The string of characters pointed to by 'data' must equal     E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  to or smaller than 255 bytes.                                E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Input:           data    : Pointer to a null-terminated string of data.       E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                            If a null character is not found, 255 bytes        E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                            of data will be transferred to the host.           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Overview:        putrsUSBUSART writes a string of data to the USB including   E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  the null character. Use this version, 'putrs', to transfer   E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  data literals and data located in program memory.            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Note:            The transfer mechanism for device-to-host(put) is more       E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  flexible than host-to-device(get). It can handle             E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  a string of data larger than the maximum size of bulk IN     E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  endpoint. A state machine is used to transfer a long         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  string of data over multiple USB transactions.               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  See CDCTxService() for more details.                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\class\cdc\cdc.c
000632   cfd9     MOVFF     0xfd9,0xfe6    void putrsUSBUSART(const rom char *data)                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
000634   ffe6                                                                                                               
000636   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
000638   ffd9                                                                                                               
00063a   52e6     MOVF      0xe6,0x1,0x0                                                                                    
                                           {                                                                                E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               byte len;                                                                    E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               /*                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * User should have checked that cdc_trf_state is in CDC_TX_READY state      E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * before calling this function.                                             E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * As a safety precaution, this fuction checks the state one more time       E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * to make sure it does not override any pending transactions.               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                *                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * Currently it just quits the routine without reporting any errors back     E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * to the user.                                                              E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                *                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * Bottomline: User MUST make sure that mUSBUSARTIsTxTrfReady()              E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                *             before calling this function!                                 E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * Example:                                                                  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * if(mUSBUSARTIsTxTrfReady())                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                *     putsUSBUSART(pData);                                                  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                *                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * IMPORTANT: Never use the following blocking while loop to wait:           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * while(cdc_trf_state != CDC_TX_READY)                                      E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                *     putsUSBUSART(pData);                                                  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                *                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * The whole firmware framework is written based on cooperative              E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * multi-tasking and a blocking code is not acceptable.                      E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * Use a state machine instead.                                              E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                */                                                                          E:\usb20\scope\system\usb\class\cdc\cdc.c
00063c   0107     MOVLB     0x7                if(cdc_trf_state != CDC_TX_READY) return;                                    E:\usb20\scope\system\usb\class\cdc\cdc.c
00063e   51c1     MOVF      0xc1,0x0,0x1                                                                                    
000640   e001     BZ        0x644                                                                                           
000642   d030     BRA       0x6a4                                                                                           
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               /*                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * While loop counts the number of bytes to send including the               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * null character.                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                */                                                                          E:\usb20\scope\system\usb\class\cdc\cdc.c
000644   6adf     CLRF      0xdf,0x0           len = 0;                                                                     E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               do                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               {                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
000646   2adf     INCF      0xdf,0x1,0x0           len++;                                                                   E:\usb20\scope\system\usb\class\cdc\cdc.c
000648   50df     MOVF      0xdf,0x0,0x0           if(len == 255) break;       // Break loop once max len is reached.       E:\usb20\scope\system\usb\class\cdc\cdc.c
00064a   6e14     MOVWF     0x14,0x0                                                                                        
00064c   6a15     CLRF      0x15,0x0                                                                                        
00064e   0eff     MOVLW     0xff                                                                                            
000650   1814     XORWF     0x14,0x0,0x0                                                                                    
000652   e101     BNZ       0x656                                                                                           
000654   5015     MOVF      0x15,0x0,0x0                                                                                    
000656   e101     BNZ       0x65a                                                                                           
000658   d00c     BRA       0x672                                                                                           
00065a   0efd     MOVLW     0xfd               }while(*data++);                                                             E:\usb20\scope\system\usb\class\cdc\cdc.c
00065c   cfdb     MOVFF     0xfdb,0xff6                                                                                     
00065e   fff6                                                                                                               
000660   2adb     INCF      0xdb,0x1,0x0                                                                                    
000662   0efe     MOVLW     0xfe                                                                                            
000664   cfdb     MOVFF     0xfdb,0xff7                                                                                     
000666   fff7                                                                                                               
000668   e301     BNC       0x66c                                                                                           
00066a   2adb     INCF      0xdb,0x1,0x0                                                                                    
00066c   0008     TBLRD                                                                                                     
00066e   50f5     MOVF      0xf5,0x0,0x0                                                                                    
000670   e1ea     BNZ       0x646                                                                                           
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               /*                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * Re-adjust pointer to its initial location                                 E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                */                                                                          E:\usb20\scope\system\usb\class\cdc\cdc.c
000672   50df     MOVF      0xdf,0x0,0x0       data-=len;                                                                   E:\usb20\scope\system\usb\class\cdc\cdc.c
000674   6e14     MOVWF     0x14,0x0                                                                                        
000676   6a15     CLRF      0x15,0x0                                                                                        
000678   50d9     MOVF      0xd9,0x0,0x0                                                                                    
00067a   0ffd     ADDLW     0xfd                                                                                            
00067c   6ee9     MOVWF     0xe9,0x0                                                                                        
00067e   0eff     MOVLW     0xff                                                                                            
000680   20da     ADDWFC    0xda,0x0,0x0                                                                                    
000682   6eea     MOVWF     0xea,0x0                                                                                        
000684   5014     MOVF      0x14,0x0,0x0                                                                                    
000686   5eee     SUBWF     0xee,0x1,0x0                                                                                    
000688   5015     MOVF      0x15,0x0,0x0                                                                                    
00068a   5aed     SUBWFB    0xed,0x1,0x0                                                                                    
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               /*                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * Second piece of information (length of data to send) is ready.            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * Call mUSBUSARTTxRom to setup the transfer.                                E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * The actual transfer process will be handled by CDCTxService(),            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * which should be called once per Main Program loop.                        E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                */                                                                          E:\usb20\scope\system\usb\class\cdc\cdc.c
00068c   0efd     MOVLW     0xfd               mUSBUSARTTxRom((rom byte*)data,len); // See cdc.h                            E:\usb20\scope\system\usb\class\cdc\cdc.c
00068e   cfdb     MOVFF     0xfdb,0x7c2                                                                                     
000690   f7c2                                                                                                               
000692   0efe     MOVLW     0xfe                                                                                            
000694   cfdb     MOVFF     0xfdb,0x7c3                                                                                     
000696   f7c3                                                                                                               
000698   cfdf     MOVFF     0xfdf,0x7c6                                                                                     
00069a   f7c6                                                                                                               
00069c   0107     MOVLB     0x7                                                                                             
00069e   0e01     MOVLW     0x1                                                                                             
0006a0   6fc7     MOVWF     0xc7,0x1                                                                                        
0006a2   6fc1     MOVWF     0xc1,0x1                                                                                        
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
0006a4   52e5     MOVF      0xe5,0x1,0x0   }//end putrsUSBUSART                                                             E:\usb20\scope\system\usb\class\cdc\cdc.c
0006a6   52e5     MOVF      0xe5,0x1,0x0                                                                                    
0006a8   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
0006aa   ffd9                                                                                                               
0006ac   0012     RETURN    0x0                                                                                             
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           /******************************************************************************  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Function:        void CDCTxService(void)                                      E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * PreCondition:    None                                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Input:           None                                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Output:          None                                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Side Effects:    None                                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Overview:        CDCTxService handles device-to-host transaction(s).          E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                  This function should be called once per Main Program loop.   E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *                                                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            * Note:            None                                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                            *****************************************************************************/  E:\usb20\scope\system\usb\class\cdc\cdc.c
0006ae   cfd9     MOVFF     0xfd9,0xfe6    void CDCTxService(void)                                                          E:\usb20\scope\system\usb\class\cdc\cdc.c
0006b0   ffe6                                                                                                               
0006b2   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
0006b4   ffd9                                                                                                               
0006b6   52e6     MOVF      0xe6,0x1,0x0                                                                                    
                                           {                                                                                E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               byte byte_to_send;                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
0006b8   0104     MOVLB     0x4                if(mCDCUsartTxIsBusy()) return;                                              E:\usb20\scope\system\usb\class\cdc\cdc.c
0006ba   bf1c     BTFSC     0x1c,0x7,0x1                                                                                    
0006bc   d06b     BRA       0x794                                                                                           
                                               /*                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * Completing stage is necessary while [ mCDCUSartTxIsBusy()==1 ].           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * By having this stage, user can always check cdc_trf_state,                E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * and not having to call mCDCUsartTxIsBusy() directly.                      E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                */                                                                          E:\usb20\scope\system\usb\class\cdc\cdc.c
0006be   0e03     MOVLW     0x3                if(cdc_trf_state == CDC_TX_COMPLETING)                                       E:\usb20\scope\system\usb\class\cdc\cdc.c
0006c0   0107     MOVLB     0x7                                                                                             
0006c2   5dc1     SUBWF     0xc1,0x0,0x1                                                                                    
0006c4   e101     BNZ       0x6c8                                                                                           
0006c6   6bc1     CLRF      0xc1,0x1               cdc_trf_state = CDC_TX_READY;                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               /*                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * If CDC_TX_READY state, nothing to do, just return.                        E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                */                                                                          E:\usb20\scope\system\usb\class\cdc\cdc.c
0006c8   51c1     MOVF      0xc1,0x0,0x1       if(cdc_trf_state == CDC_TX_READY) return;                                    E:\usb20\scope\system\usb\class\cdc\cdc.c
0006ca   e101     BNZ       0x6ce                                                                                           
0006cc   d063     BRA       0x794                                                                                           
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               /*                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * If CDC_TX_BUSY_ZLP state, send zero length packet                         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                */                                                                          E:\usb20\scope\system\usb\class\cdc\cdc.c
0006ce   0e02     MOVLW     0x2                if(cdc_trf_state == CDC_TX_BUSY_ZLP)                                         E:\usb20\scope\system\usb\class\cdc\cdc.c
0006d0   5dc1     SUBWF     0xc1,0x0,0x1                                                                                    
0006d2   e106     BNZ       0x6e0                                                                                           
                                               {                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
0006d4   0104     MOVLB     0x4                    CDC_BULK_BD_IN.Cnt = 0;                                                  E:\usb20\scope\system\usb\class\cdc\cdc.c
0006d6   6b1d     CLRF      0x1d,0x1                                                                                        
0006d8   0107     MOVLB     0x7                    cdc_trf_state = CDC_TX_COMPLETING;                                       E:\usb20\scope\system\usb\class\cdc\cdc.c
0006da   0e03     MOVLW     0x3                                                                                             
0006dc   6fc1     MOVWF     0xc1,0x1                                                                                        
                                               }                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
0006de   d054     BRA       0x788              else if(cdc_trf_state == CDC_TX_BUSY)                                        E:\usb20\scope\system\usb\class\cdc\cdc.c
0006e0   05c1     DECF      0xc1,0x0,0x1                                                                                    
0006e2   e152     BNZ       0x788                                                                                           
                                               {                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                   /*                                                                       E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                    * First, have to figure out how many byte of data to send.              E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                    */                                                                      E:\usb20\scope\system\usb\class\cdc\cdc.c
0006e4   0e40     MOVLW     0x40               	if(cdc_tx_len > sizeof(cdc_data_tx))                                        E:\usb20\scope\system\usb\class\cdc\cdc.c
0006e6   6e14     MOVWF     0x14,0x0                                                                                        
0006e8   6a15     CLRF      0x15,0x0                                                                                        
0006ea   51c6     MOVF      0xc6,0x0,0x1                                                                                    
0006ec   5c14     SUBWF     0x14,0x0,0x0                                                                                    
0006ee   0e00     MOVLW     0x0                                                                                             
0006f0   5815     SUBWFB    0x15,0x0,0x0                                                                                    
0006f2   e203     BC        0x6fa                                                                                           
0006f4   0e40     MOVLW     0x40               	    byte_to_send = sizeof(cdc_data_tx);                                     E:\usb20\scope\system\usb\class\cdc\cdc.c
0006f6   6edf     MOVWF     0xdf,0x0                                                                                        
0006f8   d002     BRA       0x6fe              	else                                                                        E:\usb20\scope\system\usb\class\cdc\cdc.c
0006fa   c7c6     MOVFF     0x7c6,0xfdf        	    byte_to_send = cdc_tx_len;                                              E:\usb20\scope\system\usb\class\cdc\cdc.c
0006fc   ffdf                                                                                                               
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                   /*                                                                       E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                    * Next, load the number of bytes to send to Cnt in buffer descriptor    E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                    */                                                                      E:\usb20\scope\system\usb\class\cdc\cdc.c
0006fe   cfdf     MOVFF     0xfdf,0x41d            CDC_BULK_BD_IN.Cnt = byte_to_send;                                       E:\usb20\scope\system\usb\class\cdc\cdc.c
000700   f41d                                                                                                               
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                   /*                                                                       E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                    * Subtract the number of bytes just about to be sent from the total.    E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                    */                                                                      E:\usb20\scope\system\usb\class\cdc\cdc.c
000702   50df     MOVF      0xdf,0x0,0x0       	cdc_tx_len = cdc_tx_len - byte_to_send;                                     E:\usb20\scope\system\usb\class\cdc\cdc.c
000704   5dc6     SUBWF     0xc6,0x0,0x1                                                                                    
000706   6fc6     MOVWF     0xc6,0x1                                                                                        
                                               	                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
000708   0e48     MOVLW     0x48                   pCDCDst.bRam = (byte*)&cdc_data_tx; // Set destination pointer           E:\usb20\scope\system\usb\class\cdc\cdc.c
00070a   6fc4     MOVWF     0xc4,0x1                                                                                        
00070c   0e05     MOVLW     0x5                                                                                             
00070e   6fc5     MOVWF     0xc5,0x1                                                                                        
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
000710   05c7     DECF      0xc7,0x0,0x1           if(cdc_mem_type == _ROM)            // Determine type of memory source   E:\usb20\scope\system\usb\class\cdc\cdc.c
000712   e115     BNZ       0x73e                                                                                           
                                                   {                                                                        E:\usb20\scope\system\usb\class\cdc\cdc.c
000714   50df     MOVF      0xdf,0x0,0x0               while(byte_to_send)                                                  E:\usb20\scope\system\usb\class\cdc\cdc.c
000716   e012     BZ        0x73c                                                                                           
00073a   d7ec     BRA       0x714                                                                                           
                                                       {                                                                    E:\usb20\scope\system\usb\class\cdc\cdc.c
000718   c7c2     MOVFF     0x7c2,0xff6                    *pCDCDst.bRam = *pCDCSrc.bRom;                                   E:\usb20\scope\system\usb\class\cdc\cdc.c
00071a   fff6                                                                                                               
00071c   c7c3     MOVFF     0x7c3,0xff7                                                                                     
00071e   fff7                                                                                                               
000720   0008     TBLRD                                                                                                     
000722   50f5     MOVF      0xf5,0x0,0x0                                                                                    
000724   c7c4     MOVFF     0x7c4,0xfe9                                                                                     
000726   ffe9                                                                                                               
000728   c7c5     MOVFF     0x7c5,0xfea                                                                                     
00072a   ffea                                                                                                               
00072c   6eef     MOVWF     0xef,0x0                                                                                        
00072e   2bc4     INCF      0xc4,0x1,0x1                   pCDCDst.bRam++;                                                  E:\usb20\scope\system\usb\class\cdc\cdc.c
000730   0e00     MOVLW     0x0                                                                                             
000732   23c5     ADDWFC    0xc5,0x1,0x1                                                                                    
000734   2bc2     INCF      0xc2,0x1,0x1                   pCDCSrc.bRom++;                                                  E:\usb20\scope\system\usb\class\cdc\cdc.c
000736   23c3     ADDWFC    0xc3,0x1,0x1                                                                                    
000738   06df     DECF      0xdf,0x1,0x0                   byte_to_send--;                                                  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                       }//end while(byte_to_send)                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                   }                                                                        E:\usb20\scope\system\usb\class\cdc\cdc.c
00073c   d013     BRA       0x764                  else // _RAM                                                             E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                   {                                                                        E:\usb20\scope\system\usb\class\cdc\cdc.c
00073e   50df     MOVF      0xdf,0x0,0x0               while(byte_to_send)                                                  E:\usb20\scope\system\usb\class\cdc\cdc.c
000740   e011     BZ        0x764                                                                                           
000762   d7ed     BRA       0x73e                                                                                           
                                                       {                                                                    E:\usb20\scope\system\usb\class\cdc\cdc.c
000742   c7c2     MOVFF     0x7c2,0xfe9                    *pCDCDst.bRam = *pCDCSrc.bRam;                                   E:\usb20\scope\system\usb\class\cdc\cdc.c
000744   ffe9                                                                                                               
000746   c7c3     MOVFF     0x7c3,0xfea                                                                                     
000748   ffea                                                                                                               
00074a   50ef     MOVF      0xef,0x0,0x0                                                                                    
00074c   c7c4     MOVFF     0x7c4,0xfe9                                                                                     
00074e   ffe9                                                                                                               
000750   c7c5     MOVFF     0x7c5,0xfea                                                                                     
000752   ffea                                                                                                               
000754   6eef     MOVWF     0xef,0x0                                                                                        
000756   2bc4     INCF      0xc4,0x1,0x1                   pCDCDst.bRam++;                                                  E:\usb20\scope\system\usb\class\cdc\cdc.c
000758   0e00     MOVLW     0x0                                                                                             
00075a   23c5     ADDWFC    0xc5,0x1,0x1                                                                                    
00075c   2bc2     INCF      0xc2,0x1,0x1                   pCDCSrc.bRam++;                                                  E:\usb20\scope\system\usb\class\cdc\cdc.c
00075e   23c3     ADDWFC    0xc3,0x1,0x1                                                                                    
000760   06df     DECF      0xdf,0x1,0x0                   byte_to_send--;                                                  E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                       }//end while(byte_to_send._word)                                     E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                   }//end if(cdc_mem_type...)                                               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                   /*                                                                       E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                    * Lastly, determine if a zero length packet state is necessary.         E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                    * See explanation in USB Specification 2.0: Section 5.8.3               E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                    */                                                                      E:\usb20\scope\system\usb\class\cdc\cdc.c
000764   51c6     MOVF      0xc6,0x0,0x1           if(cdc_tx_len == 0)                                                      E:\usb20\scope\system\usb\class\cdc\cdc.c
000766   e110     BNZ       0x788                                                                                           
                                                   {                                                                        E:\usb20\scope\system\usb\class\cdc\cdc.c
000768   0104     MOVLB     0x4                        if(CDC_BULK_BD_IN.Cnt == sizeof(cdc_data_tx))                        E:\usb20\scope\system\usb\class\cdc\cdc.c
00076a   511d     MOVF      0x1d,0x0,0x1                                                                                    
00076c   6e14     MOVWF     0x14,0x0                                                                                        
00076e   6a15     CLRF      0x15,0x0                                                                                        
000770   0e40     MOVLW     0x40                                                                                            
000772   1814     XORWF     0x14,0x0,0x0                                                                                    
000774   e101     BNZ       0x778                                                                                           
000776   5015     MOVF      0x15,0x0,0x0                                                                                    
000778   e104     BNZ       0x782                                                                                           
00077a   0107     MOVLB     0x7                            cdc_trf_state = CDC_TX_BUSY_ZLP;                                 E:\usb20\scope\system\usb\class\cdc\cdc.c
00077c   0e02     MOVLW     0x2                                                                                             
00077e   6fc1     MOVWF     0xc1,0x1                                                                                        
000780   d003     BRA       0x788                      else                                                                 E:\usb20\scope\system\usb\class\cdc\cdc.c
000782   0107     MOVLB     0x7                            cdc_trf_state = CDC_TX_COMPLETING;                               E:\usb20\scope\system\usb\class\cdc\cdc.c
000784   0e03     MOVLW     0x3                                                                                             
000786   6fc1     MOVWF     0xc1,0x1                                                                                        
                                                   }//end if(cdc_tx_len...)                                                 E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               }//end if(cdc_tx_sate == CDC_TX_BUSY)                                        E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                               /*                                                                           E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                * Both CDC_TX_BUSY and CDC_TX_BUSY_ZLP states use the following macro       E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                */                                                                          E:\usb20\scope\system\usb\class\cdc\cdc.c
000788   0e40     MOVLW     0x40               mUSBBufferReady(CDC_BULK_BD_IN);                                             E:\usb20\scope\system\usb\class\cdc\cdc.c
00078a   0104     MOVLB     0x4                                                                                             
00078c   171c     ANDWF     0x1c,0x1,0x1                                                                                    
00078e   7d1c     BTG       0x1c,0x6,0x1                                                                                    
000790   0e88     MOVLW     0x88                                                                                            
000792   131c     IORWF     0x1c,0x1,0x1                                                                                    
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
000794   52e5     MOVF      0xe5,0x1,0x0   }//end CDCTxService                                                              E:\usb20\scope\system\usb\class\cdc\cdc.c
000796   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000798   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
00079a   ffd9                                                                                                               
00079c   0012     RETURN    0x0                                                                                             
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           #endif //USB_USE_CDC                                                             E:\usb20\scope\system\usb\class\cdc\cdc.c
                                                                                                                            E:\usb20\scope\system\usb\class\cdc\cdc.c
                                           /** EOF cdc.c ****************************************************************/  E:\usb20\scope\system\usb\class\cdc\cdc.c
